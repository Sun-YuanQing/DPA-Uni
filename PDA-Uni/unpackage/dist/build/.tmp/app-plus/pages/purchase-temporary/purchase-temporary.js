(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/purchase-temporary/purchase-temporary"],{"0483":function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},i=[];r.d(t,"a",function(){return o}),r.d(t,"b",function(){return i})},1014:function(e,t,r){"use strict";r.r(t);var o=r("0483"),i=r("b208");for(var n in i)"default"!==n&&function(e){r.d(t,e,function(){return i[e]})}(n);r("6cba");var d=r("2877"),a=Object(d["a"])(i["default"],o["a"],o["b"],!1,null,null,null);t["default"]=a.exports},"57e6":function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(r("2e17")),i=(n(r("f2a9")),n(r("00e0")),n(r("409c")));function n(e){return e&&e.__esModule?e:{default:e}}var d=function(){return r.e("components/uni-popup-modal/uni-popup-modal").then(r.bind(null,"b32a"))},a=function(){return r.e("components/uni-popup/uni-popup").then(r.bind(null,"4f86"))},s=function(){return r.e("components/barcode-input/barcode-input").then(r.bind(null,"d7ce"))},u=function(){return r.e("components/mpvue-picker/mpvuePicker").then(r.bind(null,"80f1"))},l=function(){return r.e("components/label-print/print-button").then(r.bind(null,"4ae8"))},c=function(){return r.e("components/uni-number-box/uni-number-box").then(r.bind(null,"e958"))},p={components:{barcodeInput:s,uniPopup:a,uniPopupModal:d,mpvuePicker:u,printButton:l,uniNumberBox:c},data:function(){var e=new Date;return{reportModel:{progNo:"",showReport:!1,isMultiPrint:!1,dataSource:[],isNeedValidTag:!1},showPrint:!1,disabled_input:!0,old:{scrollTop:0},scrollTop:0,scrollHeight:0,order:{sheetNo:"",sheetDate:"",custName1:""},det_id:0,orderItemSelected:{},orderItemSelected_input:{num:"",numQty:"",proDate:e,inLot:"",details:[{numQty:45,num:2},{numQty:5,num:1}]},pickerValueDefault:e}},onLoad:function(e){this.reportModel.progNo=e.progNo||"OPDA00001"},onReady:function(){i.default.getListHeight(this)},onBackPress:function(e){return i.default.backPress(e,this.order.details)},methods:{onScaned:function(t){var r=this;console.log(t," at pages\\purchase-temporary\\purchase-temporary.vue:223"),e.showLoading({mask:!0});var n=this;o.default.accepttempin_getDetails({data:{sheetNo:t},success:function(e){console.log(JSON.stringify(e.details[0])," at pages\\purchase-temporary\\purchase-temporary.vue:233");for(var t=0;t<e.details.length;t++){var o=e.details[t];o.scanQty=0,o.lastScanQty=o.sheetQty}e.sheetDate=new Date(e.sheetDate).format("yyyy/MM/dd"),i.default.validOrderMonth(e)?(n.order=e,n.onSelectedItem(0),i.default.showScanedAudio(),n.$refs.input_part.setFocus()):r.$refs.input_order.setFocus()},failure:function(e){n.$refs.input_order.setFocus(),i.default.showAudio()},complete:function(t,r,o){i.default.tryCatchApi({status:t,message:r}),e.hideLoading()}})},onShowPrint:function(t){if(!this.order.details)return e.showToast({title:"请先扫描单号",icon:"none"}),void this.$refs.input_order.setFocus();this.showPrint=t,t&&(this.orderItemSelected_input=this.orderItemSelected,this.orderItemSelected_input.details=[],this.orderItemSelected_input.num=1,this.orderItemSelected_input.numQty=this.orderItemSelected.sheetQty,this.orderItemSelected_input.lastQty=this.orderItemSelected.sheetQty,this.orderItemSelected_input.proDate=(new Date).format("yyyy/MM/dd"),this.orderItemSelected_input.inLot=this.orderItemSelected.inLot),this.$refs.input_part.setFocus()},onPartScaned:function(t){if(!this.order.details)return e.showToast({title:"请先扫描单号",icon:"none"}),i.default.showAudio(),void this.$refs.input_order.setFocus();var r=this;e.showLoading({mask:!0}),o.default.basic_QRCodeAnalysis({data:{qrCode:t},success:function(n){r.$refs.input_part.setFocus(),o.default.storage_RasCun({data:{tagId:n.tagId},success:function(e){},failure:function(e){i.default.showAudio()},complete:function(t,r,o){i.default.tryCatchApi({status:t,message:r}),e.hideLoading()}}),console.log(JSON.stringify(n)," at pages\\purchase-temporary\\purchase-temporary.vue:324");var d=!1,a=function(){var o=r.order.details[s];for(o.tagDetails=o.tagDetails||[],u=0;u<o.tagDetails.length;u++){var a=o.tagDetails[u];if(a.qrCode==t)return r.onScrollTop(s),e.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(e){e.confirm?(o.tagDetails.splice(u,1),r.updateScanList()):e.cancel,r.$refs.input_part.setFocus()}}),i.default.showAudio(),r.$refs.input_part.setFocus(),{v:void 0}}if(o.partItemNo==n.partItemNo)return o.purLot!=n.poMoSoLot?(c=!1,"continue"):i.default.floatObj.subtract(o.sheetQty,o.scanQty)<n.sheetQty?(e.showToast({title:"超出应收数量",icon:"none"}),i.default.showAudio(),r.onScrollTop(s),r.$refs.input_part.setFocus(),{v:void 0}):(d=!0,o.tagDetails.push({model:n,qrCode:t}),r.onScrollTop(s),r.updateScanList(),e.showToast({title:"扫描成功"}),"break")};e:for(var s=0;s<r.order.details.length;s++){var u,l=a();switch(l){case"continue":continue;case"break":break e;default:if("object"===typeof l)return l.v}}var c=!0;d?(c||(e.showToast({title:"PO不相同",icon:"none"}),i.default.showAudio(),r.onScrollTop(s),r.$refs.input_part.setFocus()),i.default.showScanedAudio()):(e.showToast({title:"扫描错误，当前标签不属于该单据",icon:"none"}),i.default.showAudio()),i.default.automateSave(r.order.details,"lastScanQty",0,r.onSave)},failure:function(e){i.default.showAudio()},complete:function(t,o,n){r.$refs.input_part.setFocus(),i.default.tryCatchApi({status:t,message:o}),e.hideLoading()}})},onSave:function(){if(void 0!=this.order.details&&0!=this.order.details.length){for(var t=0;t<this.order.details.lenfth;t++){var r=this.order.details[t];if(r.lastScanQty>0)return e.showToast({title:"该条信息未扫描"}),void this.onSelectedItem(t)}i.default.dataInit(this),e.showToast({title:"保存成功"})}},onNumAdd:function(t){var r=this;if(this.orderItemSelected_input.numQty<=0)e.showToast({title:"数量必须要大于0",icon:"none"});else{var o=i.default.floatObj.divide(this.orderItemSelected_input.lastQty,this.orderItemSelected_input.numQty),n=Math.floor(o);if(console.log(o+"="+this.orderItemSelected_input.lastQty+"/"+this.orderItemSelected_input.numQty," at pages\\purchase-temporary\\purchase-temporary.vue:456"),this.orderItemSelected_input.num=n,this.orderItemSelected_input.num<=0)e.showToast({title:"包数必须要大于0",icon:"none"});else{for(var d=0,a=0;a<this.orderItemSelected_input.details.length;a++){var s=this.orderItemSelected_input.details[a];d=i.default.floatObj.add(d,i.default.floatObj.multiply(s.num,s.numQty))}console.log(this.orderItemSelected_input.lastQty+"=("+d+"+"+this.orderItemSelected_input.numQty+"*"+this.orderItemSelected_input.num+")"," at pages\\purchase-temporary\\purchase-temporary.vue:473"),console.log(this.orderItemSelected_input.lastQty+"=("+d+"+"+this.orderItemSelected_input.numQty*this.orderItemSelected_input.num+")"," at pages\\purchase-temporary\\purchase-temporary.vue:477");var u=0;if(console.log(this.orderItemSelected_input.lastQty+"=="+this.orderItemSelected.sheetQty," at pages\\purchase-temporary\\purchase-temporary.vue:480"),this.orderItemSelected_input.lastQty==this.orderItemSelected.sheetQty){if(u=i.default.floatObj.subtract(this.orderItemSelected_input.lastQty,d+this.orderItemSelected_input.numQty*this.orderItemSelected_input.num),u<0)return e.showToast({title:"数量录入有误",icon:"none"}),void(this.orderItemSelected_input.num=1);u>0?(this.orderItemSelected_input.details.push({det_id:r.det_id,num:r.orderItemSelected_input.num,numQty:r.orderItemSelected_input.numQty,change:{num:r.orderItemSelected_input.num,max_num:r.orderItemSelected_input.num}}),r.det_id=r.det_id+1,this.orderItemSelected_input.details.push({det_id:r.det_id,num:1,numQty:u,change:{num:1,max_num:1}}),r.det_id=r.det_id+1,u=0):(this.orderItemSelected_input.details.push({det_id:r.det_id,num:r.orderItemSelected_input.num,numQty:r.orderItemSelected_input.numQty,change:{num:r.orderItemSelected_input.num,max_num:r.orderItemSelected_input.num}}),r.det_id=r.det_id+1)}else{if(u=i.default.floatObj.subtract(this.orderItemSelected_input.lastQty,this.orderItemSelected_input.numQty*this.orderItemSelected_input.num),u<0)return e.showToast({title:"数量录入有误",icon:"none"}),void(this.orderItemSelected_input.num=1);u>0&&(this.orderItemSelected_input.details.push({det_id:r.det_id,num:1,numQty:u,change:{num:1,max_num:1}}),r.det_id=r.det_id+1,u=0),this.orderItemSelected_input.details.push({det_id:r.det_id,num:r.orderItemSelected_input.num,numQty:r.orderItemSelected_input.numQty,change:{num:r.orderItemSelected_input.num,max_num:r.orderItemSelected_input.num}}),r.det_id=r.det_id+1}this.orderItemSelected_input.numQty=u,this.orderItemSelected_input.lastQty=Number(u),this.orderItemSelected_input.num=0==u?0:1}}},onSubmitPrint:function(t){if(this.orderItemSelected_input.proDate)if(this.orderItemSelected_input.inLot&&""!=this.orderItemSelected_input.inLot)if(0!=this.orderItemSelected_input.details.length){for(var r=this,o=0,n=0;n<this.orderItemSelected_input.details.length;n++){var d=this.orderItemSelected_input.details[n];o=i.default.floatObj.add(o,i.default.floatObj.multiply(d.num,d.numQty))}if(o==this.orderItemSelected.sheetQty){this.orderItemSelected.inLot=this.orderItemSelected_input.inLot,this.orderItemSelected.proDate=this.orderItemSelected_input.proDate,this.reportDataSource=[];for(var a=0,s=(new Date).format("yyMMddHHmmssfff"),u=0;u<this.orderItemSelected_input.details.length;u++)for(var l=this.orderItemSelected_input.details[u],c=0;c<l.num;c++){a++;var p={};p.partNo=this.orderItemSelected.partNo,p.partItemNo=this.orderItemSelected.partItemNo,p.partName=this.orderItemSelected.partName,p.partSpec=this.orderItemSelected.partSpec,p.serialNo="",p.tagFlag="",p.boxTagId="",p.purLot=this.orderItemSelected.purLot,p.poMoSoLot=this.orderItemSelected.purLot,p.sheetQty=l.numQty,p.tagId="".concat(s,"-").concat(i.default.getSuffix(3,a)),p.linkBoardQty="",p.inLot=this.orderItemSelected.inLot,p.proDate=new Date(r.orderItemSelected.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),p.citemNo=this.order.citemNo,p.custNo=this.order.custNo,p.custName=this.order.custName,p.ordLot="",p.custTagId="",p.reservelocus=this.orderItemSelected.reservelocus,p.proItemNo="",p.proName="",p.toProItemNo="",p.toProName="",p.dayId="",p.spcSta="",p.printType="",p.deviceNo="",p.deviceName="",p.partDefine1=l.partDefine1,p.partDefine2=l.partDefine2,p.partDefine3=l.partDefine3,p.partDefine4=l.partDefine4,p.partDefine5=l.partDefine5,p.partDefine6=l.partDefine3,p.partDefine7=l.partDefine7,p.partDefine8=l.partDefine8,p.partDefine9=l.partDefine9,p.partDefine10=l.partDefine10,console.log(p," at pages\\purchase-temporary\\purchase-temporary.vue:671"),this.reportDataSource.push(p)}this.reportModel.dataSource=this.reportDataSource,this.$refs.printBtn.execPrint()}else e.showToast({title:"请录入剩余包装数量",icon:"none"})}else e.showToast({title:"请录入包装信息",icon:"none"});else e.showToast({title:"请输入生产批次",icon:"none"});else e.showToast({title:"请输入生产日期",icon:"none"})},printComplete:function(){this.showPrint=!1},scroll:function(e){this.old.scrollTop=e.detail.scrollTop},onScrollTop:function(t){var r=this;this.onSelectedItem(t);var o=e.createSelectorQuery().in(this).select(".scroll-view-item");o.boundingClientRect(function(e){r.scrollTop=r.old.scrollTop,r.$nextTick(function(){this.scrollTop=e.height*t})}).exec()},updateScanList:function(){for(var e=0,t=0;t<this.orderItemSelected.tagDetails.length;t++)e=i.default.floatObj.add(e,this.orderItemSelected.tagDetails[t].model.sheetQty);this.orderItemSelected.scanQty=e,this.orderItemSelected.lastScanQty=i.default.floatObj.subtract(this.orderItemSelected.sheetQty,e)},onSelectedItem:function(e){for(var t=0;t<this.order.details.length;t++){var r=this.order.details[t];t==e?(r.selectItemClass="uni-list-cell-selected",this.orderItemSelected=r):r.selectItemClass=""}},showDatePicker:function(){this.$refs.mpvuePicker.show()},onPickerConfirm:function(e){this.orderItemSelected_input.proDate=new Date(e.label).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd")},num_change:function(t){if(t.newVal>0){for(var r=this.orderItemSelected_input.details.length,o=0;o<r;o++){var n=this.orderItemSelected_input.details[o];if(n.det_id==t.det_id){n.num=t.newVal;break}}for(var d=0,a=0;a<this.orderItemSelected_input.details.length;a++){var s=this.orderItemSelected_input.details[a];d=i.default.floatObj.add(d,i.default.floatObj.multiply(s.num,s.numQty))}var u=i.default.floatObj.subtract(this.orderItemSelected.sheetQty,d);if(console.log(u," at pages\\purchase-temporary\\purchase-temporary.vue:744"),!(u>=0)){e.showToast({title:"不允许超出总数！！",icon:"none"});for(r=this.orderItemSelected_input.details.length,o=0;o<r;o++){n=this.orderItemSelected_input.details[o];if(n.det_id==t.det_id){n.num-=1,n.change.num=n.num,n.change.max_num=n.num;break}}return this.orderItemSelected_input.numQty=0,this.orderItemSelected_input.lastQty=0,void(this.orderItemSelected_input.num=0)}this.orderItemSelected_input.numQty=u,this.orderItemSelected_input.lastQty=Number(u),this.orderItemSelected_input.num=1;var l=i.default.clone(this.orderItemSelected_input);this.orderItemSelected_input=l}else{for(r=this.orderItemSelected_input.details.length,o=0;o<r;o++){n=this.orderItemSelected_input.details[o];if(console.log(n.det_id+"--"+t.det_id," at pages\\purchase-temporary\\purchase-temporary.vue:781"),n.det_id==t.det_id){if(2==r){if(0==o&&n.num<=0){this.orderItemSelected_input.details=[];break}this.orderItemSelected_input.details.splice(o,1)}else this.orderItemSelected_input.details.splice(o,1);break}}d=0;for(var c=0;c<this.orderItemSelected_input.details.length;c++){var p=this.orderItemSelected_input.details[c];d=i.default.floatObj.add(d,i.default.floatObj.multiply(p.num,p.numQty))}u=this.orderItemSelected.sheetQty-d;console.log(u," at pages\\purchase-temporary\\purchase-temporary.vue:805"),u>=0?(this.orderItemSelected_input.numQty=u,this.orderItemSelected_input.lastQty=Number(u),this.orderItemSelected_input.num=1):(this.orderItemSelected_input.numQty=0,this.orderItemSelected_input.lastQty=0,this.orderItemSelected_input.num=0);l=i.default.clone(this.orderItemSelected_input);this.orderItemSelected_input=l}}}};t.default=p}).call(this,r("6e42")["default"])},6684:function(e,t,r){},"6cba":function(e,t,r){"use strict";var o=r("6684"),i=r.n(o);i.a},b208:function(e,t,r){"use strict";r.r(t);var o=r("57e6"),i=r.n(o);for(var n in o)"default"!==n&&function(e){r.d(t,e,function(){return o[e]})}(n);t["default"]=i.a}},[["6f60","common/runtime","common/vendor"]]]);