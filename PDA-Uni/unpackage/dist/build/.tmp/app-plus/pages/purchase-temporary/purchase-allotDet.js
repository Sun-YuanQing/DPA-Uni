(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/purchase-temporary/purchase-allotDet"],{9903:function(e,t,a){"use strict";a.r(t);var o=a("b756"),s=a.n(o);for(var r in o)"default"!==r&&function(e){a.d(t,e,function(){return o[e]})}(r);t["default"]=s.a},b712:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},s=[];a.d(t,"a",function(){return o}),a.d(t,"b",function(){return s})},b756:function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(a("2e17")),s=n(a("00e0")),r=n(a("f2a9")),l=n(a("409c")),i=a("2f62");function n(e){return e&&e.__esModule?e:{default:e}}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},o=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),o.forEach(function(t){d(e,t,a[t])})}return e}function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var c=new Date,h=function(){return a.e("components/barcode-input/barcode-input").then(a.bind(null,"d7ce"))},f={components:{barcodeInput:h},data:function(){return{showInLot:!1,old:{scrollTop:0},scrollTop:0,scrollHeight:0,placeholder_store:"",isStorageBin:null,binNo:"",binWhNo:"",order:{sheetNo:"",sheetDate:""},item_details:null,orderItemSelected:{},orderItemSelected_input:{inLot:""}}},onLoad:function(e){var t=this;t.order=JSON.parse(e.order),console.log(t.order," at pages\\purchase-temporary\\purchase-allotDet.vue:113"),t.item_details=l.default.clone(t.order.details);for(var a=0;a<t.order.details.length;a++){var o=t.order.details[a];o.scanQty=0,o.lastScanQty=o.sheetQty}t.isStorageBin=s.default.get(r.default.storageKeys.IsStorageBin),t.isStorageBin?t.placeholder_store="扫描储位":t.placeholder_store="扫描仓库"},onReady:function(){l.default.getListHeight(this)},onBackPress:function(e){return l.default.backPress(e,this.order.details)},methods:u({},(0,i.mapMutations)(["pageIO_true"]),{onStoreScaned:function(t){var a=this;if(!this.order.details)return e.showToast({title:"请先扫描单号",icon:"none"}),l.default.showAudio(),void this.$refs.input_order.setFocus();e.showLoading({mask:!0}),this.isStorageBin&&o.default.bas_storagebin({data:{binNo:t},success:function(t){console.log(l.default.outputLog(t)," at pages\\purchase-temporary\\purchase-allotDet.vue:154"),t.length<=0?(e.showToast({title:"货架不存在!",icon:"none"}),a.$refs.input_store.clear(),l.default.showAudio()):(a.binNo=t[0].binNo,a.binWhNo=t[0].whNo,console.log(a.binNo+"----"+a.binWhNo," at pages\\purchase-temporary\\purchase-allotDet.vue:165"),a.$refs.input_part.setFocus(),l.default.showScanedAudio())},complete:function(t,a,o){l.default.tryCatchApi({status:t,message:a}),e.hideLoading()}})},onPartScaned:function(t){var a=this,s=this;o.default.basic_QRCodeAnalysis({data:{qrCode:t},success:function(o){var i=o,n=!1,u=function(){h=l.default.clone(s.item_details[d]);var u=s.order.details[d];for(u.tagDetails=u.tagDetails||[],u.scanTagDetails=u.scanTagDetails||[],f=0;f<u.scanTagDetails.length;f++){var b=u.scanTagDetails[f];if(b.qrCode===t)return s.onScrollTop(d),e.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(e){if(e.confirm){u.scanTagDetails.splice(f,1);for(var a=0;a<u.tagDetails.length;a++){if(u.tagDetails[a].inLot.toLowerCase()==i.inLot.toLowerCase()){u.tagDetails[a].sheetQty=l.default.floatObj.subtract(u.tagDetails[a].sheetQty,i.sheetQty);for(var o=0;o<u.tagDetails[a].tagDetails.length;o++)u.tagDetails[a].tagDetails[o].qrCode===t&&u.tagDetails[a].tagDetails.splice(o,1)}u.tagDetails[a].sheetQty<=0&&u.tagDetails.splice(a,1)}s.updateScanList()}else e.cancel}}),l.default.showAudio(),{v:void 0}}if(u.partItemNo==o.partItemNo){if(0==u.lastScanQty)return"continue";if(s.onScrollTop(d),s.binWhNo!=u.whNo1)return e.showToast({title:"货架的仓库与单据上的上架仓库不一致!",icon:"none"}),a.$refs.input_store.clear(),l.default.showAudio(),{v:void 0};if(s.isStorageBin?(o.binNo1=s.binNo,o.binWhNo1=s.binWhNo):(o.binNo1=u.whNo1,o.binWhNo1=u.whNo1),o.proDate=c.format("yyyy/MM/dd hh:mm:ss")||(new Date).format("yyyy/MM/dd hh:mm:ss"),o.qrCode=t,o.purLot=h.purLot,o.sheetSta=2,o.sheetNo=h.sheetNo,o.inOutFlag=2,o.sheetLot=h.sheetLot,o.sheetType=s.order.sheetType,o.sourceType=2,o.entityState=r.default.entityState.added,n=!0,l.default.floatObj.subtract(u.sheetQty,u.scanQty)<o.sheetQty)return e.showToast({title:"超出应调拨数量",icon:"none"}),l.default.showAudio(),{v:void 0};for(u.scanTagDetails.push({model:l.default.clone(o),qrCode:t}),s.updateScanList(),p=!1,y=0;y<u.tagDetails.length;y++)u.tagDetails[y].inLot.toLowerCase()==o.inLot.toLowerCase()&&(u.tagDetails[y].sheetQty=l.default.floatObj.add(u.tagDetails[y].sheetQty,o.sheetQty),u.tagDetails[y].tagDetails=u.tagDetails[y].tagDetails||[],u.tagDetails[y].tagDetails.push(o),p=!0);if(!p){for(s.isStorageBin?(h.binNo1=s.binNo,h.binWhNo1=s.binWhNo):(h.binNo1=u.whNo1,h.binWhNo1=u.whNo1),h.sheetQty=o.sheetQty,h.sheetAmt=l.default.floatObj.multiply(o.sheetQty,h.sheetPri),h.proDate=c.format("yyyy/MM/dd hh:mm:ss")||(new Date).format("yyyy/MM/dd hh:mm:ss"),h.inLot=o.inLot,h.reservelocus=o.reservelocus,h.qrCode=t,h.sheetSta=2,h.inOutFlag=2,h.sheetType=s.order.sheetType,h.sourceType=2,l.default.clone(h),g=0,y=0;y<u.tagDetails.length;y++)u.tagDetails[y].sheetLot=u.tagDetails[y].sheetLot||u.sheetLot,g<Number(u.tagDetails[y].sheetLot.split("_")[1])&&(g=Number(u.tagDetails[y].sheetLot.split("_")[1]));if(m=u.sheetLot.split("_"),g+=1,1==g)o.sheetLot=h.sheetLot,h.entityState=r.default.entityState.modified;else switch(h.sheetAmt=l.default.floatObj.multiply(o.sheetQty,h.sheetPri),g.toString().length){case 1:h.sheetLot=m[0]+"_"+l.default.getSuffix(3,g),o.sheetLot=h.sheetLot,h.entityState=r.default.entityState.added;break;case 2:h.sheetLot=m[0]+"_"+l.default.getSuffix(2,g),o.sheetLot=h.sheetLot,h.entityState=r.default.entityState.added;break}return h.tagDetails=h.tagDetails||[],h.tagDetails.push(o),console.log(l.default.outputLog(h)," at pages\\purchase-temporary\\purchase-allotDet.vue:352"),u.tagDetails.push(h),e.showToast({title:"扫描成功"}),l.default.showScanedAudio(),"break"}}n?l.default.showScanedAudio():(e.showToast({title:"扫描错误，当前标签不属于该单据",icon:"none"}),l.default.showAudio())};e:for(var d=0;d<s.order.details.length;d++){var h,f,p,g,y,m,b=u();switch(b){case"continue":continue;case"break":break e;default:if("object"===typeof b)return b.v}}l.default.automateSave(s.order.details,"lastScanQty",0,s.onSave),a.$refs.input_part.setFocus()},failure:function(e){a.$refs.input_part.setFocus(),l.default.showAudio()},complete:function(t,a,o){l.default.tryCatchApi({status:t,message:a}),e.hideLoading()}})},onSave:function(){for(var t=this,a=this,i=0;i<a.order.details.length;i++){var n=a.order.details[i];if(n.lastScanQty>0)return e.showToast({title:"当前项,还有未扫描的数据!",icon:"none"}),void a.onScrollTop(i);a.order.entityState=r.default.entityState.modified}console.log(a.order," at pages\\purchase-temporary\\purchase-allotDet.vue:408");for(var u=a.order.details,d=[],c=0;c<a.order.details.length;c++)for(var h=a.order.details[c],f=l.default.clone(h.tagDetails),p=0;p<f.length;p++)f[p].sheetSta=2,d.push(f[p]);a.order.details=[],a.order.details=d,a.order.sourceType=2,a.order.sheetSta=2,console.log(l.default.outputLog(a.order)," at pages\\purchase-temporary\\purchase-allotDet.vue:425"),e.showLoading({mask:!0}),o.default.scmdb_Save({data:a.order,success:function(o){console.log("保存成功"," at pages\\purchase-temporary\\purchase-allotDet.vue:432"),e.showToast({title:"保存成功!"}),l.default.dataInit(t),a.pageIO_true(),a.isStorageBin=s.default.get(r.default.storageKeys.IsStorageBin),a.isStorageBin?a.placeholder_store="扫描储位":a.placeholder_store="扫描仓库"},failure:function(e){console.log("出错"," at pages\\purchase-temporary\\purchase-allotDet.vue:446"),a.order.details=u,l.default.showAudio()},complete:function(t,a,o){l.default.tryCatchApi({status:t,message:a}),e.hideLoading()}})},scroll:function(e){this.old.scrollTop=e.detail.scrollTop},onScrollTop:function(t){var a=this,o=e.createSelectorQuery().in(this).select(".scroll-view-item");o.boundingClientRect(function(e){a.scrollTop=a.old.scrollTop,a.$nextTick(function(){this.scrollTop=e.height*t})}).exec(),this.onSelectedItem(t)},onSelectedItem:function(e){for(var t=0;t<this.order.details.length;t++){var a=this.order.details[t];t==e?(a.selectItemClass="uni-list-cell-selected",this.orderItemSelected=a):a.selectItemClass=""}},updateScanList:function(){var e=0;console.log(this.orderItemSelected," at pages\\purchase-temporary\\purchase-allotDet.vue:492");for(var t=0;t<this.orderItemSelected.scanTagDetails.length;t++)e=l.default.floatObj.add(e,this.orderItemSelected.scanTagDetails[t].model.sheetQty);this.orderItemSelected.scanQty=e,this.orderItemSelected.lastScanQty=l.default.floatObj.subtract(this.orderItemSelected.sheetQty,e);var a=l.default.clone(this.orderItemSelected);this.orderItemSelected=a}})};t.default=f}).call(this,a("6e42")["default"])},e8a5:function(e,t,a){"use strict";a.r(t);var o=a("b712"),s=a("9903");for(var r in s)"default"!==r&&function(e){a.d(t,e,function(){return s[e]})}(r);var l=a("2877"),i=Object(l["a"])(s["default"],o["a"],o["b"],!1,null,null,null);t["default"]=i.exports}},[["6fd1","common/runtime","common/vendor"]]]);