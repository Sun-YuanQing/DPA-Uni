(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/purchase-temporary/purchase-return"],{d240:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(o("2e17")),r=i(o("f2a9")),n=i(o("00e0")),s=i(o("409c"));function i(t){return t&&t.__esModule?t:{default:t}}var l=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},d=function(){return Promise.all([o.e("common/vendor"),o.e("components/lotunpack/lotunpack")]).then(o.bind(null,"acb4"))},c={components:{barcodeInput:l,lotunpack:d},data:function(){return{progNo:"",old:{scrollTop:0},scrollTop:0,scrollHeight:0,showLotUnpack:!1,printMode:{},printDetail:[],order:{sheetNo:"",sheetDate:"",custName1:""},placeholder_order:"",orderItemSelected:{}}},onLoad:function(t){this.progNo=t.progNo},onReady:function(){var t=this;s.default.getListHeight(this),t.erpInterfaceType=n.default.get(r.default.storageKeys.erpInterfaceType),t.erpInterfaceType==r.default.erpInterfaceType.anfeinuo?t.placeholder_order="扫描暂收单号":t.placeholder_order="扫描暂收入库单号"},onBackPress:function(t){return s.default.backPress(t,this.order.details)},methods:{onScaned:function(e){var o=this;t.showLoading({mask:!0});var r=this;a.default.acceptreturn_getDetails({data:{sheetNo:e,fileSta:"",sheetSta:"0"},success:function(t){s.default.validOrderMonth(t)?(o.order=t,setTimeout(function(){for(var e=0;e<r.order.details.length;e++){var o=r.order.details[e];o.scanQty=0,o.inLot=o.inLot||"",o.lastScanQty=o.sheetQty,r.onScrollTop(e),r.updateScanList()}r.order.sheetDate=new Date(t.sheetDate).format("yyyy/MM/dd"),r.onSelectedItem(0)},100),o.$refs.input_part.setFocus(),s.default.showScanedAudio()):o.$refs.input_order.setFocus()},failure:function(t){o.$refs.input_order.setFocus(),s.default.showAudio()},complete:function(e,o,a){s.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onPartScaned:function(e){var o=this,r=this;if(!this.order.details)return t.showToast({title:"请先扫描单号",icon:"none"}),s.default.showAudio(),void this.$refs.input_order.setFocus();t.showLoading({mask:!0}),a.default.basic_QRCodeAnalysis({data:{qrCode:e},success:function(o){var a=!1,n=function(){var n=r.order.details[i];for(n.tagDetails=n.tagDetails||[],l=0;l<n.tagDetails.length;l++){var d=n.tagDetails[l];if(d.m_qrCode==e)return r.onScrollTop(i),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?(n.tagDetails.splice(l,1),r.updateScanList()):t.cancel}}),s.default.showAudio(),{v:void 0}}if(n.partItemNo==o.partItemNo)return n.sheetQty-n.scanQty<o.sheetQty?(r.tag_split(o,n.lastScanQty),r.onScrollTop(i),{v:void 0}):(a=!0,t.showToast({title:"扫描成功"}),n.tagDetails=n.tagDetails||[],o.m_qrCode=e,o.qrCode=n.qrCode||n.m_qrCode,n.tagDetails.push(o),r.onScrollTop(i),r.updateScanList(),"break")};t:for(var i=0;i<r.order.details.length;i++){var l,d=n();switch(d){case"break":break t;default:if("object"===typeof d)return d.v}}a?s.default.showScanedAudio():(t.showToast({title:"扫描错误，当前标签不属于该单据",icon:"none"}),s.default.showAudio()),s.default.automateSave(r.order.details,"lastScanQty",0,r.onSave)},failure:function(t){s.default.showAudio()},complete:function(e,a,r){o.$refs.input_part.setFocus(),s.default.tryCatchApi({status:e,message:a}),t.hideLoading()}})},onSave:function(){for(var e=this,o=this,i=0;i<o.order.details.length;i++){var l=o.order.details[i];if(l.lastScanQty>0)return t.showToast({title:"当前项,还有未扫描的数据!",icon:"none"}),void o.onScrollTop(i)}var d=o.convert2ScmInoutBarcodeModel(o.order);t.showLoading({mask:!0}),a.default.acceptreturn_Save({data:d,success:function(a){t.showToast({title:"保存成功!"}),s.default.dataInit(e),o.erpInterfaceType=n.default.get(r.default.storageKeys.erpInterfaceType),o.erpInterfaceType==r.default.erpInterfaceType.anfeinuo?o.placeholder_order="扫描暂收单号":o.placeholder_order="扫描暂收入库单号"},complete:function(e,o,a){s.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},convert2ScmInoutBarcodeModel:function(t){for(var e=[],o=0;o<t.details.length;o++)for(var a=t.details[o],n=0;n<a.tagDetails.length;n++){var i=a.tagDetails[n],l=s.default.clone(i);l.sheetType=t.sheetType,l.sheetNo=t.sheetNo,l.sheetLot=a.sheetLot,l.partNo=a.partNo,l.purLot=i.poMoSoLot,l.proDate=new Date(i.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),l.inoutFlag="2",l.qrCode=a.tagDetails[n].qrCode||a.tagDetails[n].m_qrCode,l.entityState=r.default.entityState.added,e.push(l)}return e},tag_split:function(t,e){var o=[];o.push({num:1,numQty:e}),o.push({num:1,numQty:s.default.floatObj.subtract(t.sheetQty,e)}),this.printMode=t,this.printDetail=o,this.showLotUnpack=!0},lotupackCancel:function(){this.printDetail=[],this.showLotUnpack=!1,this.$refs.input_part.setFocus()},printComplete:function(){this.printDetail=[],this.$refs.input_part.setFocus()},printCancel:function(){this.printDetail=[],this.showLotUnpack=!1,this.$refs.input_part.setFocus()},onSelectedItem:function(t){for(var e=0;e<this.order.details.length;e++){var o=this.order.details[e];e==t?(o.selectItemClass="uni-list-cell-selected",this.orderItemSelected=o):o.selectItemClass=""}},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var a=t.createSelectorQuery().in(this).select(".scroll-view-item");a.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,o.$nextTick(function(){this.scrollTop=t.height*e})}).exec()},updateScanList:function(){var t=0;if(this.orderItemSelected.tagDetails){for(var e=0,o=this.orderItemSelected.tagDetails.length;e<o;e++)t=s.default.floatObj.add(t,this.orderItemSelected.tagDetails[e].sheetQty);this.orderItemSelected.scanQty=t,this.orderItemSelected.lastScanQty=s.default.floatObj.subtract(this.orderItemSelected.sheetQty,t)}var a=s.default.clone(this.order);this.order=a}}};e.default=c}).call(this,o("6e42")["default"])},da62:function(t,e,o){"use strict";o.r(e);var a=o("fd13"),r=o("dd2b");for(var n in r)"default"!==n&&function(t){o.d(e,t,function(){return r[t]})}(n);var s=o("2877"),i=Object(s["a"])(r["default"],a["a"],a["b"],!1,null,null,null);e["default"]=i.exports},dd2b:function(t,e,o){"use strict";o.r(e);var a=o("d240"),r=o.n(a);for(var n in a)"default"!==n&&function(t){o.d(e,t,function(){return a[t]})}(n);e["default"]=r.a},fd13:function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},r=[];o.d(e,"a",function(){return a}),o.d(e,"b",function(){return r})}},[["744a","common/runtime","common/vendor"]]]);