(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/boxMng/box-upSN2"],{"0ce7":function(t,o,e){"use strict";e.r(o);var n=e("64cd"),a=e("5677");for(var i in a)"default"!==i&&function(t){e.d(o,t,function(){return a[t]})}(i);var s=e("2877"),u=Object(s["a"])(a["default"],n["a"],n["b"],!1,null,null,null);o["default"]=u.exports},5677:function(t,o,e){"use strict";e.r(o);var n=e("c771"),a=e.n(n);for(var i in n)"default"!==i&&function(t){e.d(o,t,function(){return n[t]})}(i);o["default"]=a.a},"64cd":function(t,o,e){"use strict";var n=function(){var t=this,o=t.$createElement;t._self._c},a=[];e.d(o,"a",function(){return n}),e.d(o,"b",function(){return a})},c771:function(t,o,e){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=s(e("2e17")),a=s(e("f2a9")),i=(s(e("00e0")),s(e("409c")));function s(t){return t&&t.__esModule?t:{default:t}}var u=function(){return e.e("components/uni-popup-modal/uni-popup-modal").then(e.bind(null,"b32a"))},l=function(){return e.e("components/label-print/print-button").then(e.bind(null,"4ae8"))},d=function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"4f86"))},r=function(){return e.e("components/barcode-input/barcode-input").then(e.bind(null,"d7ce"))},c={components:{barcodeInput:r,uniPopup:d,uniPopupModal:u,printButton:l},data:function(){return{reportModel:{progNo:"",showReport:!1,isMultiPrint:!0,dataSource:[],isNeedValidTag:!0},boxinLot:"",boxinLotFocus:!1,old:{scrollTop:0},scrollTop:0,scrollHeight:0,order:{purLot:"",partItemNo:"",partName:""},details:[],showScanTag:!1}},onLoad:function(t){this.reportModel.progNo=t.progNo},onReady:function(){i.default.getListHeight(this)},onBackPress:function(t){return i.default.backPress(t,this.details.length>0)},methods:{onScaned:function(o){var e=this;t.showLoading({mask:!0}),n.default.boxfqc_getDetail({data:{moLot:o},success:function(o){console.log(o," at pages\\boxMng\\box-upSN2.vue:137"),e.order=o,t.showToast({title:"扫描成功",icon:"none"}),i.default.showScanedAudio(),e.$refs.input_sn.setFocus()},failure:function(t){i.default.showAudio(),e.$refs.input_order.setFocus()},complete:function(o,e,n){i.default.tryCatchApi({status:o,message:e}),t.hideLoading()}})},onSNScaned:function(o){var e=this;t.showLoading({mask:!0}),n.default.Pda_pdaserialinboxvaild({data:{qrCode:o},success:function(n){if(console.log(n," at pages\\boxMng\\box-upSN2.vue:171"),n.inBoxNo.trim().length>0)t.showToast({title:"该标签已在 "+n.inBoxNo+" 箱中！",icon:"none"});else{for(var a=e,s=0;s<e.details.length;s++){var u=e.details[s];if(u.tagId==n.tagId)return a.onScrollTop(s),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?a.details.splice(s,1):t.cancel}}),void i.default.showAudio();if(u.poMoSoLot!=n.poMoSoLot)return t.showToast({title:"工单号不一致",icon:"none"}),void i.default.showAudio();if(u.binWhNo!=n.binWhNo)return t.showToast({title:"所在仓库不一致",icon:"none"}),void i.default.showAudio()}if(e.order.totalQty=e.order.totalQty||0,!(0==e.order.boxPackingQty||e.order.boxPackingQty>=i.default.floatObj.add(e.order.totalQty,n.sheetQty)))return t.showToast({title:"超出装箱数量",icon:"none"}),void i.default.showAudio();n.qrCode=o,e.details.push(n),e.onScrollTop(e.details.length-1),e.order.totalQty=i.default.floatObj.add(n.sheetQty,e.order.totalQty),t.showToast({title:"校验成功"}),i.default.showScanedAudio()}},failure:function(t){i.default.showAudio()},complete:function(o,n,a){e.$refs.input_sn.setFocus(),i.default.tryCatchApi({status:o,message:n}),t.hideLoading()}})},onSave:function(){var o=this;return o.order?0==o.details.length?(t.showToast({title:"请扫描内包装",icon:"none"}),void o.$refs.input_sn.setFocus()):o.boxinLot.trim().length<=0?(t.showToast({title:"请输入批号",icon:"none"}),i.default.showAudio(),void(this.boxinLotFocus=!0)):(this.showScanTag=!0,void this.$refs.input_scan.setFocus()):(t.showToast({title:"请扫描工单",icon:"none"}),i.default.showAudio(),void o.$refs.input_order.setFocus())},onBoxScanSave:function(o){var e=this;console.log("scanBoxTagModel: "+JSON.stringify(o)," at pages\\boxMng\\box-upSN2.vue:292"),o.bzType=1,o.purLot=this.order.purLot,o.inLot=this.boxinLot,o.entityState=a.default.entityState.added,o.tagDetails=o.tagDetails||[];for(var s=0;s<this.details.length;s++){var u=this.details[s];u.boxTagId=o.tagId,u.sheetLot=o.tagId,u.purLot=this.order.purLot,u.cuNo=o.cuNo,u.cuItemNo=o.cuItemNo,u.cuName=o.cuName,u.cuOrdNo=o.cuOrdNo,u.suPartNo=o.suPartNo,u.entityState=a.default.entityState.added,o.tagDetails.push(u)}console.log(i.default.outputLog(o)," at pages\\boxMng\\box-upSN2.vue:313"),t.showLoading({mask:!0}),n.default.Pda_pdaaddboxbarcodeserial({data:o,success:function(o){t.showToast({title:"保存成功!"}),i.default.dataInit(e),i.default.showScanedAudio(),e.$refs.input_order.setFocus()},failure:function(t){i.default.showAudio(),e.$refs.input_sn.setFocus()},complete:function(o,e,n){i.default.tryCatchApi({status:o,message:e}),t.hideLoading()}})},onTagScaned:function(o){var e=this;t.showLoading({mask:!0}),n.default.basic_QRCodeAnalysis({data:{qrCode:o},success:function(o){if(o.sheetQty!=e.order.totalQty)return t.showToast({title:"箱子数量与扫描数量不一致",icon:"none"}),void i.default.showAudio();e.onBoxScanSave(o)},failure:function(t){i.default.showAudio()},complete:function(o,n,a){e.$refs.input_scan.setFocus(),i.default.tryCatchApi({status:o,message:n}),t.hideLoading()}})},onSelectedItem:function(t){for(var o=i.default.clone(this.details),e=0;e<o.length;e++){var n=o[e];n.selectItemClass=e==t?"uni-list-cell-selected":""}this.details=o},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(o){var e=this;this.onSelectedItem(o);var n=t.createSelectorQuery().in(this).select(".scroll-view-item");n.boundingClientRect(function(t){e.scrollTop=e.old.scrollTop,e.$nextTick(function(){null!=t&&(this.scrollTop=t.height*o)})}).exec()}}};o.default=c}).call(this,e("6e42")["default"])}},[["1cce","common/runtime","common/vendor"]]]);