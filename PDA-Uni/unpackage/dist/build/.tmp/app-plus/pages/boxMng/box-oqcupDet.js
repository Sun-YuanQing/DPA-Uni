(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/boxMng/box-oqcupDet"],{"31f0":function(t,e,o){"use strict";o.r(e);var s=o("bfb3"),n=o.n(s);for(var a in s)"default"!==a&&function(t){o.d(e,t,function(){return s[t]})}(a);e["default"]=n.a},"8d12":function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement;t._self._c},n=[];o.d(e,"a",function(){return s}),o.d(e,"b",function(){return n})},be9a:function(t,e,o){"use strict";o.r(e);var s=o("8d12"),n=o("31f0");for(var a in n)"default"!==a&&function(t){o.d(e,t,function(){return n[t]})}(a);var i=o("2877"),u=Object(i["a"])(n["default"],s["a"],s["b"],!1,null,null,null);e["default"]=u.exports},bfb3:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=u(o("2e17")),n=u(o("f2a9")),a=(u(o("00e0")),u(o("409c"))),i=o("2f62");function u(t){return t&&t.__esModule?t:{default:t}}function l(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},s=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),s.forEach(function(e){r(t,e,o[e])})}return t}function r(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var c=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},d={components:{barcodeInput:c},data:function(){return{testNum:"",testNumFocus:!0,testTotal:0,old:{scrollTop:0},erpInterfaceType:null,scrollTop:0,scrollHeight:0,details:[],order:{partItemNo:"",outSpcQty:""}}},onLoad:function(t){this.order=this.urldata},onReady:function(){a.default.getListHeight(this)},onBackPress:function(t){return a.default.backPress(t,this.details.length>0)},computed:(0,i.mapState)(["urldata"]),methods:l({},(0,i.mapMutations)(["pageIO_true"]),{onTestNumChange:function(){return Number(this.testNum)<=0?(t.showToast({title:"请输入送检数量",icon:"none"}),void(this.testNumFocus=!0)):Number(this.testNum)>this.order.outSpcQty?(t.showToast({title:"应小于工单未送检数量",icon:"none"}),void(this.testNumFocus=!0)):void this.$refs.input_box.setFocus()},onBoxScaned:function(e){var o=this;if(0==Number(this.testNum))return t.showToast({title:"请输入送检数量",icon:"none"}),this.testNumFocus=!0,a.default.showAudio(),void this.$refs.input_box.setFocus();t.showLoading({mask:!0}),s.default.boxfqc_boxScan({data:{boxQrCode:e},success:function(e){var s=o;if(a.default.floatObj.add(o.testTotal,e.sheetQty)>o.testNum)return t.showToast({title:"应小于送检数量",icon:"none"}),a.default.showAudio(),void o.$refs.input_box.setFocus();if(o.order.partItemNo!=e.partItemNo)return t.showToast({title:"扫描标签上的物料与工单上的不同",icon:"none"}),a.default.showAudio(),void o.$refs.input_box.setFocus();if(console.log(o.order.whNo+"---"+e.binWhNo," at pages\\boxMng\\box-oqcupDet.vue:157"),o.order.whNo!=e.binWhNo)return t.showToast({title:"销售通知单仓库："+o.order.whNo+"与外箱仓库:"+e.binWhNo+"不一致",icon:"none"}),a.default.showAudio(),void o.$refs.input_box.setFocus();for(var n=0;n<o.details.length;n++){var i=o.details[n];if(i.tagId==e.tagId)return s.onScrollTop(n),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?(s.details.splice(n,1),s.testTotal=a.default.floatObj.subtract(s.testTotal,e.sheetQty)):t.cancel}}),a.default.showAudio(),void o.$refs.input_box.setFocus()}e.scanQty=0,e.sheetQty=Number(e.sheetQty),e.lastScanQty=e.tagDetails.length,o.details.push(e),s.testTotal=a.default.floatObj.add(s.testTotal,e.sheetQty),a.default.showScanedAudio(),o.$refs.input_part.setFocus()},failure:function(t){a.default.showAudio(),o.$refs.input_box.setFocus()},complete:function(e,o,s){a.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onPartScaned:function(e){var o=this,n=this;t.showLoading({mask:!0}),s.default.boxfqc_QRCodeAnalysis({data:{qrCode:e,enumBarCode:7},success:function(e){console.log(a.default.outputLog(e)," at pages\\boxMng\\box-oqcupDet.vue:220");for(var o={x:-1,y:-1},s=0;s<n.details.length;s++)for(var i=n.details[s],u=0;u<i.tagDetails.length;u++){var l=i.tagDetails[u];if(l.tagId==e.tagId){if(l.isScaned=l.isScaned||!1,n.onScrollTop(s),l.isScaned)return t.showToast({title:"当前标签已校验过了",icon:"none"}),a.default.showAudio(),void n.$refs.input_part.setFocus();o={x:s,y:u};break}}if(console.log(o," at pages\\boxMng\\box-oqcupDet.vue:252"),-1==o.x)return t.showToast({title:"标签扫描错误，该标签不在以下箱子中",icon:"none"}),a.default.showAudio(),void n.$refs.input_part.setFocus();t.showToast({title:"校验成功"}),a.default.showScanedAudio(),n.$refs.input_part.setFocus(),n.details[o.x].tagDetails[o.y].isScaned=!0,n.details[o.x].scanQty=a.default.floatObj.add(n.details[o.x].scanQty,1),n.details[o.x].lastScanQty=a.default.floatObj.subtract(n.details[0].tagDetails.length,n.details[o.x].scanQty),0==n.details[o.x].lastScanQty?n.$refs.input_box.setFocus():n.$refs.input_part.setFocus()},failure:function(t){a.default.showAudio(),o.$refs.input_part.setFocus()},complete:function(e,o,s){a.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onSave:function(e){var o=this;if(0==this.details.length)return t.showToast({title:"请先扫描箱标签",icon:"none"}),void this.$refs.input_box.setFocus();if(0==Number(this.testNum))return t.showToast({title:"请输入送检数量",icon:"none"}),void(this.testNumFocus=!0);if(Number(this.testNum)>this.order.outSpcQty)return t.showToast({title:"应小于工单未送检数量",icon:"none"}),void(this.testNumFocus=!0);for(var i=this,u=0,l=[],r=0;r<this.details.length;r++){if(this.details[r].lastScanQty>0)return this.onScrollTop(r),t.showToast({title:"还有未校验完的箱",icon:"none"}),a.default.showAudio(),void this.$refs.input_box.setFocus();u=a.default.floatObj.add(this.details[r].sheetQty,u);var c=a.default.clone(this.details[r]);c.purLot=c.poMoSoLot,c.entityState=n.default.entityState.added,c.tagDetails=[],l.push(c)}console.log("校验完了"," at pages\\boxMng\\box-oqcupDet.vue:337"),t.showLoading({mask:!0}),s.default.boxoqc_Post({noticeLot:this.order.sheetLot,sheetQty:this.testNum,sampleQty:u,spcCheckResult:e?1:2},{data:l,success:function(e){t.showToast({title:"校验成功"}),a.default.dataInit(o),i.pageIO_true()},failure:function(t){a.default.showAudio()},complete:function(e,o,s){a.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onSelectedItem:function(t){for(var e=a.default.clone(this.details),o=0;o<e.length;o++){var s=e[o];s.selectItemClass=o==t?"uni-list-cell-selected":""}this.details=e},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var s=t.createSelectorQuery().in(this).select(".scroll-view-item");s.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,o.$nextTick(function(){null!=t&&(this.scrollTop=t.height*e)})}).exec()}})};e.default=d}).call(this,o("6e42")["default"])}},[["8f73","common/runtime","common/vendor"]]]);