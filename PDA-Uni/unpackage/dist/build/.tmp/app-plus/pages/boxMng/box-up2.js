(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/boxMng/box-up2"],{"010e":function(o,t,e){"use strict";var a=function(){var o=this,t=o.$createElement;o._self._c},n=[];e.d(t,"a",function(){return a}),e.d(t,"b",function(){return n})},"1d45":function(o,t,e){"use strict";e.r(t);var a=e("010e"),n=e("e2ea");for(var s in n)"default"!==s&&function(o){e.d(t,o,function(){return n[o]})}(s);var i=e("2877"),l=Object(i["a"])(n["default"],a["a"],a["b"],!1,null,null,null);t["default"]=l.exports},"675d":function(o,t,e){"use strict";(function(o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=l(e("2e17")),n=l(e("f2a9")),s=l(e("00e0")),i=l(e("409c"));function l(o){return o&&o.__esModule?o:{default:o}}var u=function(){return e.e("components/barcode-input/barcode-input").then(e.bind(null,"d7ce"))},d={components:{barcodeInput:u},data:function(){return{old:{scrollTop:0},scrollTop:0,scrollHeight:0,details:[],erpInterfaceType:null,scanBoxTagModel:{partItemNo:"",partName:"",boxPackingQty:"",totalQty:0,sheetQty:0}}},onLoad:function(o){this.erpInterfaceType=s.default.get(n.default.storageKeys.erpInterfaceType),console.log(this.erpInterfaceType," at pages\\boxMng\\box-up2.vue:116")},onReady:function(){i.default.getListHeight(this)},onBackPress:function(o){return i.default.backPress(o,void 0!=this.details.partItemNo)},methods:{onBoxScaned:function(t){var e=this,s=this;o.showLoading({mask:!0}),a.default.base_scanBox({data:{qrCode:t},success:function(a){var l=s.scanBoxTagModel.totalQty||0;if(a.tagDetails.length>0)return o.showToast({title:"已装箱，不可再装！（mes有拆箱）",icon:"none"}),void i.default.showAudio();if(console.log(e.erpInterfaceType+"------"+n.default.erpInterfaceType.anfeinuo," at pages\\boxMng\\box-up2.vue:145"),e.erpInterfaceType==n.default.erpInterfaceType.anfeinuo){if(console.log(e.details[0].poMoSoLot+"工单号不一致"+a.poMoSoLot," at pages\\boxMng\\box-up2.vue:148"),e.details[0].poMoSoLot!=a.poMoSoLot)return o.showToast({title:"工单号不一致",icon:"none"}),void i.default.showAudio();if(console.log(e.details[0].inLot+"批次号不一致"+a.inLot," at pages\\boxMng\\box-up2.vue:157"),e.details[0].inLot!=a.inLot)return o.showToast({title:"批次号不一致！",icon:"none"}),void i.default.showAudio();if(console.log(e.details[0].partItemNo+"物料编码不一致"+a.partItemNo," at pages\\boxMng\\box-up2.vue:166"),e.details[0].partItemNo!=a.partItemNo)return o.showToast({title:"物料编码不一致！",icon:"none"}),void i.default.showAudio();if(console.log(e.details[0].proLot+"DC不一致"+a.proLot," at pages\\boxMng\\box-up2.vue:175"),e.details[0].proLot!=a.proLot)return o.showToast({title:"DC不一致",icon:"none"}),void i.default.showAudio();if(console.log(e.details[0].suPartNo+"客户料号不一致"+a.suPartNo," at pages\\boxMng\\box-up2.vue:184"),e.details[0].suPartNo!=a.suPartNo)return o.showToast({title:"客户料号不一致",icon:"none"}),void i.default.showAudio()}if(a.qrCode=t,s.scanBoxTagModel=a,s.scanBoxTagModel.totalQty=l,s.scanBoxTagModel.totalQty>s.scanBoxTagModel.sheetQty)return o.showToast({title:"与外箱数量不一致",icon:"none"}),void i.default.showAudio();i.default.showScanedAudio(),console.log(s.scanBoxTagModel," at pages\\boxMng\\box-up2.vue:206")},failure:function(o){i.default.showAudio()},complete:function(t,e,a){i.default.tryCatchApi({status:t,message:e}),o.hideLoading()}})},onPartScaned:function(t){var e=this;o.showLoading({mask:!0}),a.default.basic_QRCodeAnalysis({data:{qrCode:t},success:function(a){if(console.log(a.boxTagId," at pages\\boxMng\\box-up2.vue:233"),""!=a.boxTagId)return o.showToast({title:"请扫内标签",icon:"none"}),void i.default.showAudio();if(a.inBoxNo.trim().length>0)return o.showToast({title:"该标签已在 "+a.inBoxNo+" 箱中！",icon:"none"}),void i.default.showAudio();if(a.qrCode=t,e.details.length>0){if(e.details[0].inLot!=a.inLot)return o.showToast({title:"批次号不一致！",icon:"none"}),void i.default.showAudio();if(e.details[0].partItemNo!=a.partItemNo)return o.showToast({title:"物料编码不一致！",icon:"none"}),void i.default.showAudio();if(console.log(e.erpInterfaceType+"------"+n.default.erpInterfaceType.anfeinuo," at pages\\boxMng\\box-up2.vue:279"),e.erpInterfaceType==n.default.erpInterfaceType.anfeinuo){if(console.log(e.details[0]," at pages\\boxMng\\box-up2.vue:281"),console.log("DC不一致"," at pages\\boxMng\\box-up2.vue:282"),console.log(a," at pages\\boxMng\\box-up2.vue:283"),e.details[0].proLot!=a.proLot)return o.showToast({title:"DC不一致",icon:"none"}),void i.default.showAudio();if(e.details[0].suPartNo!=a.suPartNo)return o.showToast({title:"客户料号不一致",icon:"none"}),void i.default.showAudio()}}for(var s=0;s<e.details.length;s++){var l=e.details[s];if(l.tagId==a.tagId){var u=e,d=a;return u.onScrollTop(s),o.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(o){o.confirm?(u.details.splice(s,1),u.scanBoxTagModel.totalQty=i.default.floatObj.subtract(u.scanBoxTagModel.totalQty,d.sheetQty)):o.cancel}}),void i.default.showAudio()}if(console.log(l," at pages\\boxMng\\box-up2.vue:321"),console.log("工单号不一致"," at pages\\boxMng\\box-up2.vue:322"),console.log(a," at pages\\boxMng\\box-up2.vue:323"),l.poMoSoLot!=a.poMoSoLot)return o.showToast({title:"工单号不一致",icon:"none"}),void i.default.showAudio();if(l.binWhNo!=a.binWhNo)return o.showToast({title:"所在仓库不一致",icon:"none"}),void i.default.showAudio()}if(!(0==Number(e.scanBoxTagModel.boxPackingQty)||e.scanBoxTagModel.boxPackingQty>=i.default.floatObj.add(e.scanBoxTagModel.totalQty,a.sheetQty)))return o.showToast({title:"超出装箱数量",icon:"none"}),void i.default.showAudio();a.sheetQty=Number(a.sheetQty),a.qrCode=t,e.details.push(a),e.onScrollTop(e.details.length-1),e.scanBoxTagModel.totalQty=i.default.floatObj.add(a.sheetQty,e.scanBoxTagModel.totalQty),o.showToast({title:"校验成功"}),i.default.showScanedAudio()},failure:function(o){i.default.showAudio()},complete:function(t,a,n){e.$refs.input_part.setFocus(),i.default.tryCatchApi({status:t,message:a}),o.hideLoading()}})},onSave:function(){var t=this;if(this.details.length<=0)return o.showToast({title:"未添加内包装!",icon:"none"}),void i.default.showAudio();if(""==this.scanBoxTagModel.partItemNo)return o.showToast({title:"未添加外箱!",icon:"none"}),void i.default.showAudio();var e=this.scanBoxTagModel;if(this.details.length>0){if(this.details[0].partItemNo!=this.scanBoxTagModel.partItemNo)return o.showToast({title:"物料编码不一致！",icon:"none"}),void i.default.showAudio();if(this.details[0].inLot!=this.scanBoxTagModel.inLot)return o.showToast({title:"批次号不一致！",icon:"none"}),void i.default.showAudio();if(this.erpInterfaceType==n.default.erpInterfaceType.anfeinuo){if(e.proLot)e.proLot=this.details[0].proLot;else if(this.details[0].proLot!=e.proLot)return o.showToast({title:"DC不一致",icon:"none"}),void i.default.showAudio();if(e.suPartNo)e.suPartNo=this.details[0].suPartNo;else if(this.details[0].suPartNo!=e.suPartNo)return o.showToast({title:"客户料号不一致",icon:"none"}),void i.default.showAudio()}}if(e.totalQty>e.sheetQty)return o.showToast({title:"与外箱数量不一致",icon:"none"}),void i.default.showAudio();e.bzType=1,e.purLot=this.scanBoxTagModel.poMoSoLot,e.ordLot=this.details[0].ordLot,e.custNo=this.details[0].custNo,e.entityState=n.default.entityState.added;for(var s=0,l=0;l<this.details.length;l++){var u=this.details[l];u.boxTagId=e.tagId,u.sheetLot=e.tagId,u.purLot=this.scanBoxTagModel.poMoSoLot,u.entityState=n.default.entityState.added,s+=u.sheetQty,e.tagDetails=e.tagDetails||[],e.tagDetails.push(u)}if(s>e.boxPackingQty&&e.boxPackingQty>0)return o.showToast({title:"内包装数量,不能超过外箱最大包装数量!",icon:"none"}),void i.default.showAudio();console.log(e," at pages\\boxMng\\box-up2.vue:477"),o.showLoading({mask:!0}),a.default.boxIO_post({data:e,success:function(e){o.showToast({title:"保存成功!"}),i.default.dataInit(t)},failure:function(o){i.default.showAudio()},complete:function(e,a,n){t.$refs.input_part.setFocus(),i.default.tryCatchApi({status:e,message:a}),o.hideLoading()}})},onSelectedItem:function(o){for(var t=i.default.clone(this.details),e=0;e<t.length;e++){var a=t[e];a.selectItemClass=e==o?"uni-list-cell-selected":""}this.details=t},scroll:function(o){this.old.scrollTop=o.detail.scrollTop},onScrollTop:function(t){var e=this;this.onSelectedItem(t);var a=o.createSelectorQuery().in(this).select(".scroll-view-item");a.boundingClientRect(function(o){e.scrollTop=e.old.scrollTop,e.$nextTick(function(){null!=o&&(this.scrollTop=o.height*t)})}).exec()}}};t.default=d}).call(this,e("6e42")["default"])},e2ea:function(o,t,e){"use strict";e.r(t);var a=e("675d"),n=e.n(a);for(var s in a)"default"!==s&&function(o){e.d(t,o,function(){return a[o]})}(s);t["default"]=n.a}},[["48c6","common/runtime","common/vendor"]]]);