(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/boxMng/box-fqcup"],{"1b9e":function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement;t._self._c},i=[];o.d(e,"a",function(){return s}),o.d(e,"b",function(){return i})},"3c73":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=n(o("2e17")),i=n(o("f2a9")),u=(n(o("00e0")),n(o("409c")));function n(t){return t&&t.__esModule?t:{default:t}}var a=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},r={components:{barcodeInput:a},data:function(){return{testNum:"",sheetQty:"",testNumFocus:!1,sheetQtyFocus:!1,testTotal:0,old:{scrollTop:0},scrollTop:0,scrollHeight:0,boxlist:[],order:{purLot:"",partItemNo:"",receiveQty:""}}},onReady:function(){u.default.getListHeight(this)},onBackPress:function(t){return u.default.backPress(t,this.boxlist.length>0)},methods:{onScaned:function(e){var o=this;t.showLoading({mask:!0}),s.default.boxfqc_getDetail({data:{moLot:e},success:function(t){o.order=t,o.testNumFocus=!0,u.default.showScanedAudio()},failure:function(t){u.default.showAudio(),o.$refs.input_order.setFocus()},complete:function(e,o,s){u.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onTestNumBlur:function(){this.testNumFocus=!0},onsheetQtyBlur:function(){this.sheetQtyFocus=!0},onBoxScaned:function(e){var o=this;if(0==this.order.purLot.length)return t.showToast({title:"请先扫描工单批号",icon:"none"}),u.default.showAudio(),void this.$refs.input_order.setFocus();if(0==Number(this.sheetQty))return t.showToast({title:"请输入送检数量",icon:"none"}),this.sheetQtyFocus=!0,u.default.showAudio(),void this.$refs.input_box.setFocus();t.showLoading({mask:!0});var i=this;s.default.boxfqc_boxScan({data:{boxQrCode:e},success:function(e){if(Number(o.sheetQty)>Number(o.order.receiveQty))return t.showToast({title:"送检数量应小于工单未送检数量",icon:"none"}),u.default.showAudio(),void o.$refs.input_box.setFocus();if(Number(o.testNum)>Number(o.sheetQty))return t.showToast({title:"抽检数量应小于工单送检数量",icon:"none"}),u.default.showAudio(),void o.$refs.input_box.setFocus();if(o.order.partItemNo!=e.partItemNo)return t.showToast({title:"扫描标签上的物料与工单上的不同",icon:"none"}),u.default.showAudio(),void o.$refs.input_box.setFocus();for(var s=0;s<i.boxlist.length;s++){var n=i.boxlist[s];if(n.tagId==e.tagId)return i.onScrollTop(s),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?(i.boxlist.splice(s,1),i.testTotal=u.default.floatObj.subtract(i.testTotal,e.sheetQty)):t.cancel}}),u.default.showAudio(),void i.$refs.input_box.setFocus()}e.scanQty=0,e.sheetQty=Number(e.sheetQty),e.lastScanQty=Number(e.sheetQty),i.boxlist.push(e),i.testTotal=u.default.floatObj.add(i.testTotal,e.sheetQty),i.$refs.input_part.setFocus()},failure:function(t){u.default.showAudio(),i.$refs.input_box.setFocus()},complete:function(e,o,s){u.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onPartScaned:function(e){console.log(e," at pages\\boxMng\\box-fqcup.vue:242");var o=this;t.showLoading({mask:!0}),s.default.boxfqc_QRCodeAnalysis({data:{qrCode:e,enumBarCode:7},success:function(e){console.log(u.default.outputLog(e)," at pages\\boxMng\\box-fqcup.vue:254");for(var s={x:-1,y:-1},i=0;i<o.boxlist.length;i++)for(var n=o.boxlist[i],a=0;a<n.tagDetails.length;a++){var r=n.tagDetails[a];if(r.tagId==e.tagId){if(r.isScaned=r.isScaned||!1,o.onScrollTop(i),r.isScaned)return t.showToast({title:"当前标签已校验过了",icon:"none"}),u.default.showAudio(),void o.$refs.input_part.setFocus();s={x:i,y:a};break}}if(console.log(s," at pages\\boxMng\\box-fqcup.vue:286"),-1==s.x)return t.showToast({title:"标签扫描错误，该标签不在以下箱子中",icon:"none"}),u.default.showAudio(),void o.$refs.input_part.setFocus();t.showToast({title:"校验成功"}),o.boxlist[s.x].tagDetails[s.y].isScaned=!0,o.boxlist[s.x].scanQty=u.default.floatObj.add(o.boxlist[s.x].scanQty,e.sheetQty),o.boxlist[s.x].lastScanQty=u.default.floatObj.subtract(o.boxlist[s.x].lastScanQty,e.sheetQty),0==o.boxlist[s.x].lastScanQty?o.$refs.input_box.setFocus():o.$refs.input_part.setFocus()},failure:function(t){u.default.showAudio(),o.$refs.input_part.setFocus()},complete:function(e,o,s){u.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onSave:function(e){var o=this;if(Number(this.testNum)<=0)return t.showToast({title:"请输入抽检数量",icon:"none"}),this.testNumFocus=!0,void u.default.showAudio();if(Number(this.testNum)>Number(this.sheetQty))return t.showToast({title:"抽检数量不能大于送检数量",icon:"none"}),this.testNumFocus=!0,void u.default.showAudio();if(Number(this.testNum)>this.order.receiveQty)return t.showToast({title:"抽检数量应小于工单未送检数量",icon:"none"}),this.testNumFocus=!0,void u.default.showAudio();if(Number(this.testNum)>this.testTotal)return t.showToast({title:"抽检数量应小于扫描总数",icon:"none"}),this.testNumFocus=!0,void u.default.showAudio();if(Number(this.sheetQty)<=0)return t.showToast({title:"请输入送检数量",icon:"none"}),this.sheetQtyFocus=!0,void u.default.showAudio();if(Number(this.sheetQty)>this.order.receiveQty)return t.showToast({title:"送检数量应小于工单未送检数量",icon:"none"}),this.sheetQtyFocus=!0,void u.default.showAudio();if(Number(this.sheetQty)<this.testTotal)return t.showToast({title:"送检数量应>=扫描数量",icon:"none"}),this.sheetQtyFocus=!0,void u.default.showAudio();if(0==this.order.purLot.length)return t.showToast({title:"请先扫描工单批号",icon:"none"}),u.default.showAudio(),void this.$refs.input_order.setFocus();if(0==this.boxlist.length)return t.showToast({title:"请先扫描箱标签",icon:"none"}),u.default.showAudio(),void this.$refs.input_box.setFocus();for(var n=[],a=0;a<this.boxlist.length;a++){if(this.boxlist[a].lastScanQty>0)return this.onScrollTop(a),t.showToast({title:"还有未校验完的箱",icon:"none"}),u.default.showAudio(),void this.$refs.input_box.setFocus();var r=u.default.clone(this.boxlist[a]);r.entityState=i.default.entityState.added,r.tagDetails=[],n.push(r)}console.log("校验完了"," at pages\\boxMng\\box-fqcup.vue:427"),t.showLoading({mask:!0}),s.default.boxfqc_Post({purLot:this.order.purLot,sheetQty:this.sheetQty,sampleQty:this.testNum,spcCheckResult:e?1:2},{data:n,success:function(e){t.showToast({title:"校验成功"}),u.default.dataInit(o)},failure:function(t){u.default.showAudio()},complete:function(e,s,i){o.$refs.input_order.setFocus(),u.default.tryCatchApi({status:e,message:s}),t.hideLoading()}})},onSelectedItem:function(t){for(var e=u.default.clone(this.boxlist),o=0;o<e.length;o++){var s=e[o];s.selectItemClass=o==t?"uni-list-cell-selected":""}this.boxlist=e},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var s=t.createSelectorQuery().in(this).select(".scroll-view-item");s.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,o.$nextTick(function(){null!=t&&(this.scrollTop=t.height*e)})}).exec()}}};e.default=r}).call(this,o("6e42")["default"])},"9f13":function(t,e,o){"use strict";o.r(e);var s=o("3c73"),i=o.n(s);for(var u in s)"default"!==u&&function(t){o.d(e,t,function(){return s[t]})}(u);e["default"]=i.a},f4ff:function(t,e,o){"use strict";o.r(e);var s=o("1b9e"),i=o("9f13");for(var u in i)"default"!==u&&function(t){o.d(e,t,function(){return i[t]})}(u);var n=o("2877"),a=Object(n["a"])(i["default"],s["a"],s["b"],!1,null,null,null);e["default"]=a.exports}},[["57c1","common/runtime","common/vendor"]]]);