(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/boxMng/box-upSN"],{"0d53":function(t,o,e){"use strict";e.r(o);var n=e("4ea8"),a=e.n(n);for(var i in n)"default"!==i&&function(t){e.d(o,t,function(){return n[t]})}(i);o["default"]=a.a},4151:function(t,o,e){"use strict";var n=function(){var t=this,o=t.$createElement;t._self._c},a=[];e.d(o,"a",function(){return n}),e.d(o,"b",function(){return a})},"4ea8":function(t,o,e){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=r(e("2e17")),a=r(e("f2a9")),i=(r(e("00e0")),r(e("409c")));function r(t){return t&&t.__esModule?t:{default:t}}var s=function(){return e.e("components/uni-popup-modal/uni-popup-modal").then(e.bind(null,"b32a"))},u=function(){return e.e("components/label-print/print-button").then(e.bind(null,"4ae8"))},d=function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"4f86"))},l=function(){return e.e("components/barcode-input/barcode-input").then(e.bind(null,"d7ce"))},c="",f={components:{barcodeInput:l,uniPopup:d,uniPopupModal:s,printButton:u},data:function(){return{reportModel:{progNo:"",showReport:!1,isMultiPrint:!0,dataSource:[],isNeedValidTag:!0},boxinLot:"",boxinLotFocus:!1,old:{scrollTop:0},scrollTop:0,scrollHeight:0,order:{purLot:"",partItemNo:"",partName:""},details:[]}},onLoad:function(t){this.reportModel.progNo=t.progNo},onReady:function(){i.default.getListHeight(this)},onBackPress:function(t){return i.default.backPress(t,this.details.length>0)},methods:{onScaned:function(o){var e=this;t.showLoading({mask:!0}),n.default.boxfqc_getDetail({data:{moLot:o},success:function(o){console.log(o," at pages\\boxMng\\box-upSN.vue:119"),e.order=o,t.showToast({title:"扫描成功",icon:"none"}),i.default.showScanedAudio(),e.$refs.input_sn.setFocus()},failure:function(t){i.default.showAudio(),e.$refs.input_order.setFocus()},complete:function(o,e,n){i.default.tryCatchApi({status:o,message:e}),t.hideLoading()}})},onSNScaned:function(o){var e=this;t.showLoading({mask:!0}),n.default.Pda_pdaserialinboxvaild({data:{qrCode:o},success:function(n){if(console.log(n," at pages\\boxMng\\box-upSN.vue:153"),n.inBoxNo.trim().length>0)t.showToast({title:"该标签已在 "+n.inBoxNo+" 箱中！",icon:"none"});else{var a=e;if(a.order.purLot!=n.poMoSoLot)return t.showToast({title:"工单号不一致",icon:"none"}),void i.default.showAudio();e.order.totalQty=e.order.totalQty||0;for(var r=function(){var o=e.details[s];return o.tagId==n.tagId?(a.onScrollTop(s),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?(a.order.totalQty=i.default.floatObj.subtract(a.order.totalQty,o.sheetQty),a.details.splice(s,1)):t.cancel}}),i.default.showAudio(),{v:void 0}):o.binWhNo!=n.binWhNo?(t.showToast({title:"所在仓库不一致",icon:"none"}),i.default.showAudio(),{v:void 0}):void 0},s=0;s<e.details.length;s++){var u=r();if("object"===typeof u)return u.v}if(!(0==e.order.boxPackingQty||e.order.boxPackingQty>=i.default.floatObj.add(e.order.totalQty,n.sheetQty)))return t.showToast({title:"超出装箱数量",icon:"none"}),void i.default.showAudio();n.qrCode=o,e.details.push(n),e.onScrollTop(e.details.length-1),e.order.totalQty=i.default.floatObj.add(n.sheetQty,e.order.totalQty),t.showToast({title:"校验成功"}),i.default.showScanedAudio()}},failure:function(t){i.default.showAudio()},complete:function(o,n,a){e.$refs.input_sn.setFocus(),i.default.tryCatchApi({status:o,message:n}),t.hideLoading()}})},onSave:function(){var o=this;return o.order?0==o.details.length?(t.showToast({title:"请扫描内包装",icon:"none"}),void o.$refs.input_sn.setFocus()):o.boxinLot.trim().length<=0?(t.showToast({title:"请输入批号",icon:"none"}),i.default.showAudio(),void(this.boxinLotFocus=!0)):Number(o.order.totalQty)>Number(o.order.boxPackingQty)||Number(o.order.totalQty)<Number(o.order.minPackingQty)?(t.showToast({title:"包装数量为"+o.order.minPackingQty+"到"+o.order.boxPackingQty,icon:"none"}),void o.$refs.input_sn.setFocus()):(Number(o.order.totalQty)<=Number(o.order.boxPackingQty)&&Number(o.order.totalQty)>=Number(o.order.minPackingQty)&&(t.showModal({title:"是否确定封箱?",content:"包装数量为"+o.order.minPackingQty+"到"+o.order.boxPackingQty,success:function(t){if(t.confirm);else if(t.cancel)return}}),o.$refs.input_sn.setFocus()),void t.showModal({title:"提示",content:"是否确定封箱",success:function(t){if(t.confirm){var e=[],n=(new Date).format("yyMMddHHmmssfff");console.log(JSON.stringify(o.details)," at pages\\boxMng\\box-upSN.vue:287");var a={};a.partNo=o.details[0].partNo,a.partItemNo=o.details[0].partItemNo,a.partName=o.details[0].partName,a.partSpec=o.details[0].partSpec,a.purLot=o.details[0].purLot,a.inLot=o.boxinLot,a.serialNo="",a.tagFlag="",a.poMoSoLot=o.details[0].poMoSoLot,console.log(i.default.outputLog(o.order)," at pages\\boxMng\\box-upSN.vue:298"),a.sheetQty=o.order.totalQty,a.tagId="".concat(n,"-").concat(i.default.getSuffix(3,1)),a.boxTagId=a.tagId,c=a.tagId,a.LinkBoardQty="",a.proLot=o.details[0].proLot,a.proDate=(new Date).format("yyyy/MM/dd"),a.citemNo=o.details[0].citemNo,a.custNo=o.details[0].custNo,a.custName=o.details[0].custName,a.ordLot=o.order.ordLot,a.custTagId="",a.reservelocus=o.details[0].reservelocus,a.proItemNo="",a.proName="",a.toProItemNo="",a.toProName="",a.dayId="",a.spcSta="",a.printType="",a.deviceNo="",a.deviceName="",a.rountNo=o.order.rountNo,a.partSpecEn=o.order.partSpecEn,e.push(a),console.log(a," at pages\\boxMng\\box-upSN.vue:324"),o.reportModel.dataSource=e,o.$refs.printBtn.execPrint()}else t.cancel}})):(t.showToast({title:"请扫描工单",icon:"none"}),i.default.showAudio(),void o.$refs.input_order.setFocus())},onBoxScanSave:function(o){var e=this,r=this,s=o[0];console.log("scanBoxTagModel: "+JSON.stringify(s)," at pages\\boxMng\\box-upSN.vue:338"),s.bzType=1,s.purLot=r.order.purLot,s.inLot=r.boxinLot,s.boxTagId=c,s.custNo=r.details[0].custNo,s.citemNo=r.details[0].citemNo,s.custName=r.details[0].custName,s.ordLot=r.details[0].ordLot,s.entityState=a.default.entityState.added,s.tagDetails=s.tagDetails||[];for(var u=0;u<r.details.length;u++){var d=r.details[u];d.boxTagId=s.tagId,d.sheetLot=s.tagId,d.purLot=r.order.purLot,d.cuNo=s.cuNo,d.cuItemNo=s.cuItemNo,d.cuName=s.cuName,d.cuOrdNo=s.cuOrdNo,d.suPartNo=s.suPartNo,d.entityState=a.default.entityState.added,s.tagDetails.push(d)}r.details=[],console.log(i.default.outputLog(s)," at pages\\boxMng\\box-upSN.vue:364"),t.showLoading({mask:!0}),n.default.Pda_pdaaddboxbarcodeserial({data:s,success:function(o){t.showToast({title:"保存成功!"}),i.default.dataInit(e),r.$refs.input_order.setFocus()},failure:function(t){i.default.showAudio(),r.$refs.input_sn.setFocus()},complete:function(o,e,n){i.default.tryCatchApi({status:o,message:e}),t.hideLoading()}})},onSelectedItem:function(t){for(var o=i.default.clone(this.details),e=0;e<o.length;e++){var n=o[e];n.selectItemClass=e==t?"uni-list-cell-selected":""}this.details=o},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(o){var e=this;this.onSelectedItem(o);var n=t.createSelectorQuery().in(this).select(".scroll-view-item");n.boundingClientRect(function(t){e.scrollTop=e.old.scrollTop,e.$nextTick(function(){null!=t&&(this.scrollTop=t.height*o)})}).exec()}}};o.default=f}).call(this,e("6e42")["default"])},"8a36":function(t,o,e){"use strict";e.r(o);var n=e("4151"),a=e("0d53");for(var i in a)"default"!==i&&function(t){e.d(o,t,function(){return a[t]})}(i);var r=e("2877"),s=Object(r["a"])(a["default"],n["a"],n["b"],!1,null,null,null);o["default"]=s.exports}},[["ffbe","common/runtime","common/vendor"]]]);