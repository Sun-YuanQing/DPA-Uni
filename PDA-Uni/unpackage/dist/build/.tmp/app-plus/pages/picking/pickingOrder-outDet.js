(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/picking/pickingOrder-outDet"],{"3fd4":function(t,e,a){},5627:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=l(a("2e17")),n=l(a("f2a9")),o=l(a("00e0")),s=l(a("409c"));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(){return a.e("components/barcode-input/barcode-input").then(a.bind(null,"d7ce"))},r=function(){return a.e("components/uni-card/uni-card").then(a.bind(null,"f5fd"))},d=function(){return Promise.all([a.e("common/vendor"),a.e("components/lotunpack/lotunpack")]).then(a.bind(null,"acb4"))},u={components:{barcodeInput:c,uniCard:r,lotunpack:d},data:function(){return{progNo:"",showLotUnpack:!1,printMode:{},printDetail:[],isChanged:!1,old:{scrollTop:0},scrollTop:0,scrollHeight:0,details:[],isStorageBin:null}},filters:{partName:function(t){return"料号:"+t}},onLoad:function(t){this.isStorageBin=o.default.get(n.default.storageKeys.IsStorageBin),this.progNo=t.progNo||"OPDA00045",this.whNo=t.whNo||"",this.orders=t.orders||"",this.onInit(this.whNo,this.orders)},onReady:function(){s.default.getListHeight(this)},onBackPress:function(t){return s.default.backPress(t,this.details.length>0)},methods:{onInit:function(e,a){var n=this,o=this;t.showLoading({mask:!0}),i.default.pickingOrder_out_GetDetail({data:{whNo:e,moLots:a},success:function(t){o.dataInit(t)},failure:function(t){s.default.showAudio()},complete:function(e,a,i){n.$refs.input_part.setFocus(),s.default.tryCatchApi({status:e,message:a}),t.hideLoading()}})},dataInit:function(t){for(var e=this,a=0;a<t.length;a++){var i=t[a];if(i.showLotStor=!1,i.childScanQty=0,i.lastScanQty=i.qlQty,i.isFinish=!1,i.zlQLQty=i.qlQty,i.zlLastScanQty=i.lastScanQty,0!=i.bomType){for(var n=null,o=a-1;o>=0;o--)if(t[o].partItemNo==i.mitemNo&&t[o].sheetNo==i.sheetNo&&0==t[o].bomType){n=t[o];break}i.zlQLQty=n.qlQty,i.zlLastScanQty=n.lastScanQty;var l=s.default.floatObj.divide(i.zlLastScanQty,n.unitQty);i.lastScanQty=s.default.floatObj.multiply(l,i.unitQty)}e.details.push(i)}},onPartScaned:function(e){var a=this,n=this;n.isChanged=!0,t.showLoading({mask:!0}),i.default.basic_QRCodeAnalysis({data:{qrCode:e},success:function(a){a.qrCode=e;for(var i=-1,o=0;o<n.details.length;o++){var l=n.details[o];l.tagDetails=l.tagDetails||[];for(var c=0;c<l.tagDetails.length;c++){var r=l.tagDetails[c];if(r.tagId==a.tagId)return t.showToast({title:"改标签已扫描！",icon:"none"}),n.onScrollTop(o),void s.default.showAudio()}-1!=i||l.partItemNo!=a.partItemNo||l.isFinish||(i=o,n.onScrollTop(o))}if(-1==i)return t.showToast({title:"找不到该物料或该物料已完成领料！",icon:"none"}),void s.default.showAudio();var d=n.isItemUnPack(a);if(d>0){var u=[];return u.push({num:1,numQty:d}),u.push({num:1,numQty:s.default.floatObj.subtract(a.sheetQty,d)}),n.printDetail=u,n.printMode=a,void(n.showLotUnpack=!0)}a.sheetQty=Number(a.sheetQty),a.inoutFlag=2;var f=n.details[i];0!=f.bomType?(t.showModal({title:"提示",content:"当前物料为替代料，是否领料？",success:function(t){if(t.confirm)n.calcScaned(a,f),s.default.showScanedAudio();else if(t.cancel)return}}),s.default.showAudio()):(n.calcScaned(a,f),s.default.showScanedAudio())},failure:function(t){s.default.showAudio()},complete:function(e,i,n){a.$refs.input_part.setFocus(),s.default.tryCatchApi({status:e,message:i}),t.hideLoading()}})},showHideStor:function(t){t.showLotStor=!t.showLotStor},footerClick:function(e){var a=this;0!=e.totalFactQty5?t.showModal({title:"提示",content:"确定按多发料仓发料？",success:function(t){t.confirm?(a.isChanged=!0,a.calcDF(e)):t.cancel}}):t.showToast({title:"多发料仓无该物料！",icon:"none"})},onSave:function(){var e=this,a=this;if(console.log(s.default.outputLog(a.details)," at pages\\picking\\pickingOrder-outDet.vue:376"),0!=a.details.length)if(a.isChanged){var n=a.details;t.showLoading({mask:!0}),i.default.pickingOrder_out_save({data:n,success:function(t){s.default.dataInit(e),a.onInit(a.whNo,a.orders)},failure:function(t){s.default.showAudio()},complete:function(e,i,n){a.$refs.input_part.setFocus(),s.default.tryCatchApi({status:e,message:i}),t.hideLoading()}})}else t.showToast({title:"数据没有改动，无需保存！",icon:"none"});else t.showModal({title:"提示",content:"领料完成，返回上一级页面",showCancel:!1,success:function(e){e.confirm?t.navigateBack():e.cancel}})},lotupackCancel:function(){this.printDetail=[],this.showLotUnpack=!1,this.$refs.input_part.setFocus()},getCardTitle:function(t){var e=0==t.bomType?"主":"替";return e=e+" | "+(t.isFinish?"完成":"未完成"),e},calcChildQLQty:function(t){var e=this.getParentItem(t),a=s.default.floatObj.divide(e.lastScanQty,e.unitQty);t.qlQty=s.default.floatObj.multiply(a,t.unitQty)},getParentItem:function(t){for(var e=null,a=this.details.indexOf(t)-1,i=a;i>=0;i--)if(this.details[i].partItemNo==t.mitemNo&&this.details[i].sheetNo==t.sheetNo&&0==this.details[i].bomType){e=this.details[i];break}return e},calcParentChildScanQtyAndLastScanQty:function(t,e){var a=this.getParentItem(t),i=t.scanQty;e&&(i=s.default.floatObj.add(t.outPreQty5,t.scanQty));var n=s.default.floatObj.divide(i,t.unitQty),o=s.default.floatObj.multiply(n,a.unitQty);a.childScanQty=s.default.floatObj.add(a.childScanQty,o),this.calcParentLastScanQty(a)},calcParentLastScanQty:function(t){var e=s.default.floatObj.subtract(t.qlQty,t.outPreQty5),a=s.default.floatObj.subtract(e,t.childScanQty),i=s.default.floatObj.subtract(a,t.scanQty);t.lastScanQty=i,t.zlLastScanQty=i;for(var n=s.default.floatObj.divide(t.zlLastScanQty,t.unitQty),o=this.details.indexOf(t)+1,l=o;l<this.details.length;l++){if(this.details[l].mitemNo!=t.mitemNo||this.details[l].sheetNo!=t.sheetNo)break;this.details[l].zlLastScanQty=t.zlLastScanQty,this.details[l].lastScanQty=s.default.floatObj.multiply(n,this.details[l].unitQty)}},setPartItemFinish:function(t){if(!(t.lastScanQty>0)){for(var e=this.details.indexOf(t),a=e;a<this.details.length;a++){if(this.details[a].mitemNo!=t.mitemNo||this.details[a].sheetNo!=t.sheetNo)break;this.details[a].isFinish=!0}for(a=e-1;a>=0;a++){if(this.details[a].mitemNo!=t.mitemNo||this.details[a].sheetNo!=t.sheetNo)break;this.details[a].isFinish=!0}}},calcScaned:function(e,a){var i=this;if(a.scanSw=!0,i.calcDF(a),a.isFinish){for(var o=i.details.indexOf(a),l=!1,c=o+1;c<i.details.length;c++)if(i.details[c].partItemNo==a.partItemNo&&i.details[c].proItemNo==a.proItemNo&&!i.details[c].isFinish){l=!0,i.calcScaned(e,i.details[c]);break}!l&&i.details[o].totalFactQty5>0&&(i.details[o].surplusQty5=i.details[o].totalFactQty5,t.showToast({title:"该物料已全部用多发料仓领料，该标签无需扫描！",icon:"none",duration:5e3}),s.default.showAudio())}else if(a.lastScanQty>=e.sheetQty){a.lastScanQty=s.default.floatObj.subtract(a.lastScanQty,e.sheetQty),a.scanQty=s.default.floatObj.add(a.scanQty,e.sheetQty),0==a.bomType?i.calcParentLastScanQty(a):i.calcParentChildScanQtyAndLastScanQty(a,!1),i.setPartItemFinish(a);var r=s.default.clone(e);r.binNo=r.binNo.length>0?r.binNo:a.whNo,r.binWhNo=r.binWhNo.length>0?r.binWhNo:a.whNo,r.poMoSoLot=a.sheetNo,r.entityState=n.default.entityState.added,a.tagDetails.push(r)}else{a.scanQty=s.default.floatObj.add(a.scanQty,a.lastScanQty),a.lastScanQty=0,0==a.bomType?i.calcParentLastScanQty(a):i.calcParentChildScanQtyAndLastScanQty(a,!1),i.setPartItemFinish(a),e.sheetQty=s.default.floatObj.subtract(e.sheetQty,a.scanQty);var d=s.default.clone(e);d.binNo=d.binNo.length>0?d.binNo:a.whNo,d.binWhNo=d.binWhNo.length>0?d.binWhNo:a.whNo,d.poMoSoLot=a.sheetNo,d.sheetQty=a.scanQty,d.entityState=n.default.entityState.added,a.tagDetails.push(d);var u=i.details.indexOf(a),f=!1;for(c=u+1;c<i.details.length;c++)if(i.details[c].partItemNo==a.partItemNo&&i.details[c].proItemNo==a.proItemNo&&!i.details[c].isFinish){f=!0,i.calcScaned(e,i.details[c]);break}!f&&e.sheetQty>0&&(i.details[u].tagDetails[i.details[u].tagDetails.length-1].surplusQty5=e.sheetQty,i.details[u].surplusQty5=e.sheetQty)}var h=!0;for(c=0;c<i.details.length;c++)if(!i.details[c].isFinish){h=!1;break}h&&t.showModal({title:"提示",content:"领料完成是否保存？",success:function(t){t.confirm?i.onSave():t.cancel}})},calcDF:function(t){var e=this;if(0!=t.totalFactQty5){0==t.bomType||e.calcChildQLQty(t);var a=s.default.floatObj.subtract(t.qlQty,t.totalFactQty5);t.outPreQty5=a>0?t.totalFactQty5:t.qlQty,t.totalFactQty5=a>0?0:Math.abs(a),e.details.forEach(function(e){e.whNo5==t.whNo5&&e.partItemNo==t.partItemNo&&(e.totalFactQty5=t.totalFactQty5)}),0==t.bomType?e.calcParentLastScanQty(t):(t.lastScanQty=t.qlQty-t.outPreQty5-t.scanQty,e.calcParentChildScanQtyAndLastScanQty(t,!0)),e.setPartItemFinish(t)}},isItemUnPack:function(t){for(var e=this,a="",i=-1,n=0;n<e.details.length;n++)if(e.details[n].partItemNo==t.partItemNo&&!e.details[n].isFinish){a=e.details[n].proItemNo,i=n;break}if(-1==i||!e.details[i].isStkLimitSw)return 0;var o=-e.details[i].totalFactQty5;for(n=i;n<e.details.length;n++)e.details[n].partItemNo!=t.partItemNo||e.details[n].proItemNo!=a||e.details[n].isFinish||(o=s.default.floatObj.add(o,e.details[n].lastScanQty));return t.sheetQty-o},onSelectedItem:function(t){for(var e=s.default.clone(this.details),a=0;a<e.length;a++){var i=e[a];i.selectItemClass=a==t?"uni-list-cell-selected":""}this.details=e},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var a=this;this.onSelectedItem(e);var i=t.createSelectorQuery().in(this).select(".scroll-view-item");i.boundingClientRect(function(t){a.scrollTop=a.old.scrollTop,a.$nextTick(function(){null!=t&&(this.scrollTop=t.height*e)})}).exec()}}};e.default=u}).call(this,a("6e42")["default"])},b3f5:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=(t._self._c,t.__map(t.details,function(e,a){var i=t._f("partName")(e.partItemNo),n=t.getCardTitle(e);return{$orig:t.__get_orig(e),f0:i,m0:n}}));t.$mp.data=Object.assign({},{$root:{l0:a}})},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},b7df:function(t,e,a){"use strict";a.r(e);var i=a("b3f5"),n=a("c18f");for(var o in n)"default"!==o&&function(t){a.d(e,t,function(){return n[t]})}(o);a("d772");var s=a("2877"),l=Object(s["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=l.exports},c18f:function(t,e,a){"use strict";a.r(e);var i=a("5627"),n=a.n(i);for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);e["default"]=n.a},d772:function(t,e,a){"use strict";var i=a("3fd4"),n=a.n(i);n.a}},[["4cb6","common/runtime","common/vendor"]]]);