(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/picking/picking-return"],{1388:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(o("2e17")),n=a(o("f2a9")),s=a(o("00e0")),r=a(o("409c"));function a(t){return t&&t.__esModule?t:{default:t}}var u=function(){return o.e("components/authorize-input/authorize-input").then(o.bind(null,"d9d3"))},c=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},l=function(){return o.e("components/label-print/print-button").then(o.bind(null,"4ae8"))},d=function(){return o.e("components/uni-popup-modal/uni-popup-modal").then(o.bind(null,"b32a"))},h={components:{barcodeInput:c,authorizeInput:u,printButton:l,uniPopupModal:d},data:function(){return{progNo:"",sheetNo:"",old:{scrollTop:0},scrollTop:0,scrollHeight:0,details:[],placeholder_store:"",isStorageBin:null,binNo:"",binWhNo:"",showAuth:!1,curScanPartModel:{},lockModel:{lockType:2,sourceId:"",description:""},orderItemSelected:{},reportModel:{progNo:"",showReport:!1,isMultiPrint:!1,dataSource:[],isNeedValidTag:!1},showPrint:!1}},onLoad:function(t){this.progNo=t.progNo,this.reportModel.progNo=t.progNo;var e=this;e.isStorageBin=s.default.get(n.default.storageKeys.IsStorageBin),e.isStorageBin?e.placeholder_store="扫描储位":e.placeholder_store="扫描仓库",console.log(e.isStorageBin," at pages\\picking\\picking-return.vue:124")},onReady:function(){r.default.getListHeight(this)},onBackPress:function(t){return r.default.backPress(t,this.details.length>0)},methods:{onScaned:function(e){var o=this;t.showLoading({mask:!0}),i.default.picking_return({data:{purLot:e},success:function(i){if(0==i.length)return t.showToast({title:"该单据没有数据",icon:"none"}),r.default.showAudio(),void o.$refs.input_order.setFocus();o.sheetNo=e,console.log(JSON.stringify(i)," at pages\\picking\\picking-return.vue:153");for(var n=0;n<i.length;n++){var s=i[n];s.isOutReturn=!1,s.tagDetails=s.tagDetails||[],s.binNostr="",s.binNos=s.binNos||[];for(var a=0;a<s.binNos.length;a++)s.binNostr=0==a?s.binNos[a]:","+s.binNos[a];s.lastScanQty=r.default.floatObj.subtract(s.neetQty,s.sheetQty),r.default.validOrderMonth(s,!1)?o.details.push(s):o.$refs.input_order.setFocus()}if(0==o.details.length)return t.showToast({title:"当前单据不在本月，请联系管理员！",icon:"none"}),o.$refs.input_order.setFocus(),void showAudio();o.isStorageBin?o.$refs.input_store.setFocus():o.$refs.input_part.setFocus(),r.default.showScanedAudio()},failure:function(t){o.$refs.input_order.setFocus(),r.default.showAudio()},complete:function(e,o,i){r.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onScanStorage:function(e){var o=this;e.length<=0?t.showToast({title:"不能输入空值!",icon:"none"}):(t.showLoading({mask:!0}),this.isStorageBin?i.default.bas_storagebin({data:{binNo:e},success:function(e){console.log(JSON.stringify(e)," at pages\\picking\\picking-return.vue:221"),e.length<=0?(t.showToast({title:"货架不存在!",icon:"none"}),o.$refs.input_store.clear(),r.default.showAudio()):(o.binNo=e[0].binNo,o.binWhNo=e[0].whNo,o.$refs.input_part.setFocus(),r.default.showScanedAudio())},failure:function(t){o.$refs.input_store.setFocus(),r.default.showAudio()},complete:function(e,o,i){r.default.tryCatchApi({status:e,message:o}),t.hideLoading()}}):i.default.bas_wh({data:{filter:'whNo = "'+e+'"'},success:function(e){console.log(r.default.outputLog(e)," at pages\\picking\\picking-return.vue:254"),e.length<=0?(t.showToast({title:"仓库不存在!",icon:"none"}),o.$refs.input_store.clear(),r.default.showAudio()):(o.binWhNo=e[0].whNo,console.log(o.binNo+"----"+o.binWhNo," at pages\\picking\\picking-return.vue:264"),o.$refs.input_part.setFocus(),r.default.showScanedAudio())},complete:function(e,o,i){r.default.tryCatchApi({status:e,message:o}),t.hideLoading()}}))},onPartScaned:function(e){var o=this,s=this;return 0==this.sheetNo.trim().length?(t.showToast({title:"请先扫描单号",icon:"none"}),r.default.showAudio(),void this.$refs.input_order.setFocus()):this.isStorageBin&&""==this.binNo.trim()?(t.showToast({title:"请扫描货架",icon:"none"}),void this.$refs.input_store.setFocus()):(t.showLoading({mask:!0}),void i.default.basic_QRCodeAnalysis({data:{qrCode:e},success:function(i){i.qrCode=e,o.curScanPartModel=r.default.clone(i);var a=!1,u=function(){var e=o.details[c];for(e.tagDetails=e.tagDetails||[],l=0;l<e.tagDetails.length;l++){var u=e.tagDetails[l];if(u.tagId==i.tagId)return o.onScrollTop(c),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?(e.tagDetails.splice(l,1),s.updateScanList()):t.cancel}}),r.default.showAudio(),{v:void 0}}if(e.partItemNo==i.partItemNo){if(r.default.floatObj.subtract(e.neetQty,e.sheetQty)<Number(i.sheetQty))return t.showToast({title:"超出待退数量",icon:"none"}),r.default.showAudio(),o.onScrollTop(c),{v:void 0};i.tagDetails?i.tagDetails.forEach(function(t){s.isStorageBin?(t.binNo=s.binNo,t.binWhNo=s.binWhNo):(i.binNo=e.whNo1,i.binWhNo=e.whNo1),t.sheetQty=Number(i.sheetQty)}):(s.isStorageBin?(i.binNo=s.binNo,i.binWhNo=s.binWhNo):(i.binNo=e.whNo1,i.binWhNo=e.whNo1),i.sheetQty=Number(i.sheetQty)),a=!0,t.showToast({title:"扫描成功"});var d=s.convert2ScmInoutBarcodeModel(e,i,s);return d.forEach(function(t){e.tagDetails.push(t)}),e.entityState=n.default.entityState.modified,e.sheetSta="2",o.onScrollTop(c),o.updateScanList(),"break"}};t:for(var c=0;c<o.details.length;c++){var l,d=u();switch(d){case"break":break t;default:if("object"===typeof d)return d.v}}a?(r.default.showScanedAudio(),r.default.automateSave(s.details,"lastScanQty",0,s.onSave)):(t.showToast({title:"扫描错误，当前标签不属于该单据",icon:"none"}),r.default.showAudio())},failure:function(t){r.default.showAudio()},complete:function(e,i,n){o.$refs.input_part.setFocus(),r.default.tryCatchApi({status:e,message:i}),t.hideLoading()}}))},updateScanList:function(){for(var t=0,e=0;e<this.orderItemSelected.tagDetails.length;e++)t=r.default.floatObj.add(t,this.orderItemSelected.tagDetails[e].sheetQty);this.orderItemSelected.sheetQty=t,this.orderItemSelected.lastScanQty=r.default.floatObj.subtract(this.orderItemSelected.neetQty,t)},onSave:function(){if(0==this.details.length)return t.showToast({title:"请扫描单号！",icon:"none"}),void this.$refs.input_order.setFocus();for(var e=!0,o=!1,n=0;n<this.details.length;n++){var s=this.details[n];if(!o&&s.sheetQty>0&&(o=!0),o&&s.lastScanQty>0){e=!1,this.onScrollTop(n);break}}if(!e)return t.showToast({title:"退料未完成不能过账！",icon:"none"}),void this.$refs.input_part.setFocus();if(!o)return this.lockModel.description="请授权过账",this.lockModel.sourceId=this.sheetNo,void(this.showAuth=!0);var a=this,u=r.default.clone(this.details);console.log(": "+JSON.stringify(u)," at pages\\picking\\picking-return.vue:473"),t.showLoading({mask:!0}),i.default.picking_out_save({data:u,success:function(e){t.showToast({title:"过账成功"}),r.default.dataInit(a),a.isStorageBin&&a.$refs.input_store.clear(),a.$refs.input_order.clear(),a.$refs.input_order.setFocus(),a.isStorageBin?a.placeholder_store="扫描储位":a.placeholder_store="扫描仓库"},complete:function(e,o,i){r.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},convert2ScmInoutBarcodeModel:function(t,e,o){var i=[];if(!e.tagDetails){a={};return a.sheetType=t.sheetType,a.sheetNo=t.sheetNo,a.sheetLot=t.sheetLot,a.partNo=e.partNo,a.purLot=e.poMoSoLot,a.proLot=e.proLot,a.sheetQty=e.sheetQty,a.inLot=e.inLot,a.proDate=e.proDate,a.tagId=e.tagId,a.boxTagId=e.boxTagId,a.custTagId=e.custTagId,a.ordLot=e.ordLot,a.custNo=e.custNo,o.isStorageBin?(a.binNo=o.binNo,a.binWhNo=o.binWhNo):(a.binNo=e.whNo,a.binWhNo=e.whNo),a.qrCode=e.qrCode,a.inoutFlag="1",a.entityState=n.default.entityState.added,i.push(a),i}for(var s=0;s<e.tagDetails.length;s++){var r=e.tagDetails[s],a={};return a.sheetType=t.sheetType,a.sheetNo=t.sheetNo,a.sheetLot=t.sheetLot,a.partNo=r.partNo,a.purLot=r.poMoSoLot,a.proLot=r.proLot,a.sheetQty=r.sheetQty,a.inLot=r.inLot,a.proDate=r.proDate,a.tagId=r.tagId,a.boxTagId=r.boxTagId,a.custTagId=r.custTagId,a.ordLot=r.ordLot,a.custNo=r.custNo,o.isStorageBin?(a.binNo=o.binNo,a.binWhNo=o.binWhNo):(a.binNo=r.whNo,a.binWhNo=r.whNo),a.qrCode=r.qrCode,a.inoutFlag="1",a.entityState=n.default.entityState.added,i.push(a),i}},onShowPrint:function(e){return console.log("弹出框 显示/取消"," at pages\\picking\\picking-return.vue:574"),this.details?this.orderItemSelected.selectItemClass?(e||(this.showPrint=e),void(this.orderItemSelected.inLot&&""!=this.orderItemSelected.inLot?this.onSubmitPrint():this.showPrint=e)):(t.showToast({title:"请选择打印对象！！！",icon:"none"}),r.default.showAudio(),void this.$refs.input_part.setFocus()):(t.showToast({title:"请先扫描单号",icon:"none"}),void r.default.showAudio())},onSubmitPrint:function(t){console.log("弹出框 确定"," at pages\\picking\\picking-return.vue:605"),console.log(this.orderItemSelected," at pages\\picking\\picking-return.vue:606");var e=1,o=(new Date).format("yyMMddHHmmssfff"),i={};i.proDate=this.orderItemSelected.proDate?new Date(this.orderItemSelected.proDate).format("yyyy/MM/dd"):(new Date).format("yyyy/MM/dd"),i.partNo=this.orderItemSelected.partNo,i.partItemNo=this.orderItemSelected.partItemNo,i.partName=this.orderItemSelected.partName,i.partSpec=this.orderItemSelected.partSpec,i.serialNo="",i.tagFlag="",i.boxTagId="",i.purLot=this.orderItemSelected.purLot,i.poMoSoLot=this.orderItemSelected.purLot,i.sheetQty=this.orderItemSelected.sheetQty,i.tagId="".concat(o,"-").concat(r.default.getSuffix(3,e)),i.linkBoardQty="",i.inLot=this.orderItemSelected.inLot,i.citemNo=this.orderItemSelected.citemNo,i.custNo=this.orderItemSelected.custNo,i.custName=this.orderItemSelected.custName,i.ordLot="",i.custTagId="",i.reservelocus=this.orderItemSelected.reservelocus,i.proItemNo="",i.proName="",i.toProItemNo="",i.toProName="",i.dayId="",i.spcSta="",i.printType="",i.deviceNo="",i.deviceName="",console.log(i," at pages\\picking\\picking-return.vue:643"),this.reportModel.dataSource.push(i),this.$refs.printBtn.execPrint()},printComplete:function(){console.log("printComplete"," at pages\\picking\\picking-return.vue:648"),this.showPrint=!1},onprintCancel:function(){console.log("onprintCancel"," at pages\\picking\\picking-return.vue:652"),this.showPrint=!1,this.reportModel.dataSource=[]},tagValid:function(){console.log("tagValid"," at pages\\picking\\picking-return.vue:658")},onSelectedItem:function(t){for(var e=0;e<this.details.length;e++){var o=this.details[e];e==t?(o.selectItemClass="uni-list-cell-selected",this.orderItemSelected=o,console.log(this.orderItemSelected," at pages\\picking\\picking-return.vue:667")):o.selectItemClass=""}},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var i=t.createSelectorQuery().in(this).select(".scroll-view-item");i.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,o.$nextTick(function(){this.scrollTop=t.height*e})}).exec()},authClick:function(e){var o=this;this.showAuth=!1,t.showLoading({mask:!0}),i.default.picking_return_lockScreen_post({data:{mesLockscreen:e,sheetNo:this.sheetNo},success:function(e){t.showToast({title:"过账成功"}),o.$refs.input_store.clear(),o.$refs.input_order.clear(),o.$refs.input_order.setFocus(),o.details=[]},complete:function(e,i,n){o.$refs.input_order.setFocus(),r.default.tryCatchApi({status:e,message:i}),t.hideLoading()}})}}};e.default=h}).call(this,o("6e42")["default"])},1508:function(t,e,o){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},n=[];o.d(e,"a",function(){return i}),o.d(e,"b",function(){return n})},c980:function(t,e,o){"use strict";o.r(e);var i=o("1508"),n=o("cd1d");for(var s in n)"default"!==s&&function(t){o.d(e,t,function(){return n[t]})}(s);var r=o("2877"),a=Object(r["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=a.exports},cd1d:function(t,e,o){"use strict";o.r(e);var i=o("1388"),n=o.n(i);for(var s in i)"default"!==s&&function(t){o.d(e,t,function(){return i[t]})}(s);e["default"]=n.a}},[["9b2b","common/runtime","common/vendor"]]]);