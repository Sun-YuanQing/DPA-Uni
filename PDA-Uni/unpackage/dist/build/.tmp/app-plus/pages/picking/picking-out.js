(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/picking/picking-out"],{"0b2d":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=r(o("2e17")),n=r(o("f2a9")),i=r(o("00e0")),s=r(o("409c"));function r(t){return t&&t.__esModule?t:{default:t}}var u=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},l=function(){return o.e("components/authorize-input/authorize-input").then(o.bind(null,"d9d3"))},c=function(){return Promise.all([o.e("common/vendor"),o.e("components/lotunpack/lotunpack")]).then(o.bind(null,"acb4"))},d={components:{barcodeInput:u,authorizeInput:l,lotunpack:c},data:function(){return{progNo:"",purLot:"",old:{scrollTop:0},scrollTop:0,scrollHeight:0,isStorageBin:null,details:[],proOutDetails:[],showAuth:!1,showLotUnpack:!1,printMode:{},printDetail:[],curScanPartModel:{},lockModel:{lockType:2,sourceId:"",description:""}}},onLoad:function(t){this.progNo=t.progNo||"OPDA00012",this.isStorageBin=i.default.get(n.default.storageKeys.IsStorageBin),console.log(this.progNo," at pages\\picking\\picking-out.vue:107")},onReady:function(){s.default.getListHeight(this)},onBackPress:function(t){return s.default.backPress(t,this.details.length>0)},methods:{onScaned:function(e){var o=this;t.showLoading({mask:!0}),a.default.picking_out({data:{purLot:e},success:function(a){if(0==a.length)return t.showToast({title:"该工单没有数据",icon:"none"}),void s.default.showAudio();o.purLot=e,console.log(JSON.stringify(a)," at pages\\picking\\picking-out.vue:136");for(var n=0;n<a.proOut2Models.length;n++){var i=a.proOut2Models[n];i.isOutReturn=!0,i.tagDetails=i.tagDetails||[]}for(n=0;n<a.prooutsumByPart.length;n++){i=a.prooutsumByPart[n];i.sheetQty=0,console.log(JSON.stringify(i)," at pages\\picking\\picking-out.vue:146"),i.lastScanQty=s.default.floatObj.subtract(i.neetQty,i.sheetQty)}o.details=a.prooutsumByPart,o.proOutDetails=a.proOut2Models,o.$refs.input_part.setFocus(),s.default.showScanedAudio()},failure:function(t){o.$refs.input_order.clear(),o.$refs.input_order.setFocus(),s.default.showAudio()},complete:function(e,o,a){s.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onPartScaned:function(e){var o=this;if(0==this.purLot.trim().length)return t.showToast({title:"请先扫描工单号",icon:"none"}),s.default.showAudio(),void this.$refs.input_order.setFocus();t.showLoading({mask:!0}),a.default.picking_lockScreen_valid({data:{purLot:o.purLot,qrCode:e},success:function(t){var a=JSON.parse(t.resultNote);a.qrCode=e,o.curScanPartModel=s.default.clone(a);var n=null;"-11"==t.resultCode&&(n=t.resultText),o.scanAdd(o.curScanPartModel,n),s.default.showScanedAudio()},failure:function(t){s.default.showAudio()},complete:function(e,a,n){o.$refs.input_part.setFocus(),s.default.tryCatchApi({status:e,message:a}),t.hideLoading()}})},scanAdd:function(e,o){for(var a=this,i=[],r=[],u=0;u<this.proOutDetails.length;u++){for(var l=this.proOutDetails[u],c=0;c<l.tagDetails.length;c++){var d=l.tagDetails[c];d.tagId==e.tagId&&d.entityState!=n.default.entityState.deleted&&r.push(l)}l.partItemNo==e.partItemNo&&i.push(l)}if(r.length>0){var h=this.getParentItem(r[0].partNo);return this.onScrollTop(h),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){if(t.confirm)for(var o=a.details[h],i=0;i<r.length;i++)for(var u=r[i],l=0;l<u.tagDetails.length;l++){var c=u.tagDetails[l];c.tagId==e.tagId&&(u.sheetQty=s.default.floatObj.subtract(u.sheetQty,c.sheetQty),o.sheetQty=s.default.floatObj.subtract(o.sheetQty,c.sheetQty),o.lastScanQty=s.default.floatObj.subtract(o.neetQty,o.sheetQty),c.id>0?c.entityState=n.default.entityState.deleted:u.tagDetails.splice(l,1))}else t.cancel}}),void s.default.showAudio()}if(0==i.length)return t.showToast({title:"扫描错误，当前标签不属于该单据",icon:"none"}),void s.default.showAudio();var f=this.getParentItem(i[0].partNo);this.onScrollTop(f);var p=this.details[f],g=s.default.floatObj.subtract(p.neetQty,p.sheetQty);if(0==g)return t.showToast({title:"该物料已领完，不需要再领！",icon:"none"}),void s.default.showAudio();var v=Number(e.sheetQty);if(v>g){var y=[];return y.push({num:1,numQty:g}),y.push({num:1,numQty:s.default.floatObj.subtract(v,g)}),this.printMode=e,this.printDetail=y,void(this.showLotUnpack=!0)}if(console.log(o," at pages\\picking\\picking-out.vue:318"),o&&o.length>0){var b="";for(u=0;u<this.proOutDetails.length;u++){var m=this.proOutDetails[u];if(m.partItemNo==e.partItemNo){b=m.sheetLot;break}}return this.lockModel.description=o,this.lockModel.sourceId=b,void(this.showAuth=!0)}for(var S=0;S<i.length;S++){var k=i[S],Q=s.default.floatObj.subtract(k.neetQty,k.sheetQty);if(v>0&&Q>0){var N=s.default.clone(e);v>=Q?(k.sheetQty=s.default.floatObj.add(k.sheetQty,Q),p.sheetQty=s.default.floatObj.add(p.sheetQty,Q),v=s.default.floatObj.subtract(v,Q),N.sheetQty=Q):(N.sheetQty=Number(v),k.sheetQty=s.default.floatObj.add(k.sheetQty,v),p.sheetQty=s.default.floatObj.add(p.sheetQty,v),v=0),p.lastScanQty=s.default.floatObj.subtract(p.neetQty,p.sheetQty),N.entityState=n.default.entityState.added,k.tagDetails.push(this.convert2ScmInoutBarcodeModel(k,N,a)),k.sheetSta=2,k.entityState=n.default.entityState.modified}}},getParentItem:function(t){for(var e=-1,o=0;o<this.details.length;o++)if(this.details[o].partNo==t){e=o;break}return e},onSave:function(){for(var e=this,o=!0,a=0;a<this.details.length;a++){var n=this.details[a];if(n.lastScanQty>0){o=!1;break}}console.log(o," at pages\\picking\\picking-out.vue:390"),o?e.onSave1():t.showModal({title:"提示",content:"当前项，还有未扫描的数据，是否保存？",success:function(t){if(t.confirm)e.onSave1();else if(t.cancel)return}})},onSave1:function(e,o){var n=this;e=e||"保存成功",o=o||0;var i=s.default.clone(this.proOutDetails);t.showLoading({mask:!0}),a.default.picking_out_save({data:i,success:function(a){switch(t.showToast({title:e}),o){case 0:n.$refs.input_order.setFocus(),s.default.dataInit(n);break;case 1:n.onScaned(n.purLot);break}},complete:function(e,o,a){s.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},convert2ScmInoutBarcodeModel:function(t,e,o){var a={};return a.sheetType=t.sheetType,a.sheetNo=t.sheetNo,a.sheetLot=t.sheetLot,a.partNo=e.partNo,a.purLot=e.poMoSoLot,a.proLot=e.proLot,a.sheetQty=e.sheetQty,a.inLot=e.inLot,a.proDate=e.proDate,a.tagId=e.tagId,a.ordLot=e.ordLot,a.custNo=e.custNo,o.isStorageBin?(a.binNo=e.binNo,a.binWhNo=e.binWhNo):(a.binNo=e.binWhNo,a.binWhNo=e.binWhNo),a.inoutFlag="2",a.qrCode=e.qrCode,a.entityState=n.default.entityState.added,a},onSelectedItem:function(t){for(var e=0;e<this.details.length;e++){var o=this.details[e];o.selectItemClass=e==t?"uni-list-cell-selected":""}},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var a=t.createSelectorQuery().in(this).select(".scroll-view-item");a.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,o.$nextTick(function(){this.scrollTop=t.height*e})}).exec()},lotupackCancel:function(){this.showLotUnpack=!1,this.$refs.input_part.setFocus()},authClick:function(t){this.showAuth=!1;for(var e=0;e<this.proOutDetails.length;e++){var o=this.proOutDetails[e];if(o.partItemNo==this.curScanPartModel.partItemNo){o.locklogDetails=[t];break}}1==t.resultSta?(this.scanAdd(this.curScanPartModel),this.onSave1("提交成功",1)):this.onSave1("提交成功",2),this.$refs.input_part.setFocus()}}};e.default=d}).call(this,o("6e42")["default"])},a8ca:function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},n=[];o.d(e,"a",function(){return a}),o.d(e,"b",function(){return n})},dd57:function(t,e,o){"use strict";o.r(e);var a=o("a8ca"),n=o("eeb5");for(var i in n)"default"!==i&&function(t){o.d(e,t,function(){return n[t]})}(i);var s=o("2877"),r=Object(s["a"])(n["default"],a["a"],a["b"],!1,null,null,null);e["default"]=r.exports},eeb5:function(t,e,o){"use strict";o.r(e);var a=o("0b2d"),n=o.n(a);for(var i in a)"default"!==i&&function(t){o.d(e,t,function(){return a[t]})}(i);e["default"]=n.a}},[["82500","common/runtime","common/vendor"]]]);