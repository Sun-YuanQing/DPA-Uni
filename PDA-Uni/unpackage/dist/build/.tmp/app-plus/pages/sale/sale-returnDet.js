(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/sale/sale-returnDet"],{"0c79":function(t,e,o){"use strict";o.r(e);var n=o("ac6b"),s=o.n(n);for(var a in n)"default"!==a&&function(t){o.d(e,t,function(){return n[t]})}(a);e["default"]=s.a},3930:function(t,e,o){"use strict";o.r(e);var n=o("b052"),s=o("0c79");for(var a in s)"default"!==a&&function(t){o.d(e,t,function(){return s[t]})}(a);var i=o("2877"),r=Object(i["a"])(s["default"],n["a"],n["b"],!1,null,null,null);e["default"]=r.exports},ac6b:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=l(o("2e17")),s=l(o("f2a9")),a=l(o("00e0")),i=l(o("409c")),r=o("2f62");function l(t){return t&&t.__esModule?t:{default:t}}function u(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),n.forEach(function(e){d(t,e,o[e])})}return t}function d(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var c=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},h={components:{barcodeInput:c},data:function(){return{progNo:"",old:{scrollTop:0},scrollTop:0,scrollHeight:0,placeholder_store:"",isStorageBin:null,binNo:"",binWhNo:"",order:{sheetNo:"",partItemNo:"",sheetQty:"",binNostr:"",whName:""},details:[],scanTotalQty:0}},onLoad:function(t){var e=t.sheetLot||"";this.init(e);var o=this;this.isStorageBin=a.default.get(s.default.storageKeys.IsStorageBin),this.isStorageBin?o.placeholder_store="扫描储位":o.placeholder_store="扫描仓库"},onReady:function(){i.default.getListHeight(this)},onBackPress:function(t){return i.default.backPress(t,this.details.length>0)},methods:u({},(0,r.mapMutations)(["pageIO_true"]),{init:function(e){var o=this;t.showLoading({mask:!0}),n.default.sale_getDetails({data:{sheetLot:e},success:function(t){console.log(JSON.stringify(t)," at pages\\sale\\sale-returnDet.vue:151"),t.binNostr="",t.binNos=t.binNos||[];for(var e=0;e<t.binNos.length;e++)t.binNostr=0==e?t.binNos[e]:","+t.binNos[e];o.order=t},complete:function(e,o,n){i.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onScanStorage:function(e){var o=this;e.length<=0?t.showToast({title:"不能输入空值!",icon:"none"}):(t.showLoading({mask:!0}),this.isStorageBin&&n.default.bas_storagebin({data:{binNo:e},success:function(e){e.length<=0?(t.showToast({title:"货架不存在!",icon:"none"}),o.$refs.input_store.clear(),i.default.showAudio()):(o.binNo=e[0].binNo,o.binWhNo=e[0].whNo,o.$refs.input_part.setFocus(),i.default.showScanedAudio())},failure:function(t){o.$refs.input_store.setFocus(),i.default.showAudio()},complete:function(e,o,n){i.default.tryCatchApi({status:e,message:o}),t.hideLoading()}}))},onPartScaned:function(e){var o=this;if(t.showLoading({mask:!0}),this.isStorageBin&&""==this.binNo.trim())return t.showToast({title:"请先扫描货架",icon:"none"}),this.$refs.input_store.setFocus(),void i.default.showAudio();var s=this;n.default.OpenMes_mesqrcodeinout({data:{qrCode:e},success:function(n){if(o.order.partItemNo!=n.partItemNo)return t.showToast({title:"标签扫描错误",icon:"none"}),void i.default.showAudio();for(var a=0;a<o.details.length;a++){var r=o.details[a];if(r.tagId==n.tagId)return o.onScrollTop(a),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?(s.details.splice(a,1),s.scanTotalQty=i.default.floatObj.subtract(s.scanTotalQty,n.sheetQty)):t.cancel}}),void i.default.showAudio()}if(i.default.floatObj.add(s.scanTotalQty,n.sheetQty)>s.order.sheetQty)return t.showToast({title:"超出退货数量",icon:"none"}),void i.default.showAudio();t.showToast({title:"扫描成功"}),n.tagDetails?n.tagDetails.forEach(function(t){t.qrCode=e,s.isStorageBin?(t.binNo=s.binNo,t.binWhNo=s.binWhNo):(t.binNo=s.order.whNo,t.binWhNo=s.order.whNo)}):(n.qrCode=e,s.isStorageBin?(n.binNo=s.binNo,n.binWhNo=s.binWhNo):(n.binNo=s.order.whNo,n.binWhNo=s.order.whNo)),s.details.push(n),s.scanTotalQty=i.default.floatObj.add(s.scanTotalQty,n.sheetQty),o.onScrollTop(s.details.length-1),i.default.showScanedAudio()},failure:function(t){i.default.showAudio()},complete:function(e,n,s){o.$refs.input_part.setFocus(),i.default.tryCatchApi({status:e,message:n}),t.hideLoading()}})},onSave:function(){var e=this;if(this.order.sheetQty==this.scanTotalQty){for(var o=this,a=[],r=0;r<this.details.length;r++){var l=this.details[r];if(l.tagDetails)for(var u=l.tagDetails.length,d=0;d<u;d++){var c=l.tagDetails[d],h={};h.sheetType=this.order.sheetType,h.sheetNo=this.order.sheetNo,h.sheetLot=this.order.sheetLot,h.partNo=c.partNo,h.purLot=c.poMoSoLot,h.proLot=c.proLot,h.sheetQty=c.sheetQty,h.inLot=c.inLot,h.proDate=c.proDate,h.tagId=c.tagId,h.boxTagId=c.boxTagId,h.custTagId=c.custTagId,h.ordLot=c.ordLot,h.custNo=c.custNo,h.binNo=c.binNo,h.binWhNo=c.binWhNo,h.qrCode=c.qrCode,h.inoutFlag="1",h.entityState=s.default.entityState.added,a.push(h)}else{h={};h.sheetType=this.order.sheetType,h.sheetNo=this.order.sheetNo,h.sheetLot=this.order.sheetLot,h.partNo=l.partNo,h.purLot=l.poMoSoLot,h.proLot=l.proLot,h.sheetQty=l.sheetQty,h.inLot=l.inLot,h.proDate=l.proDate,h.tagId=l.tagId,h.boxTagId=l.boxTagId,h.custTagId=l.custTagId,h.ordLot=l.ordLot,h.custNo=l.custNo,h.binNo=l.binNo,h.binWhNo=l.binWhNo,h.qrCode=l.qrCode,h.inoutFlag="1",h.entityState=s.default.entityState.added,a.push(h)}}this.order.tagDetails=a,this.order.sheetSta=2,this.order.entityState=s.default.entityState.modified;var f=[];f.push(this.order),console.log(i.default.outputLog(f)," at pages\\sale\\sale-returnDet.vue:386"),t.showLoading({title:"加载中",mask:!0}),n.default.sale_save_put({data:f,success:function(n){t.showToast({title:"保存成功"}),o.pageIO_true(),i.default.dataInit(e),o.isStorageBin?o.placeholder_store="扫描储位":o.placeholder_store="扫描仓库"},failure:function(t){i.default.showAudio()},complete:function(e,o,n){i.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})}else t.showToast({title:"还有未上架的物料",icon:"none"})},onSelectedItem:function(t){for(var e=0;e<this.details.length;e++){var o=this.details[e];e==t?(o.selectItemClass="uni-list-cell-selected",this.orderItemSelected=o):o.selectItemClass=""}},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var n=t.createSelectorQuery().in(this).select(".scroll-view-item");n.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,null!=t&&o.$nextTick(function(){this.scrollTop=t.height*e})}).exec()}})};e.default=h}).call(this,o("6e42")["default"])},b052:function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},s=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return s})}},[["99a9","common/runtime","common/vendor"]]]);