(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/sale/sale-hwtagDet"],{"18b0":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(a("2e17")),o=i(a("f2a9")),l=i(a("00e0")),n=i(a("409c")),r=a("2f62");function i(t){return t&&t.__esModule?t:{default:t}}var d=function(){return a.e("components/barcode-input/barcode-input").then(a.bind(null,"d7ce"))},u={components:{barcodeInput:d},data:function(){return{progNo:"",old:{scrollTop:0},scrollTop:0,scrollHeight:0,order:{},hwtagscan:{},orderItemSelected:{},order_sum:{details:{sum:0,scanQty:0,lastScanQty:0},hwASN:{sum:0,scanQty:0,lastScanQty:0}},scan_qrCode:[]}},onLoad:function(t){this.progNo=t.progNo,this.order=this.urldata,this.hwtagscan=this.urldata.data_hwtagscan;var e=this;console.log(n.default.outputLog(e.urldata)," at pages\\sale\\sale-hwtagDet.vue:112")},onReady:function(){n.default.getListHeight(this),"object"==typeof this.hwtagscan&&this.arr_split(this.order.details,this.hwtagscan);for(var t=0;t<this.order.details.length;t++)this.onScrollTop(t),this.updateScanList();0==this.order_sum.details.lastScanQty&&this.$refs.input_ASN.setFocus()},onBackPress:function(t){return n.default.backPress(t,this.order_sum.details.lastScanQty!=this.order_sum.hwASN.lastScanQty)},computed:(0,r.mapState)(["urldata"]),methods:{onPartScaned:function(e){for(var a=this,o=this,l=!1,r=0;r<this.scan_qrCode.length;r++){var i=this.scan_qrCode[r];i==e&&(l=!0)}if(l)return t.showToast({title:"该标签已扫!!!",icon:"none"}),void n.default.showAudio();this.scan_qrCode.push(e),t.showLoading({mask:!0}),s.default.OpenMes_mesqrcodeinout({data:{qrCode:e},success:function(e){var s=a.order_sum.details.sum;if(e.tagDetails)e.tagDetails.forEach(function(e){if(Number(e.sheetQty)>s)return 0==s?(t.showToast({title:"(内部)已扫描完毕!!!",icon:"none"}),void n.default.showAudio()):(t.showToast({title:"(内部)数量较大剩余:"+n.default.floatObj.subtract(Number(e.sheetQty),s)+"请拆分处理.",icon:"none"}),void n.default.showAudio());if(o.order.details[0].scantagDetails.length>0)for(var a=0;a<o.order.details.length;a++){var l=o.order.details[a];if(l.scantagDetails[0].partItemNo!=e.partItemNo)return n.default.showAudio(),void t.showToast({icon:"none",title:"扫描的不是校验的物料!!!"});if(!(l.lastScanQty<=0)){if(l.scantagDetails[0].suPartNo!=e.suPartNo)return n.default.showAudio(),void t.showToast({icon:"none",title:"客户料号不一致!!!"});o.arr_split(o.order.details,e),n.default.showScanedAudio(),o.onScrollTop(a),o.updateScanList()}}else{if(""==e.suPartNo)return n.default.showAudio(),void t.showToast({icon:"none",title:"扫描的物料没有客户料号!!!"});o.arr_split(o.order.details,e),n.default.showScanedAudio()}});else{if(Number(e.sheetQty)>s)return 0==s?(t.showToast({title:"(内部)已扫描完毕!!!",icon:"none"}),void n.default.showAudio()):(t.showToast({title:"(内部)数量较大剩余:"+n.default.floatObj.subtract(Number(e.sheetQty),s)+"请拆分处理.",icon:"none"}),void n.default.showAudio());if(o.order.details[0].scantagDetails.length>0)for(var l=0;l<o.order.details.length;l++){var r=o.order.details[l];if(r.scantagDetails[0].partItemNo!=e.partItemNo)return n.default.showAudio(),void t.showToast({icon:"none",title:"扫描的不是校验的物料!!!"});if(!(r.lastScanQty<=0)){if(r.scantagDetails[0].suPartNo!=e.suPartNo)return n.default.showAudio(),void t.showToast({icon:"none",title:"客户料号不一致!!!"});o.arr_split(o.order.details,e),n.default.showScanedAudio(),o.onScrollTop(l),o.updateScanList()}}else{if(""==e.suPartNo)return n.default.showAudio(),void t.showToast({icon:"none",title:"扫描的物料没有客户料号!!!"});o.arr_split(o.order.details,e),n.default.showScanedAudio()}}},failure:function(t){n.default.showAudio(),a.$refs.input_part.setFocus()},complete:function(e,a,s){n.default.tryCatchApi({status:e,message:a}),t.hideLoading()}})},onhwPartScaned:function(e){var a=this;console.log(a.order," at pages\\sale\\sale-hwtagDet.vue:323");for(var s=!1,o=0;o<this.scan_qrCode.length;o++){var l=this.scan_qrCode[o];l==e&&(s=!0)}if(s)return t.showToast({title:"该标签已扫!!!",icon:"none"}),void n.default.showAudio();this.scan_qrCode.push(e);var r=a.order_sum.details.sum,i=!1;for(o=0;o<a.order.hwASN.length;o++){var d=a.order.hwASN[o];if(console.log(d.pkgId+"===="+e," at pages\\sale\\sale-hwtagDet.vue:345"),d.pkgId==e){if(console.log(d.qty+"==="+r," at pages\\sale\\sale-hwtagDet.vue:347"),d.qty<=r){t.showToast({icon:"none",title:"扫描成功"}),d.m_ishwASN=!0,n.default.showScanedAudio(),a.updateScanList();break}t.showToast({icon:"none",title:"未达到客户需求数量！"}),n.default.showAudio();break}i=!0}i&&(t.showToast({icon:"none",title:"没有对应的pkgId！"}),n.default.showAudio())},arr_split:function(t,e){var a=this;if(e.tagDetails)for(var s=0;s<e.tagDetails.length;s++){for(var l=e.tagDetails[s],r=l.sheetQty,i=0;i<t.length;i++)if(console.log("先取标签数量是相等的=========="+t[i].lastScanQty==r," at pages\\sale\\sale-hwtagDet.vue:388"),t[i].lastScanQty==r){var d=n.default.clone(l);d.entityState=o.default.entityState.added,a.scantagDetails_push(d,i),r=0;break}for(i=0;i<t.length;i++){d=n.default.clone(l);if(d.entityState=o.default.entityState.added,t[i].lastScanQty>=r&&0!=r){console.log("多个====arr[i].lastScanQty >= last================="," at pages\\sale\\sale-hwtagDet.vue:402"),d.sheetQty=r,a.scantagDetails_push(d,i),r=0;break}r>t[i].lastScanQty&&(console.log("多个=====last > arr[i].lastScanQty========"," at pages\\sale\\sale-hwtagDet.vue:408"),r-=t[i].lastScanQty,d.sheetQty=t[i].lastScanQty,a.scantagDetails_push(d,i))}}else{for(r=Number(e.sheetQty),i=0;i<t.length;i++)if(console.log("先取标签数量是相等的=========="," at pages\\sale\\sale-hwtagDet.vue:419"),t[i].lastScanQty==r){d=n.default.clone(e);d.entityState=o.default.entityState.added,a.scantagDetails_push(d,i),r=0;break}for(i=0;i<t.length;i++){d=n.default.clone(e);if(d.entityState=o.default.entityState.added,t[i].lastScanQty>r&&0!=r){console.log("多个====arr[i].lastScanQty >= last================="," at pages\\sale\\sale-hwtagDet.vue:433"),d.sheetQty=r,a.scantagDetails_push(d,i),r=0;break}r>t[i].lastScanQty&&(console.log("多个=====last > arr[i].lastScanQty========"," at pages\\sale\\sale-hwtagDet.vue:439"),r-=t[i].lastScanQty,d.sheetQty=t[i].lastScanQty,a.scantagDetails_push(d,i))}}},scantagDetails_push:function(t,e){t.qrCode=this.qrCode,this.order.details[e].scantagDetails=this.order.details[e].scantagDetails||[],this.order.details[e].scantagDetails.push(t),this.order.details[e].entityState=o.default.entityState.modified,this.onScrollTop(e),this.updateScanList()},onnavigateBack:function(){var e=this;0!=e.order_sum.details.lastScanQty||0!=e.order_sum.hwASN.lastScanQty?(t.showModal({title:"该标签未扫完",content:"是否返回?",success:function(a){if(a.confirm)l.default.set(o.default.storageKeys.hwDetails,e.order),t.navigateBack();else if(a.cancel)return}}),n.default.showAudio()):(e.order.details.forEach(function(e){e.lastScanQty>0?e.tagCheckSw=0:0==e.lastScanQty?e.tagCheckSw=1:e.lastScanQty<0&&t.showModal({title:"警告",content:"单据异常请联系管理员",showCancel:!1,success:function(t){t.confirm||t.cancel}})}),l.default.set(o.default.storageKeys.hwDetails,e.order),t.navigateBack())},updateScanList:function(){var t=this,e=0;this.orderItemSelected.scantagDetails.forEach(function(t,a){e=n.default.floatObj.add(e,t.sheetQty)}),this.orderItemSelected.scanQty=e,this.orderItemSelected.lastScanQty=n.default.floatObj.subtract(this.orderItemSelected.sheetQty,e);var a=n.default.clone(this.details);this.details=a,t.order_sum.details={sum:0,scanQty:0,lastScanQty:0},this.order.details.forEach(function(e,a){t.order_sum.details.sum=n.default.floatObj.add(t.order_sum.details.sum,e.sheetQty),t.order_sum.details.scanQty=n.default.floatObj.add(t.order_sum.details.scanQty,e.scanQty),t.order_sum.details.lastScanQty=n.default.floatObj.add(t.order_sum.details.lastScanQty,e.lastScanQty)}),t.order_sum.hwASN={sum:0,scanQty:0,lastScanQty:0},this.order.hwASN.forEach(function(e,a){t.order_sum.hwASN.sum=n.default.floatObj.add(t.order_sum.hwASN.sum,e.qty),e.m_ishwASN?t.order_sum.hwASN.scanQty=n.default.floatObj.add(t.order_sum.hwASN.scanQty,e.qty):t.order_sum.hwASN.lastScanQty=n.default.floatObj.add(t.order_sum.hwASN.lastScanQty,e.qty)});var s=n.default.clone(t.order_sum);t.order_sum=s},onSelectedItem:function(t){for(var e=0;e<this.order.details.length;e++){var a=this.order.details[e];e==t?(a.selectItemClass="uni-list-cell-selected",this.orderItemSelected=a):a.selectItemClass=""}},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var a=this;this.onSelectedItem(e);var s=t.createSelectorQuery().in(this).select(".scroll-view-item");s.boundingClientRect(function(t){a.scrollTop=a.old.scrollTop,a.$nextTick(function(){this.scrollTop=t.height*e})}).exec()}}};e.default=u}).call(this,a("6e42")["default"])},"45bb":function(t,e,a){"use strict";a.r(e);var s=a("18b0"),o=a.n(s);for(var l in s)"default"!==l&&function(t){a.d(e,t,function(){return s[t]})}(l);e["default"]=o.a},"5e80":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement;t._self._c},o=[];a.d(e,"a",function(){return s}),a.d(e,"b",function(){return o})},9474:function(t,e,a){"use strict";a.r(e);var s=a("5e80"),o=a("45bb");for(var l in o)"default"!==l&&function(t){a.d(e,t,function(){return o[t]})}(l);var n=a("2877"),r=Object(n["a"])(o["default"],s["a"],s["b"],!1,null,null,null);e["default"]=r.exports}},[["b2d7","common/runtime","common/vendor"]]]);