(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/sale/sale-oqccheckDet"],{9507:function(t,e,o){"use strict";o.r(e);var n=o("e30f"),a=o("e458");for(var s in a)"default"!==s&&function(t){o.d(e,t,function(){return a[t]})}(s);var i=o("2877"),l=Object(i["a"])(a["default"],n["a"],n["b"],!1,null,null,null);e["default"]=l.exports},e30f:function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},a=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return a})},e458:function(t,e,o){"use strict";o.r(e);var n=o("fc7c"),a=o.n(n);for(var s in n)"default"!==s&&function(t){o.d(e,t,function(){return n[t]})}(s);e["default"]=a.a},fc7c:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=c(o("2e17")),a=c(o("f2a9")),s=c(o("00e0")),i=c(o("409c")),l=o("2f62");function c(t){return t&&t.__esModule?t:{default:t}}function r(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),n.forEach(function(e){u(t,e,o[e])})}return t}function u(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var d=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},f={components:{barcodeInput:d},data:function(){return{old:{scrollTop:0},scrollTop:0,scrollHeight:0,order:{sheetNo:"",sheetTypeName:"",sheetDate:"",citemNo:"",custName1:"",details:[],entityState:0},scanBoxModel:null}},onLoad:function(t){var e=t.sheetLot||"";this.init(e)},onReady:function(){i.default.getListHeight(this)},onBackPress:function(t){return i.default.backPress(t,this.details.length>0)},methods:r({},(0,l.mapMutations)(["pageIO_true"]),{init:function(e){var o=this;t.showLoading({mask:!0}),n.default.sale_getDetails({data:{sheetLot:e},success:function(t){console.log(JSON.stringify(t)," at pages\\sale\\sale-oqccheckDet.vue:107"),o.order=t},complete:function(e,n,a){o.$refs.input_scanBox.setFocus(),i.default.tryCatchApi({status:e,message:n}),t.hideLoading()}})},onScanBox:function(e){var o=this;t.showLoading({mask:!0}),n.default.boxfqc_boxScan({data:{boxQrCode:e},success:function(t){o.scanBoxModel=t;for(var e=0;e<o.scanBoxModel.tagDetails.length;e++)o.scanBoxModel.tagDetails[e].isScan=!1,o.scanBoxModel.tagDetails[e].isScanName="否";i.default.showScanedAudio()},complete:function(e,n,a){o.$refs.input_part.setFocus(),i.default.tryCatchApi({status:e,message:n}),t.hideLoading()}})},onPartScaned:function(e){var o=this;if(t.showLoading({mask:!0}),null==this.scanBoxModel)return t.showToast({title:"请先扫描外箱标签",icon:"none"}),void this.$refs.input_scanBox.setFocus();n.default.basic_QRCodeAnalysis({data:{qrCode:e},success:function(e){for(var n=-1,a=0;a<o.scanBoxModel.tagDetails.length;a++){var s=o.scanBoxModel.tagDetails[a];if(s.tagId==e.tagId){s.isScan&&(t.showToast({title:"标签已扫描",icon:"none"}),o.onScrollTop(a)),n=a;break}}if(-1==n)t.showToast({title:"标签扫描错误",icon:"none"}),i.default.showAudio();else{o.scanBoxModel.tagDetails[n];o.scanBoxModel.tagDetails[a].isScan=!0,o.scanBoxModel.tagDetails[a].isScanName="是",o.onScrollTop(n),i.default.showScanedAudio()}},failure:function(t){i.default.showAudio()},complete:function(e,o,n){i.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onCloseBox:function(){for(var e=0;e<this.scanBoxModel.tagDetails.length;e++){if(!this.scanBoxModel.tagDetails[e].isScan)return this.onScrollTop(e),void t.showToast({title:"还有未校验的物料",icon:"none"});for(var o=0;o<this.order.tagDetails.length;o++)this.order.tagDetails[e].tagId==this.scanBoxModel.tagDetails[e].tagId&&(this.order.tagDetails[e].isScan=!0)}t.showToast({title:"封箱成功，请校验下一箱！"}),this.scanBoxModel=null,this.$refs.input_scanBox.setFocus()},onAgree:function(e){var o=this;if(null==this.scanBoxModel){for(var l=0;l<this.order.tagDetails.length;l++)if(!this.order.tagDetails[l].isScan)return t.showToast({title:"还有未校验的物料",icon:"none"}),void this.$refs.input_scanBox.setFocus();var c=s.default.get(a.default.storageKeys.login);this.order.oqcSpcSw=e?1:0,this.order.oqcSpcEmp=c.userID,this.order.entityState=a.default.entityState.modified,t.showLoading({title:"加载中",mask:!0});var r=this;n.default.sale_save_put({data:this.order,success:function(e){t.showToast({title:"保存成功"}),i.default.dataInit(o),r.pageIO_true()},failure:function(t){i.default.showAudio()},complete:function(e,o,n){i.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})}else t.showToast({title:"请先封箱",icon:"none"})},onSelectedItem:function(t){for(var e=0;e<this.order.details.length;e++){var o=this.order.details[e];e==t?(o.selectItemClass="uni-list-cell-selected",this.orderItemSelected=o):o.selectItemClass=""}},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var n=t.createSelectorQuery().in(this).select(".scroll-view-item");n.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,o.$nextTick(function(){this.scrollTop=t.height*e})}).exec()}})};e.default=f}).call(this,o("6e42")["default"])}},[["9495","common/runtime","common/vendor"]]]);