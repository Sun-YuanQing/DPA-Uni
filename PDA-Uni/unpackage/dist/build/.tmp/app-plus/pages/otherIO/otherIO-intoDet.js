(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/otherIO/otherIO-intoDet"],{7654:function(t,e,o){"use strict";o.r(e);var n=o("8462"),i=o("e497");for(var a in i)"default"!==a&&function(t){o.d(e,t,function(){return i[t]})}(a);var r=o("2877"),s=Object(r["a"])(i["default"],n["a"],n["b"],!1,null,null,null);e["default"]=s.exports},8462:function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},i=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return i})},dddc:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=l(o("2e17")),i=l(o("f2a9")),a=l(o("00e0")),r=l(o("409c")),s=o("2f62");function l(t){return t&&t.__esModule?t:{default:t}}function d(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),n.forEach(function(e){u(t,e,o[e])})}return t}function u(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var c=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},h=function(){return o.e("components/label-print/print-button").then(o.bind(null,"4ae8"))},f=function(){return o.e("components/uni-popup-modal/uni-popup-modal").then(o.bind(null,"b32a"))},p=function(){return o.e("components/mpvue-picker/mpvuePicker").then(o.bind(null,"80f1"))},g={components:{barcodeInput:c,printButton:h,uniPopupModal:f,mpvuePicker:p},data:function(){new Date;return{old:{scrollTop:0},scrollTop:0,scrollHeight:0,reportModel:{progNo:"",showReport:!1,isMultiPrint:!1,dataSource:[],isNeedValidTag:!1},orderItemSelected:{},isStorageBin:null,placeholder_store:"",binNo:"",binWhNo:"",order:{},scan_qrCode:[],showPrint:!1}},onLoad:function(t){this.reportModel.progNo=t.progNo,this.order=this.urldata,this.isStorageBin=a.default.get(i.default.storageKeys.IsStorageBin),this.isStorageBin?this.placeholder_store="扫描储位":this.placeholder_store="扫描仓库"},onReady:function(){r.default.getListHeight(this)},onBackPress:function(t){return r.default.backPress(t,this.order.details)},computed:(0,s.mapState)(["urldata"]),methods:d({},(0,s.mapMutations)(["pageIO_true"]),{onStorScaned:function(e){var o=this;e.length<=0?t.showToast({title:"不能输入空值!",icon:"none"}):(t.showLoading({mask:!0}),this.isStorageBin&&n.default.bas_storagebin({data:{binNo:e},success:function(e){e.length<=0?(t.showToast({title:"货架不存在!",icon:"none"}),o.$refs.input_store.clear(),r.default.showAudio()):(o.binNo=e[0].binNo,o.binWhNo=e[0].whNo,o.$refs.input_part.setFocus(),r.default.showScanedAudio())},failure:function(t){o.$refs.input_store.setFocus(),r.default.showAudio()},complete:function(e,o,n){r.default.tryCatchApi({status:e,message:o}),t.hideLoading()}}))},onPartScaned:function(e){var o=this;if(t.showLoading({mask:!0}),this.isStorageBin&&""==this.binNo.trim())return t.showToast({title:"请先扫描货架",icon:"none"}),this.$refs.input_store.setFocus(),void r.default.showAudio();n.default.OpenMes_mesqrcodeinout({data:{qrCode:e},success:function(n){console.log(n," at pages\\otherIO\\otherIO-intoDet.vue:189");for(var a=o,s=!1,l=!1,d=0;d<o.scan_qrCode.length;d++){var u=o.scan_qrCode[d];u==e&&(s=!0)}if(s)return t.showToast({title:"该标签已扫!!!",icon:"none"}),void r.default.showAudio();o.scan_qrCode.push(e);var c=[],h=/\d+/g;o.order.details.forEach(function(t){var e=t.sheetLot.match(h);c.push(e[1])}),c.sort(function(t,e){return t-e});var f=parseInt(c[c.length-1])+1;for(d=0;d<o.order.details.length;d++){var p=o.order.details[d];if(!p.m_isScan)if(p.tagDetails=p.tagDetails||[],p.m_isScan=!1,n.tagDetails){if(n.tagDetails.length>1)return t.showToast({title:"请扫箱标签^_^",icon:"none"}),void r.default.showAudio();for(var g=0;g<n.tagDetails.length;g++){var m=n.tagDetails[g];if(m.qrCode=e,p.partItemNo==m.partItemNo){if(!0,a.isStorageBin?(m.binNo=a.binNo,m.binWhNo=a.binWhNo):(m.binNo=p.whNo,m.binWhNo=p.whNo),p.inLot&&p.inLot!=m.inLot)return t.showToast({title:"不是同一批次!",icon:"none"}),r.default.showAudio(),void a.$refs.input_part.setFocus();if(m.entityState=i.default.entityState.added,p.sheetQty==m.sheetQty){console.log(p.sheetQty+"---"+m.sheetQty," at pages\\otherIO\\otherIO-intoDet.vue:275"),o.onScrollTop(d),p.m_isScan=!0,m.inoutFlag=1,p.tagDetails.push(m),p.inLot=m.inLot,p.proDate=new Date(m.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),l=!1,r.default.showScanedAudio();break}}else!1}}else{if(p.partItemNo!=n.partItemNo){!1;continue}if(!0,n.qrCode=e,a.isStorageBin?(n.binNo=a.binNo,n.binWhNo=a.binWhNo):(n.binNo=p.whNo,n.binWhNo=p.whNo),p.inLot&&p.inLot!=n.inLot)return t.showToast({title:"不是同一批次!",icon:"none"}),r.default.showAudio(),void a.$refs.input_part.setFocus();if(n.entityState=i.default.entityState.added,p.sheetQty==n.sheetQty){console.log(p.sheetQty+"---"+n.sheetQty," at pages\\otherIO\\otherIO-intoDet.vue:321"),o.onScrollTop(d),p.m_isScan=!0,n.inoutFlag=1,p.tagDetails.push(n),p.inLot=n.inLot,p.proDate=new Date(n.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),l=!1,r.default.showScanedAudio();break}}}for(d=0;d<o.order.details.length;d++){p=o.order.details[d];if(!p.m_isScan)if(p.tagDetails=p.tagDetails||[],p.m_isScan=!1,n.tagDetails){if(n.tagDetails.length>1)return t.showToast({title:"请扫箱标签^_^",icon:"none"}),void r.default.showAudio();for(g=0;g<n.tagDetails.length;g++){m=n.tagDetails[g];if(p.partItemNo==m.partItemNo){if(!0,a.isStorageBin?(m.binNo=a.binNo,m.binWhNo=a.binWhNo):(m.binNo=p.whNo,m.binWhNo=p.whNo),m.entityState=i.default.entityState.added,p.sheetQty<m.sheetQty)console.log(p.sheetQty+"---"+m.sheetQty," at pages\\otherIO\\otherIO-intoDet.vue:376"),o.onScrollTop(d),l=!0;else if(p.sheetQty>m.sheetQty){console.log(p.sheetQty+"---"+m.sheetQty," at pages\\otherIO\\otherIO-intoDet.vue:382"),o.onScrollTop(d);var y=r.default.floatObj.subtract(p.sheetQty,m.sheetQty);p.sheetQty=Number(m.sheetQty);var S=r.default.clone(p);p.m_isScan=!0,m.inoutFlag=1,p.tagDetails.push(m),p.inLot=m.inLot,p.proDate=new Date(m.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),S.m_isclone=!0,S.sheetLot=S.sheetLot.split("_")[0]+"_"+r.default.getSuffix(3,f),S.sheetQty=y,o.order.details.push(S),l=!1,r.default.showScanedAudio();break}}else!1}}else{if(p.partItemNo!=n.partItemNo){!1;continue}if(!0,a.isStorageBin?(n.binNo=a.binNo,n.binWhNo=a.binWhNo):(n.binNo=p.whNo,n.binWhNo=p.whNo),n.entityState=i.default.entityState.added,p.sheetQty<n.sheetQty){console.log(p.sheetQty+"---"+n.sheetQty," at pages\\otherIO\\otherIO-intoDet.vue:421"),o.onScrollTop(d),l=!0;continue}if(p.sheetQty>n.sheetQty){console.log(p.sheetQty+"---"+n.sheetQty," at pages\\otherIO\\otherIO-intoDet.vue:428"),o.onScrollTop(d);y=r.default.floatObj.subtract(p.sheetQty,n.sheetQty);p.sheetQty=Number(n.sheetQty);S=r.default.clone(p);p.m_isScan=!0,n.inoutFlag=1,p.tagDetails.push(n),p.inLot=n.inLot,p.proDate=new Date(n.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),S.m_isclone=!0,S.sheetLot=S.sheetLot.split("_")[0]+"_"+r.default.getSuffix(3,f),S.sheetQty=y,o.order.details.push(S),l=!1,r.default.showScanedAudio();break}}}if(l)return r.default.showAudio(),t.showModal({title:"提示",content:"数量不能大于入库数量!!!",showCancel:!1,success:function(t){t.confirm||t.cancel}}),void a.$refs.input_part.setFocus();r.default.automateSave(a.order.details,"m_isScan",1,a.onSave)},failure:function(t){r.default.showAudio()},complete:function(e,n,i){o.$refs.input_part.setFocus(),r.default.tryCatchApi({status:e,message:n}),t.hideLoading()}})},onSave:function(){for(var e=this,o=this,s=0;s<this.order.details.length;s++){var l=this.order.details[s];if(!l.m_isScan)return r.default.showAudio(),void t.showToast({icon:"none",title:"请较对入库物料!"});l.m_isclone?l.entityState=i.default.entityState.added:l.entityState=i.default.entityState.modified,l.sheetSta=2}this.order.entityState=i.default.entityState.modified,this.order.sheetSta=2,console.log(o.order," at pages\\otherIO\\otherIO-intoDet.vue:501"),t.showLoading({mask:!0}),n.default.OpenMes_other({data:o.order,success:function(n){t.showToast({title:"保存成功!",icon:"none"}),r.default.dataInit(e),o.pageIO_true(),o.isStorageBin=a.default.get(i.default.storageKeys.IsStorageBin),o.isStorageBin?o.placeholder_store="扫描储位":o.placeholder_store="扫描仓库",r.default.showScanedAudio()},failure:function(t){r.default.showAudio()},complete:function(o,n,i){e.$refs.input_part.setFocus(),r.default.tryCatchApi({status:o,message:n}),t.hideLoading()}})},printComplete:function(){console.log("printComplete"," at pages\\otherIO\\otherIO-intoDet.vue:536"),this.showPrint=!1},onprintCancel:function(){console.log("onprintCancel"," at pages\\otherIO\\otherIO-intoDet.vue:540"),this.showPrint=!1,this.reportModel.dataSource=[]},tagValid:function(){console.log("tagValid"," at pages\\otherIO\\otherIO-intoDet.vue:546")},onShowPrint:function(e){return console.log("弹出框 显示/取消"," at pages\\otherIO\\otherIO-intoDet.vue:550"),this.order.details?this.orderItemSelected.selectItemClass?(e||(this.showPrint=e),void(this.orderItemSelected.inLot&&""!=this.orderItemSelected.inLot?this.onSubmitPrint():this.showPrint=e)):(t.showToast({title:"请选择打印对象！！！",icon:"none"}),r.default.showAudio(),void this.$refs.input_part.setFocus()):(t.showToast({title:"请先扫描单号",icon:"none"}),void r.default.showAudio())},onSubmitPrint:function(t){console.log("弹出框 确定"," at pages\\otherIO\\otherIO-intoDet.vue:581"),console.log(this.orderItemSelected," at pages\\otherIO\\otherIO-intoDet.vue:582");var e=this,o=1,n=(new Date).format("yyMMddHHmmssfff"),i={};i.proDate=new Date(e.orderItemSelected.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),i.partNo=this.orderItemSelected.partNo,i.partItemNo=this.orderItemSelected.partItemNo,i.partName=this.orderItemSelected.partName,i.partSpec=this.orderItemSelected.partSpec,i.serialNo="",i.tagFlag="",i.boxTagId="",i.purLot=this.orderItemSelected.purLot,i.poMoSoLot=this.orderItemSelected.purLot,i.sheetQty=this.orderItemSelected.sheetQty,i.tagId="".concat(n,"-").concat(r.default.getSuffix(3,o)),i.linkBoardQty="",i.inLot=this.orderItemSelected.inLot,i.citemNo=this.order.citemNo,i.custNo=this.order.custNo,i.custName=this.order.custName,i.ordLot="",i.custTagId="",i.reservelocus=this.orderItemSelected.reservelocus,i.proItemNo="",i.proName="",i.toProItemNo="",i.toProName="",i.dayId="",i.spcSta="",i.printType="",i.deviceNo="",i.deviceName="",this.reportModel.dataSource.push(i),this.$refs.printBtn.execPrint()},onSelectedItem:function(t){for(var e=0;e<this.order.details.length;e++){var o=this.order.details[e];e==t?(o.selectItemClass="uni-list-cell-selected",this.orderItemSelected=o):o.selectItemClass=""}},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var n=t.createSelectorQuery().in(this).select(".scroll-view-item");n.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,null!=t&&o.$nextTick(function(){this.scrollTop=t.height*e})}).exec()}})};e.default=g}).call(this,o("6e42")["default"])},e497:function(t,e,o){"use strict";o.r(e);var n=o("dddc"),i=o.n(n);for(var a in n)"default"!==a&&function(t){o.d(e,t,function(){return n[t]})}(a);e["default"]=i.a}},[["9f77","common/runtime","common/vendor"]]]);