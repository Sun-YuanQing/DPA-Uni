(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/storage/storage-initUpperShelf"],{"1ce9":function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement;t._self._c},a=[];o.d(e,"a",function(){return s}),o.d(e,"b",function(){return a})},"3a64":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=l(o("00e0")),a=l(o("2e17")),i=l(o("f2a9")),n=l(o("409c"));function l(t){return t&&t.__esModule?t:{default:t}}var r=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},u={components:{barcodeInput:r},data:function(){return{old:{scrollTop:0},tagId:{},scrollTop:0,scrollHeight:0,placeholder_store:"",isStorageBin:null,binNo:"",binWhNo:"",totalQty:0,details:[],orderItemSelected:{}}},onReady:function(){n.default.getListHeight(this);var t=this;this.isStorageBin=s.default.get(i.default.storageKeys.IsStorageBin),this.isStorageBin?t.placeholder_store="扫描储位":t.placeholder_store="扫描仓库"},onBackPress:function(t){return n.default.backPress(t,this.details.length>0)},methods:{onScanStorage:function(e){var o=this;e.length<=0?t.showToast({title:"不能输入空值!",icon:"none"}):(t.showLoading({mask:!0}),this.isStorageBin?a.default.bas_storagebin({data:{binNo:e},success:function(e){console.log(n.default.outputLog(e)," at pages\\storage\\storage-initUpperShelf.vue:116"),e.length<=0?(t.showToast({title:"货架不存在!",icon:"none"}),o.$refs.input_store.clear(),n.default.showAudio()):(o.binNo=e[0].binNo,o.binWhNo=e[0].whNo,o.$refs.input_part.setFocus(),n.default.showScanedAudio())},failure:function(t){o.$refs.input_store.setFocus(),n.default.showAudio()},complete:function(e,o,s){n.default.tryCatchApi({status:e,message:o}),t.hideLoading()}}):(console.log(e," at pages\\storage\\storage-initUpperShelf.vue:144"),a.default.bas_wh({data:{filter:'whNo = "'+e+'"'},success:function(e){console.log(n.default.outputLog(e)," at pages\\storage\\storage-initUpperShelf.vue:150"),e.length<=0?(t.showToast({title:"仓库不存在!",icon:"none"}),o.$refs.input_store.clear(),n.default.showAudio()):(o.binWhNo=e[0].whNo,o.$refs.input_part.setFocus(),n.default.showScanedAudio())},failure:function(t){o.$refs.input_store.setFocus(),n.default.showAudio()},complete:function(e,o,s){n.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})))},onPartScaned:function(e){var o=this,s=this;if(this.isStorageBin){if(""==this.binNo.trim())return t.showToast({title:"请先扫描货架",icon:"none"}),this.$refs.input_store.setFocus(),void n.default.showAudio()}else if(""==this.binWhNo.trim())return t.showToast({title:"请扫描库位",icon:"none"}),void this.$refs.input_store.setFocus();t.showLoading({mask:!0}),a.default.base_scanBox({data:{qrCode:e},success:function(i){if(i.sheetQty<=0)return t.showToast({title:"数量不能为负数！",icon:"none"}),void n.default.showAudio();for(var l=0;l<o.details.length;l++){var r=o.details[l];if(r.qrCode==e){o.onScrollTop(l);var u=o;return t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?(u.totalQty=n.default.floatObj.subtract(u.totalQty,u.details[l].totalQty),(null==u.totalQty||isNaN(u.totalQty))&&(u.totalQty=0),u.details.splice(l,1)):t.cancel}}),void n.default.showAudio()}}a.default.storage_RasCun({data:{tagId:i.tagId},success:function(a){if(s.details.length>0){if(s.details[0].model.partItemNo!=i.partItemNo)return t.showToast({title:"与第一次物料不相同!!!",icon:"none"}),n.default.showAudio(),void s.$refs.input_part.setFocus();o.details.push({model:i,qrCode:e})}else o.details.push({model:i,qrCode:e});s.totalQty=n.default.floatObj.add(s.totalQty,i.sheetQty),n.default.showScanedAudio()},failure:function(t){n.default.showAudio()},complete:function(e,s,a){o.$refs.input_part.setFocus(),n.default.tryCatchApi({status:e,message:s}),t.hideLoading()}})},failure:function(t){n.default.showAudio()},complete:function(e,o,s){n.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onSave:function(){var e=this;if(0!=this.details.length){for(var o=this,l=0;l<this.details.length;l++){var r=this.details[l];r.model.tagDetails?r.model.tagDetails.forEach(function(t){r.sheetType=t.sheetType,r.sheetNo=t.sheetNo,r.sheetLot=t.sheetLot,r.partNo=t.partNo,r.purLot=t.poMoSoLot,r.proLot=t.proLot,r.sheetQty=t.sheetQty,r.inLot=t.inLot,r.proDate=t.proDate,r.tagId=t.tagId,r.boxTagId=t.boxTagId,r.custTagId=t.custTagId,r.ordLot=t.ordLot,r.custNo=t.custNo,o.isStorageBin?(r.binNo=o.binNo,r.binWhNo=o.binWhNo):(r.binNo=o.binWhNo,r.binWhNo=o.binWhNo),r.qrCode=r.qrCode,r.inoutFlag="1",r.sourceType="1",r.entityState=i.default.entityState.added}):(r.sheetType=r.model.sheetType,r.sheetNo=r.model.sheetNo,r.sheetLot=r.model.sheetLot,r.partNo=r.model.partNo,r.purLot=r.model.poMoSoLot,r.proLot=r.model.proLot,r.sheetQty=r.model.sheetQty,r.inLot=r.model.inLot,r.proDate=r.model.proDate,r.tagId=r.model.tagId,r.boxTagId=r.model.boxTagId,r.custTagId=r.model.custTagId,r.ordLot=r.model.ordLot,r.custNo=r.model.custNo,this.isStorageBin?(r.binNo=this.binNo,r.binWhNo=this.binWhNo):(r.binNo=this.binWhNo,r.binWhNo=this.binWhNo),r.qrCode=r.qrCode,r.inoutFlag="1",r.sourceType="1",r.entityState=i.default.entityState.added)}t.showLoading({mask:!0}),a.default.storage_Ras({data:this.details,success:function(a){t.showToast({title:"保存成功"}),n.default.dataInit(e),o.isStorageBin=s.default.get(i.default.storageKeys.IsStorageBin),o.isStorageBin?o.placeholder_store="扫描储位":o.placeholder_store="扫描仓库",e.$refs.input_store.setFocus()},failure:function(t){n.default.showAudio()},complete:function(e,o,s){n.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})}else t.showToast({title:"没有提交的数据！！",icon:"none"})},onSelectedItem:function(t){for(var e=0;e<this.details.length;e++){var o=this.details[e];e==t?(o.selectItemClass="uni-list-cell-selected",this.orderItemSelected=o):o.selectItemClass=""}},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var s=t.createSelectorQuery().in(this).select(".scroll-view-item");s.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,o.$nextTick(function(){this.scrollTop=t.height*e})}).exec()}}};e.default=u}).call(this,o("6e42")["default"])},9632:function(t,e,o){"use strict";o.r(e);var s=o("1ce9"),a=o("d519");for(var i in a)"default"!==i&&function(t){o.d(e,t,function(){return a[t]})}(i);var n=o("2877"),l=Object(n["a"])(a["default"],s["a"],s["b"],!1,null,null,null);e["default"]=l.exports},d519:function(t,e,o){"use strict";o.r(e);var s=o("3a64"),a=o.n(s);for(var i in s)"default"!==i&&function(t){o.d(e,t,function(){return s[t]})}(i);e["default"]=a.a}},[["3448","common/runtime","common/vendor"]]]);