(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/storage/storage-boxUp"],{8250:function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},r=[];o.d(e,"a",function(){return a}),o.d(e,"b",function(){return r})},"8be5":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(o("2e17")),r=n(o("f2a9")),i=(n(o("00e0")),n(o("409c")));function n(t){return t&&t.__esModule?t:{default:t}}var s=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},d=function(){return o.e("components/label-print/print-button").then(o.bind(null,"4ae8"))},l={components:{barcodeInput:s,printButton:d},data:function(){return{reportModel:{progNo:"",showReport:!1,isMultiPrint:!0,dataSource:[],isNeedValidTag:!0},old:{scrollTop:0},scrollTop:0,scrollHeight:0,details:[],orderHeader:{poMoSoLot:"",partItemNo:"",partName:"",boxPackingQty:0,totalQty:0}}},onLoad:function(t){this.reportModel.progNo=t.progNo},onReady:function(){i.default.getListHeight(this)},onBackPress:function(t){return i.default.backPress(t,this.details.length>0)},methods:{onPartScaned:function(e){var o=this;t.showLoading({mask:!0});var r=this;a.default.basic_QRCodeAnalysis({data:{qrCode:e},success:function(a){if(a.inBoxNo.trim().length>0)return t.showToast({title:"该标签已在 "+a.inBoxNo+" 箱中！",icon:"none"}),void i.default.showAudio();for(var n=0;n<o.details.length;n++){var s=o.details[n];if(s.tagId==a.tagId){var d=a;return r.onScrollTop(n),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?(r.details.splice(n,1),r.orderHeader.totalQty=i.default.floatObj.subtract(r.orderHeader.totalQty,d.sheetQty)):t.cancel}}),void i.default.showAudio()}if(s.inlot!=a.inlot)return t.showToast({title:"批次号不一致",icon:"none"}),i.default.showAudio(),void o.$refs.input_part.setFocus();if(s.partItemNo!=a.partItemNo)return t.showToast({title:"物料不一致",icon:"none"}),i.default.showAudio(),void o.$refs.input_part.setFocus();if(s.binWhNo!=a.binWhNo)return t.showToast({title:"所在仓库不一致",icon:"none"}),i.default.showAudio(),void o.$refs.input_part.setFocus()}if(0==o.details.length&&(o.orderHeader.boxPackingQty=a.boxPackingQty,o.orderHeader.partItemNo=a.partItemNo,o.orderHeader.partName=a.partName,o.orderHeader.poMoSoLot=a.poMoSoLot),o.orderHeader.poMoSoLot!=a.poMoSoLot&&(o.orderHeader.poMoSoLot=""),!(0==Number(o.orderHeader.boxPackingQty)||o.orderHeader.boxPackingQty>=i.default.floatObj.add(o.orderHeader.totalQty,a.sheetQty)))return t.showToast({title:"超出装箱数量",icon:"none"}),void i.default.showAudio();a.sheetQty=Number(a.sheetQty),a.qrCode=e,o.details.push(a),o.onScrollTop(o.details.length-1),o.orderHeader.totalQty=i.default.floatObj.add(a.sheetQty,o.orderHeader.totalQty),t.showToast({title:"校验成功"}),i.default.showScanedAudio(),o.$refs.input_part.setFocus()},failure:function(t){i.default.showAudio()},complete:function(e,a,r){o.$refs.input_part.setFocus(),i.default.tryCatchApi({status:e,message:a}),t.hideLoading()}})},onSave:function(){if(0==this.details.length)return t.showToast({title:"请扫描内包装",icon:"none"}),i.default.showAudio(),void this.$refs.input_part.setFocus();var e=this;t.showModal({title:"提示",content:"是否确定封箱",success:function(t){if(t.confirm){var o=[],a=(new Date).format("yyMMddHHmmssfff"),r={};r.partNo=e.details[0].partNo,r.partItemNo=e.details[0].partItemNo,r.partName=e.details[0].partName,r.partSpec=e.details[0].partSpec,r.inLot=e.details[0].inLot,r.serialNo="",r.TagFlag="",r.poMoSoLot=e.details[0].poMoSoLot,r.sheetQty=e.orderHeader.totalQty,r.tagId="".concat(a,"-").concat(i.default.getSuffix(3,1)),r.boxTagId=r.tagId,r.linkBoardQty="",r.proLot=e.details[0].proLot,r.proDate=new Date(e.details[0].proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),r.citemNo=e.details[0].citemNo,r.custNo=e.details[0].custNo,r.custName=e.details[0].custName,r.custTagId="",r.reservelocus=e.details[0].reservelocus,r.ordLot=e.details[0].ordLot,r.custNo=e.details[0].custNo,r.purLot=e.orderHeader.poMoSoLot,r.proItemNo="",r.proName="",r.toProItemNo="",r.toProName="",r.dayId="",r.spcSta="",r.printType="",r.deviceNo="",r.deviceName="",console.log(i.default.outputLog(r)," at pages\\storage\\storage-boxUp.vue:270"),o.push(r),e.reportModel.dataSource=o,e.$refs.printBtn.execPrint()}else t.cancel}})},onBoxScanSave:function(e){var o=this,n=e[0];n.bzType=1,n.purLot=this.orderHeader.poMoSoLot,n.ordLot=this.details[0].ordLot,n.custNo=this.details[0].custNo,n.binWhNo=this.details[0].binWhNo,n.binNo=this.details[0].binWhNo,n.entityState=r.default.entityState.added;for(var s=0;s<this.details.length;s++){var d=this.details[s];d.boxTagId=n.tagId,d.sheetLot=n.tagId,d.purLot=this.orderHeader.poMoSoLot,d.entityState=r.default.entityState.added,n.tagDetails.push(d)}console.log(i.default.outputLog(n)," at pages\\storage\\storage-boxUp.vue:301"),t.showLoading({mask:!0}),a.default.boxIO_post({data:n,success:function(e){t.showToast({title:"保存成功!"}),i.default.dataInit(o),i.default.showScanedAudio()},failure:function(t){i.default.showAudio()},complete:function(e,a,r){o.$refs.input_part.setFocus(),i.default.tryCatchApi({status:e,message:a}),t.hideLoading()}})},onSelectedItem:function(t){for(var e=i.default.clone(this.details),o=0;o<e.length;o++){var a=e[o];a.selectItemClass=o==t?"uni-list-cell-selected":""}this.details=e},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var a=t.createSelectorQuery().in(this).select(".scroll-view-item");a.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,o.$nextTick(function(){null!=t&&(this.scrollTop=t.height*e)})}).exec()}}};e.default=l}).call(this,o("6e42")["default"])},efce:function(t,e,o){"use strict";o.r(e);var a=o("8be5"),r=o.n(a);for(var i in a)"default"!==i&&function(t){o.d(e,t,function(){return a[t]})}(i);e["default"]=r.a},f991:function(t,e,o){"use strict";o.r(e);var a=o("8250"),r=o("efce");for(var i in r)"default"!==i&&function(t){o.d(e,t,function(){return r[t]})}(i);var n=o("2877"),s=Object(n["a"])(r["default"],a["a"],a["b"],!1,null,null,null);e["default"]=s.exports}},[["c055","common/runtime","common/vendor"]]]);