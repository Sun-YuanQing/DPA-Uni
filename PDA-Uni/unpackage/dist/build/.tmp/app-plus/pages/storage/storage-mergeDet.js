(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/storage/storage-mergeDet"],{"03c1":function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},i=[];o.d(e,"a",function(){return a}),o.d(e,"b",function(){return i})},"46d6":function(t,e,o){"use strict";o.r(e);var a=o("03c1"),i=o("9c6e");for(var s in i)"default"!==s&&function(t){o.d(e,t,function(){return i[t]})}(s);var n=o("2877"),r=Object(n["a"])(i["default"],a["a"],a["b"],!1,null,null,null);e["default"]=r.exports},"9c6e":function(t,e,o){"use strict";o.r(e);var a=o("a81e"),i=o.n(a);for(var s in a)"default"!==s&&function(t){o.d(e,t,function(){return a[t]})}(s);e["default"]=i.a},a81e:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(o("2e17")),i=n(o("f2a9")),s=(n(o("00e0")),n(o("409c")));function n(t){return t&&t.__esModule?t:{default:t}}var r=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},l=function(){return o.e("components/label-print/print-button").then(o.bind(null,"4ae8"))},d={components:{barcodeInput:r,printButton:l},data:function(){return{old:{scrollTop:0},scrollTop:0,scrollHeight:0,boxDetails:[],otherProDetails:[],details:[],boxUpDetails:[],reportModel:{progNo:"",showReport:!1,isMultiPrint:!0,dataSource:[],isNeedValidTag:!0},orderHeader:{boxTotalTag:0,scanTag:0,partItemNo:"",partName:"",boxPackingQty:0,poMoSoLot:""}}},computed:{curScanQty:function(){for(var t=0,e=0;e<this.details.length;e++)t=s.default.floatObj.add(t,this.details[e].sheetQty);return t},lastTag:function(){return this.orderHeader.boxTotalTag+this.otherProDetails.length-this.orderHeader.scanTag}},onLoad:function(t){this.reportModel.progNo=t.progNo||"OPDA00046",this.boxDetails=JSON.parse(t.data);for(var e=0,o=0;o<this.boxDetails.length;o++)e=s.default.floatObj.add(e,this.boxDetails[o].tagDetails.length);this.orderHeader.boxTotalTag=e,this.orderHeader.boxPackingQty=this.boxDetails[0].tagDetails[0].boxPackingQty,this.orderHeader.partItemNo=this.boxDetails[0].tagDetails[0].partItemNo,this.orderHeader.partName=this.boxDetails[0].tagDetails[0].partName},onReady:function(){s.default.getListHeight(this)},onBackPress:function(t){return s.default.backPress(t,this.details.length>0)},methods:{onPartScaned:function(e){var o=this,i=this;t.showLoading({mask:!0}),a.default.basic_QRCodeAnalysis({data:{qrCode:e},success:function(o){var a=i.getInBoxTagItem(o);if(null==a){if(i.boxDetails[0].binWhNo!=o.binWhNo)return t.showToast({title:"所在仓库不一致",icon:"none"}),void s.default.showAudio();if(i.boxDetails[0].partItemNo!=o.partItemNo)return t.showToast({title:"料号不一致",icon:"none"}),void s.default.showAudio();if(i.boxDetails[0].inLot!=o.inLot)return t.showToast({title:"批次号不一致",icon:"none"}),void s.default.showAudio()}o.sheetQty=Number(o.sheetQty),o.qrCode=e;for(var n=function(){var e=i.details[r];if(e.tagId==o.tagId)return i.onScrollTop(r),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?(1==e.myFlag?i.otherProDetails.remove(e):null!=a&&(a.isFX=void 0),i.details.splice(r,1),i.orderHeader.scanTag-=1):t.cancel}}),s.default.showAudio(),{v:void 0}},r=0;r<i.details.length;r++){var l=n();if("object"===typeof l)return l.v}if(i.details.length>0&&i.orderHeader.boxPackingQty>0&&i.orderHeader.boxPackingQty<s.default.floatObj.add(i.curScanQty,o.sheetQty))return t.showToast({title:"超出装箱数量",icon:"none"}),void s.default.showAudio();if(0==i.details.length?i.orderHeader.poMoSoLot=o.poMoSoLot:i.orderHeader.poMoSoLot!=o.poMoSoLot&&(i.orderHeader.poMoSoLot=""),null==a){for(r=0;r<i.otherProDetails.length;r++)if(i.otherProDetails[r].tagId==o.tagId)return t.showToast({title:"该标签已扫描过，且已封箱！",icon:"none"}),void s.default.showAudio();return t.showModal({title:"提示",content:"当前标签不在箱子内，是否要添加到当前箱中？",success:function(t){t.confirm?(o.myFlag=1,i.addScanItem(o),i.otherProDetails.push(o)):t.cancel}}),void s.default.showAudio()}if(void 0!=a.isFX)return t.showToast({title:"该标签已扫描过，且已封箱！",icon:"none"}),void s.default.showAudio();a.isFX=!0,i.addScanItem(o),0==i.lastTag&&i.onPrintBox()},failure:function(t){s.default.showAudio()},complete:function(e,a,i){o.$refs.input_part.setFocus(),s.default.tryCatchApi({status:e,message:a}),t.hideLoading()}})},addScanItem:function(t){var e=this;e.details.push(t),e.onScrollTop(e.details.length-1),s.default.showScanedAudio(),e.orderHeader.scanTag+=1},onPrintBox:function(){var e=this;t.showModal({title:"提示",content:"是否要封箱？",success:function(t){if(t.confirm){var o=[],a=(new Date).format("yyMMddHHmmssfff"),i={};i.partNo=e.details[0].partNo,i.partItemNo=e.details[0].partItemNo,i.partName=e.details[0].partName,i.partSpec=e.details[0].partSpec,i.inLot=e.details[0].inLot,i.serialNo="",i.TagFlag="",i.poMoSoLot=e.orderHeader.poMoSoLot,i.sheetQty=e.curScanQty,i.tagId="".concat(a,"-").concat(s.default.getSuffix(3,1)),i.boxTagId=i.tagId,i.linkBoardQty="",i.proLot=e.details[0].proLot,i.proDate=new Date(e.details[0].proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),i.citemNo=e.details[0].citemNo,i.custNo=e.details[0].custNo,i.custName=e.details[0].custName,i.custTagId="",i.reservelocus=e.details[0].reservelocus,i.ordLot=e.details[0].ordLot,i.custNo=e.details[0].custNo,i.purLot=e.orderHeader.poMoSoLot,i.proItemNo="",i.proName="",i.toProItemNo="",i.toProName="",i.dayId="",i.spcSta="",i.printType="",i.deviceNo="",i.deviceName="",console.log(s.default.outputLog(i)," at pages\\storage\\storage-mergeDet.vue:390"),o.push(i),e.reportModel.dataSource=o,e.$refs.printBtn.execPrint()}else t.cancel}})},onBoxScanSave:function(e){var o=this,a=e[0];a.binWhNo=o.boxDetails[0].binWhNo,a.binNo=o.boxDetails[0].binWhNo,a.bzType=1,a.purLot=this.orderHeader.poMoSoLot,a.ordLot=this.details[0].ordLot,a.custNo=this.details[0].custNo,a.entityState=i.default.entityState.added;for(var s=0;s<this.details.length;s++){var n=this.details[s];n.boxTagId=a.tagId,n.sheetLot=a.tagId,n.entityState=i.default.entityState.added,a.tagDetails.push(n)}this.boxUpDetails.push(a),this.details=[],t.showToast({title:"校验成功!"}),this.$refs.input_part.setFocus(),0==o.lastTag&&t.showModal({title:"提示",content:"完成是否保存?",success:function(t){t.confirm?o.onSave():t.cancel}})},onSave:function(){var e=this,o=this;if(o.lastTag>0)return t.showToast({title:"还有"+o.lastTag+"待处理的内包装，请处理完后再保存",icon:"none"}),s.default.showAudio(),void this.$refs.input_part.setFocus();if(0==o.lastTag&&o.details.length>0)o.onPrintBox();else{var i=[];i=i.concat(o.boxDetails),i=i.concat(o.otherProDetails),i=i.concat(o.boxUpDetails),t.showLoading({mask:!0}),a.default.boxMerge_Save({data:i,success:function(e){t.showToast({title:"保存成功"}),t.navigateBack()},failure:function(t){s.default.showAudio()},complete:function(o,a,i){e.$refs.input_part.setFocus(),s.default.tryCatchApi({status:o,message:a}),t.hideLoading()}})}},getInBoxTagItem:function(t){for(var e=this,o=null,a=0;a<e.boxDetails.length;a++)for(var i=e.boxDetails[a],s=0;s<i.tagDetails.length;s++)if(i.tagDetails[s].tagId==t.tagId){o=i.tagDetails[s];break}return o},onSelectedItem:function(t){for(var e=s.default.clone(this.details),o=0;o<e.length;o++){var a=e[o];a.selectItemClass=o==t?"uni-list-cell-selected":""}this.details=e},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var a=t.createSelectorQuery().in(this).select(".scroll-view-item");a.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,o.$nextTick(function(){null!=t&&(this.scrollTop=t.height*e)})}).exec()}}};e.default=d}).call(this,o("6e42")["default"])}},[["0846","common/runtime","common/vendor"]]]);