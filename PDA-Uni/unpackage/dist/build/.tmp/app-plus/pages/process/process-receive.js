(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/process/process-receive"],{6523:function(e,t,o){"use strict";var s=function(){var e=this,t=e.$createElement;e._self._c},r=[];o.d(t,"a",function(){return s}),o.d(t,"b",function(){return r})},7069:function(e,t,o){"use strict";o.r(t);var s=o("6523"),r=o("aa92");for(var a in r)"default"!==a&&function(e){o.d(t,e,function(){return r[e]})}(a);var i=o("2877"),n=Object(i["a"])(r["default"],s["a"],s["b"],!1,null,null,null);t["default"]=n.exports},aa92:function(e,t,o){"use strict";o.r(t);var s=o("fa9b"),r=o.n(s);for(var a in s)"default"!==a&&function(e){o.d(t,e,function(){return s[e]})}(a);t["default"]=r.a},fa9b:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(o("2e17")),r=n(o("f2a9")),a=n(o("00e0")),i=n(o("409c"));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},l=function(){return o.e("components/authorize-input/authorize-input").then(o.bind(null,"d9d3"))},c=function(){return o.e("components/process-scanOrder/process-scanOrder").then(o.bind(null,"4567"))},d=new Date,p={components:{barcodeInput:u,authorizeInput:l,processScanOrder:c},data:function(){return{order:{},MesDayModel:{},resultNote:{},SendUser:{empName:""},receiveUser:{empName:""},userInfo:{},showAuth:!1,lockModel:{},progNo:"",process:"",old:{scrollTop:0},scrollTop:0,scrollHeight:0,details:[],orderItemSelected:{}}},onLoad:function(e){this.progNo=e.progNo||"OPDA00010",console.log(this.progNo," at pages\\process\\process-receive.vue:85"),this.userInfo=a.default.get(r.default.storageKeys.login)},onReady:function(){i.default.getListHeight(this)},onBackPress:function(e){return i.default.backPress(e,this.details.length>0)},methods:{onGetOrder:function(e){var t=this;t.order=e,this.$refs.input_SendUser.setFocus()},onScan_SendUser:function(t){var o=this;e.showLoading({mask:!0}),s.default.emp_a({data:{empNo:t},success:function(e){o.SendUser=e,console.log(JSON.stringify(o.SendUser)," at pages\\process\\process-receive.vue:113"),o.$refs.input_receiveUser.setFocus(),i.default.showScanedAudio()},failure:function(t){e.hideLoading(),o.$refs.input_SendUser.setFocus(),i.default.showAudio()},complete:function(t,o,s){i.default.tryCatchApi({status:t,message:o}),e.hideLoading()}})},onScan_receiveUser:function(t){var o=this;e.showLoading({mask:!0}),s.default.emp_a({data:{empNo:t},success:function(e){console.log(JSON.stringify(e)," at pages\\process\\process-receive.vue:140"),o.receiveUser=e,o.$refs.input_part.setFocus(),i.default.showScanedAudio()},failure:function(t){e.hideLoading(),o.$refs.input_receiveUser.setFocus(),i.default.showAudio()},complete:function(t,o,s){i.default.tryCatchApi({status:t,message:o}),e.hideLoading()}})},onScan_part:function(t){var o=this,a=this;e.showLoading({mask:!0}),s.default.Pda_pdamesdaylistbyjoincode({data:{qrCode:t},success:function(t){if(a.MesDayModel.resultCode=t.resultCode,a.resultNote=JSON.parse(t.resultNote),a.MesDayModel.resultText=t.resultText||"",a.order.moLot!=a.resultNote.moLot)return e.showToast({title:"该物料不属于当前制造单",icon:"none"}),void i.default.showAudio();if(a.order.partItemNo!=a.resultNote.partItemNo)return e.showToast({title:"物料不一致",icon:"none"}),void i.default.showAudio();if(a.order.itemNo!=a.resultNote.toProItemNo)return e.showToast({title:"该物料TO工序不属于当前工序",icon:"none"}),void i.default.showAudio();for(var s=0;s<a.details.length;s++){var n=a.details[s];if(n.tagId===a.resultNote.tagId)return i.default.showAudio(),void e.showToast({icon:"none",title:"这张已经扫过了！！"})}var u={};if(-11==t.resultCode)return o.lockModel={lockType:r.default.lockType.process_receive,sourceId:"",description:""},o.lockModel.description=a.MesDayModel.resultText,o.lockModel.sourceId=o.order.moLot,o.lockModel.lockType=r.default.lockType.process_receive,a.showAuth=!0,console.log(a.showAuth," at pages\\process\\process-receive.vue:227"),void i.default.showAudio();console.log("上工序"," at pages\\process\\process-receive.vue:232");u={sheetDate:d.format("yyyy/MM/dd hh:mm:ss"),dayId:a.resultNote.id,tagId:a.resultNote.tagId,planLot:a.resultNote.planLot,dispathLot:a.resultNote.dispathLot,moLot:a.order.moLot,difFlag:a.resultNote.difFlag,partNo:a.resultNote.partNo,partItemNo:a.resultNote.partItemNo,partName:a.resultNote.partName,partSpec:a.resultNote.partSpec,unitNo:a.resultNote.unitNo,unitName:a.resultNote.unitName,unitRate:a.resultNote.unitRate,proNo:a.resultNote.proNo,proItemNo:a.resultNote.proItemNo,proName:a.resultNote.proName,deviceNo:a.resultNote.deviceNo,deviceName:a.resultNote.deviceName,toProNo:a.resultNote.toProNo,toProItemNo:a.resultNote.toProItemNo,toProName:a.resultNote.toProName,sheetQty:a.resultNote.sheetQty,empNo:a.SendUser.empNo,toEmpNo:a.receiveUser.empNo,joinSpcSta:0==a.resultNote.spcSta?2:1,userNo:a.userInfo.userID,createDate:d.format("yyyy/MM/dd hh:mm:ss"),entityState:r.default.entityState.added};console.log(JSON.stringify(u)," at pages\\process\\process-receive.vue:266"),a.details.push(u),u={},i.default.showScanedAudio()},failure:function(e){i.default.showAudio()},complete:function(t,s,r){o.$refs.input_part.setFocus(),i.default.tryCatchApi({status:t,message:s}),e.hideLoading()}})},authClick:function(e){this.showAuth=!1;var t=this,o=e,s={};if(s.locklogDetails.push(o),1==e.resultSta){console.log(JSON.stringify(o)," at pages\\process\\process-receive.vue:293");s={sheetDate:d.format("yyyy/MM/dd hh:mm:ss"),dayId:t.resultNote.id,tagId:t.resultNote.tagId,planLot:t.resultNote.planLot,dispathLot:t.resultNote.dispathLot,moLot:t.order.moLot,difFlag:t.resultNote.difFlag,partNo:t.resultNote.partNo,partItemNo:t.resultNote.partItemNo,partName:t.resultNote.partName,partSpec:t.resultNote.partSpec,unitNo:t.resultNote.unitNo,unitName:t.resultNote.unitName,unitRate:t.resultNote.unitRate,proNo:t.resultNote.proNo,proItemNo:t.resultNote.proItemNo,proName:t.resultNote.proName,deviceNo:t.resultNote.deviceNo,deviceName:t.resultNote.deviceName,toProNo:t.resultNote.toProNo,toProItemNo:t.resultNote.toProItemNo,toProName:t.resultNote.toProName,sheetQty:t.resultNote.sheetQty,empNo:t.SendUser.empNo,toEmpNo:t.receiveUser.empNo,joinSpcSta:0===t.resultNote.spcSta?2:1,userNo:t.userInfo.userID,createDate:d.format("yyyy/MM/dd hh:mm:ss"),entityState:r.default.entityState.added,locklogDetails:[]};t.details.push(s),s={}}this.$refs.input_part.setFocus()},onSave:function(){var t=this,o=this;if(o.$refs.input_order.validInputFinish()){if(o.details.length<=0)return e.showToast({title:"请扫描交接物料！",icon:"none",mask:!0}),i.default.showAudio(),void this.$refs.input_part.setFocus();e.showLoading({mask:!0}),s.default.Pda_pdamesdayjoin({data:o.details,success:function(o){console.log(JSON.stringify(o)," at pages\\process\\process-receive.vue:359"),e.showToast({title:"保存成功",icon:"none",mask:!0}),i.default.dataInit(t),t.$refs.input_order.setOrderFocus()},failure:function(o){e.hideLoading(),e.showToast({title:"保存失败",icon:"none",mask:!0}),i.default.showAudio(),t.$refs.input_part.setFocus()},complete:function(t,o,s){i.default.tryCatchApi({status:t,message:o}),e.hideLoading()}})}},onSelectedItem:function(e){for(var t=0;t<this.details.length;t++){var o=this.details[t];t==e?(o.selectItemClass="uni-list-cell-selected",this.orderItemSelected=o):o.selectItemClass=""}},scroll:function(e){this.old.scrollTop=e.detail.scrollTop},onScrollTop:function(t){var o=this;this.onSelectedItem(t);var s=e.createSelectorQuery().in(this).select(".scroll-view-item");s.boundingClientRect(function(e){o.scrollTop=o.old.scrollTop,o.$nextTick(function(){this.scrollTop=e.height*t})}).exec()}}};t.default=p}).call(this,o("6e42")["default"])}},[["4ce6","common/runtime","common/vendor"]]]);