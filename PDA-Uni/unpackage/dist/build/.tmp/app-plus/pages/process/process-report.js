(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/process/process-report"],{"0b42":function(t,e,o){"use strict";o.r(e);var a=o("b9ce"),r=o("611a");for(var n in r)"default"!==n&&function(t){o.d(e,t,function(){return r[t]})}(n);o("de11");var i=o("2877"),s=Object(i["a"])(r["default"],a["a"],a["b"],!1,null,null,null);e["default"]=s.exports},"611a":function(t,e,o){"use strict";o.r(e);var a=o("71a7"),r=o.n(a);for(var n in a)"default"!==n&&function(t){o.d(e,t,function(){return a[t]})}(n);e["default"]=r.a},"71a7":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=s(o("2e17")),r=s(o("f2a9")),n=s(o("00e0")),i=s(o("409c"));function s(t){return t&&t.__esModule?t:{default:t}}var u=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},d=function(){return o.e("components/authorize-input/authorize-input").then(o.bind(null,"d9d3"))},l=function(){return Promise.all([o.e("common/vendor"),o.e("components/label-print/label-print")]).then(o.bind(null,"831b"))},c=function(){return o.e("components/process-scanOrder/process-scanOrder").then(o.bind(null,"4567"))},f={components:{barcodeInput:u,authorizeInput:d,labelPrint:l,processScanOrder:c},data:function(){return{accIndex:0,accList:["正常报工","首件报工"],showReport:!1,reportModel:{progNo:"",isMultiPrint:!1,dataSource:[],isNeedValidTag:!1},numQty:"",goodQty:"",badQty:"",bugDetails:[],old:{scrollTop:0},scrollTop:0,scrollHeight:0,showAuth:!1,lockModel:{lockType:2,sourceId:"",description:""},order:null}},onLoad:function(t){this.reportModel.progNo=t.progNo||"OPDA00013"},onShow:function(t){var e=n.default.get(r.default.storageKeys.navBackData_bug_data);null!=e&&(this.bugDetails=e,n.default.set(r.default.storageKeys.navBackData_bug_data,null))},onReady:function(){i.default.getListHeight(this)},onBackPress:function(t){return i.default.backPress(t,null!=this.order)},methods:{onGetOrder:function(t){var e=this;e.order=t},bindPickerChange:function(t){this.accIndex=t.target.value},getngqty:function(){var e=this;if(e.$refs.input_order.validInputFinish()){for(var o=[],a=0;a<e.order.moulds.length;a++)e.order.itemNo!=e.order.moulds[a].proItemNo&&o.push(e.order.moulds[a]);if(0==o.length)return t.showToast({title:"请先在PC工艺路线下表中设置工步工序！",icon:"none"}),void i.default.showAudio();t.navigateTo({url:"process-getngqty?moulds="+JSON.stringify(o),animationType:"slide-in-bottom",animationDuration:200})}},onSave:function(){var e=this,o=this;o.$refs.input_order.validInputFinish()&&(i.default.floatObj.subtract(this.numQty,this.goodQty)==this.badQty?(t.showLoading({mask:!0}),a.default.workReport_post({data:this.convert2MesDayModel(),success:function(o){var a=JSON.parse(o.resultNote);"-11"==o.resultCode?e.showAuth=!0:(t.showToast({title:"保存成功"}),e.reportModel.dataSource=e.convert2ScmInoutBarCodeModel(a),e.printLable())},failure:function(t){i.default.showAudio()},complete:function(e,o,a){i.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})):t.showToast({icon:"none",title:"生产数量 - 合格数量 ≠ 不良数量"}))},convert2ScmInoutBarCodeModel:function(t){var e=[],o={};o.partItemNo=t.partItemNo,o.poMoSoLot=t.moLot,o.proDate=t.sheetDate,o.deviceNo=t.deviceNo,o.deviceName=t.deviceName,o.proName=t.proName,o.proItemNo=t.proItemNo,o.reservelocus=t.reservelocus,o.toProItemNo=t.toProItemNo,o.toProName=t.toProName,o.id=t.id;var a=i.default.floatObj.subtract(t.planQty,t.dayBadQty),r=(new Date).format("yyMMddHHmmssfff");if(a>0){var n=i.default.clone(o);n.sheetQty=a,n.printType="1",n.spcSta="PASS",n.tagId="".concat(r,"-").concat(i.default.getSuffix(3,1)),e.push(n)}if(t.badQty>0){var s=i.default.clone(o);s.sheetQty=t.badQty,s.printType="0",s.spcSta="NG",s.tagId="".concat(r,"-").concat(i.default.getSuffix(3,2)),e.push(s)}return console.log(i.default.outputLog(e)," at pages\\process\\process-report.vue:255"),e},convert2MesDayModel:function(){var t=this,e=n.default.get(r.default.storageKeys.login),o={};o.sheetDate=new Date,o.moLot=this.order.moLot,o.partNo=this.order.partNo,o.partItemNo=this.order.partItemNo,o.unitNo=this.order.unitNo,o.unitRate=this.order.unitRate,o.proNo=t.order.custNo,o.proItemNo=t.order.itemNo,o.deviceNo=t.order.deviceNo,o.planQty=Number(this.numQty),o.sheetQty=Number(this.goodQty),o.badQty=Number(this.badQty),o.dayBadQty=Number(this.badQty),o.sheetDate=new Date,o.empNo=e.userID,o.workType=this.accIndex,o.bugDetails=this.bugDetails||[];for(var a=0;a<o.bugDetails.length;a++)o.bugDetails[a].entityState=r.default.entityState.added;return o.entityState=r.default.entityState.added,o},authClick:function(e){var o=this,r=this;this.showAuth=!1;var n=this.convert2MesDayModel();n.locklogDetails=[e],t.showLoading({mask:!0}),a.default.workReport_post({data:n,success:function(e){console.log(JSON.stringify(e)," at pages\\process\\process-report.vue:299"),t.showToast({title:"保存成功"}),r.reportModel.dataSource=e,r.printLable()},failure:function(t){i.default.showAudio()},complete:function(e,a,r){o.$refs.input_order.setOrderFocus(),i.default.tryCatchApi({status:e,message:a}),t.hideLoading()}})},calcBadQty:function(){this.numQty>=0&&this.goodQty>=0&&i.default.floatObj.subtract(this.numQty,this.goodQty)>=0&&(this.badQty=i.default.floatObj.subtract(this.numQty,this.goodQty))},printLable:function(){var t=this.$refs.labPri.checkUseDefaultPrint();t?this.$refs.labPri.userDefaultPrint():this.showReport=!0},printComplete:function(){i.default.dataInit(this)},scroll:function(t){this.old.scrollTop=t.detail.scrollTop}}};e.default=f}).call(this,o("6e42")["default"])},aba0:function(t,e,o){},b9ce:function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},r=[];o.d(e,"a",function(){return a}),o.d(e,"b",function(){return r})},de11:function(t,e,o){"use strict";var a=o("aba0"),r=o.n(a);r.a}},[["1b29","common/runtime","common/vendor"]]]);