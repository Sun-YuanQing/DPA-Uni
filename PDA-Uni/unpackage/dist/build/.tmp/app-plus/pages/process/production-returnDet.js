(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/process/production-returnDet"],{"0da3":function(t,e,o){"use strict";o.r(e);var a=o("5693"),n=o("bbfd");for(var s in n)"default"!==s&&function(t){o.d(e,t,function(){return n[t]})}(s);var i=o("2877"),r=Object(i["a"])(n["default"],a["a"],a["b"],!1,null,null,null);e["default"]=r.exports},5693:function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},n=[];o.d(e,"a",function(){return a}),o.d(e,"b",function(){return n})},af07:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=l(o("2e17")),n=l(o("f2a9")),s=l(o("00e0")),i=l(o("409c")),r=o("2f62");function l(t){return t&&t.__esModule?t:{default:t}}function u(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},a=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),a.forEach(function(e){c(t,e,o[e])})}return t}function c(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var d=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},h={components:{barcodeInput:d},data:function(){return{old:{scrollTop:0},scrollTop:0,scrollHeight:0,placeholder_store:"",isStorageBin:null,binNo:"",binWhNo:"",orderItemSelected:{},details:[]}},onLoad:function(t){this.details.push(JSON.parse(t.detail)),console.log(this.details," at pages\\process\\production-returnDet.vue:73"),this.details.forEach(function(t){t.scanQty=0,t.lastScanQty=t.sheetQty});var e=this;this.isStorageBin=s.default.get(n.default.storageKeys.IsStorageBin),this.isStorageBin?e.placeholder_store="扫描储位":e.placeholder_store="扫描仓库"},onReady:function(){i.default.getListHeight(this)},onBackPress:function(t){return i.default.backPress(t,this.details.length>0)},methods:u({},(0,r.mapMutations)(["pageIO_true"]),{onScanStorage:function(e){var o=this;t.showLoading({mask:!0}),this.isStorageBin?a.default.bas_storagebin({data:{binNo:e},success:function(e){e.length<=0?(t.showToast({title:"货架不存在!",icon:"none"}),o.$refs.input_store.clear(),i.default.showAudio()):(o.binNo=e[0].binNo,o.binWhNo=e[0].whNo,o.$refs.input_part.setFocus(),i.default.showScanedAudio())},complete:function(e,o,a){i.default.tryCatchApi({status:e,message:o}),t.hideLoading()}}):(console.log(e," at pages\\process\\production-returnDet.vue:127"),a.default.bas_wh({data:{filter:'whNo = "'+e+'"'},success:function(e){console.log(i.default.outputLog(e)," at pages\\process\\production-returnDet.vue:133"),e.length<=0?(t.showToast({title:"仓库不存在!",icon:"none"}),o.$refs.input_store.clear(),i.default.showAudio()):(o.binWhNo=e[0].whNo,console.log(o.binNo+"----"+o.binWhNo," at pages\\process\\production-returnDet.vue:143"),o.$refs.input_part.setFocus(),i.default.showScanedAudio())},complete:function(e,o,a){i.default.tryCatchApi({status:e,message:o}),t.hideLoading()}}))},onPartScaned:function(e){var o=this;if(t.showLoading({mask:!0}),this.isStorageBin&&""==this.binNo.trim())return t.showToast({title:"请先扫描货架",icon:"none"}),this.$refs.input_store.setFocus(),void i.default.showAudio();var n=this;a.default.OpenMes_mesqrcodeinout({data:{qrCode:e},success:function(a){var s=!1,r=function(){var r=o.details[l];return r.tagId==a.tagId?(n.onScrollTop(l),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?(n.details.splice(l,1),n.updateScanList(-r.sheetQty)):t.cancel}}),i.default.showAudio(),{v:void 0}):r.partItemNo==a.partItemNo||r.purLot==a.poMoSoLot?r.sheetQty-r.scanQty<a.sheetQty?(t.showToast({title:"超出应收数量",icon:"none"}),i.default.showAudio(),n.onScrollTop(l),n.$refs.input_part.setFocus(),{v:void 0}):(s=!0,n.onScrollTop(l),a.tagDetails?a.tagDetails.forEach(function(t){n.isStorageBin?(t.binNo=n.binNo,t.binWhNo=n.binWhNo):(t.binNo=r.whNo,t.binWhNo=r.whNo),t.sheetQty=Number(a.sheetQty),t.scan_qrCode=e,r.tagDetails=r.tagDetails||[],r.tagDetails.push(t)}):(n.isStorageBin?(a.binNo=n.binNo,a.binWhNo=n.binWhNo):(a.binNo=r.whNo,a.binWhNo=r.whNo),a.sheetQty=Number(a.sheetQty),a.scan_qrCode=e,r.tagDetails=r.tagDetails||[],r.tagDetails.push(a)),t.showToast({title:"扫描成功"}),console.log(i.default.outputLog(n.details)," at pages\\process\\production-returnDet.vue:248"),n.updateScanList(),o.$refs.input_part.clear(),i.default.showScanedAudio(),i.default.automateSave(n.details,"lastScanQty",0,n.onSave),"break"):void 0};t:for(var l=0;l<o.details.length;l++){var u=r();switch(u){case"break":break t;default:if("object"===typeof u)return u.v}}s||(t.showToast({title:"当前上架物料错误！！",icon:"none"}),i.default.showAudio())},failure:function(t){i.default.showAudio()},complete:function(e,a,n){o.$refs.input_part.setFocus(),i.default.tryCatchApi({status:e,message:a}),t.hideLoading()}})},onSave:function(){for(var e=this,o=0;o<this.details.length;o++){var s=this.details[o];if(s.lastScanQty>0)return void t.showToast({title:"还有未上架的物料",icon:"none"})}var r=[];for(o=0;o<this.details.length;o++){s=this.details[o];if(s.tagDetails=s.tagDetails||[],s.tagDetails.length>0)for(var l=0;l<s.tagDetails.length;l++){var u=s.tagDetails[l];u.sheetLot=s.sheetLot,u.sheetDate=s.sheetDate,u.sheetNo=s.sheetNo,u.partSpec=s.partSpec,u.partAttr=s.partAttr,u.purLot=s.purLot,u.proLot=s.proLot,u.inoutFlag="1",u.entityState=n.default.entityState.added,r.push(u)}}t.showLoading({title:"加载中",mask:!0}),a.default.acceptreturn_Save({data:r,success:function(o){t.showToast({title:"保存成功"}),e.pageIO_true(),i.default.showScanedAudio(),setTimeout(function(){t.navigateBack()},600),e.isStorageBin?e.placeholder_store="扫描储位":e.placeholder_store="扫描仓库"},failure:function(t){i.default.showAudio()},complete:function(e,o,a){i.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},updateScanList:function(){var t=0;if(this.orderItemSelected.tagDetails)for(var e=0;e<this.orderItemSelected.tagDetails.length;e++)t=i.default.floatObj.add(t,this.orderItemSelected.tagDetails[e].sheetQty);this.orderItemSelected.scanQty=t,this.orderItemSelected.lastScanQty=i.default.floatObj.subtract(this.orderItemSelected.sheetQty,t);var o=i.default.clone(this.orderItemSelected);this.orderItemSelected=o},onSelectedItem:function(t){for(var e=0;e<this.details.length;e++){var o=this.details[e];e==t?(o.selectItemClass="uni-list-cell-selected",this.orderItemSelected=o):o.selectItemClass=""}},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var a=t.createSelectorQuery().in(this).select(".scroll-view-item");a.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,null!=t&&o.$nextTick(function(){this.scrollTop=t.height*e})}).exec()}})};e.default=h}).call(this,o("6e42")["default"])},bbfd:function(t,e,o){"use strict";o.r(e);var a=o("af07"),n=o.n(a);for(var s in a)"default"!==s&&function(t){o.d(e,t,function(){return a[t]})}(s);e["default"]=n.a}},[["a6e2","common/runtime","common/vendor"]]]);