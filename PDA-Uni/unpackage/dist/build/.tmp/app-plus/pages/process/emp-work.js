(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/process/emp-work"],{"0654":function(e,t,o){"use strict";var i=function(){var e=this,t=e.$createElement;e._self._c},a=[];o.d(t,"a",function(){return i}),o.d(t,"b",function(){return a})},"17a6":function(e,t,o){"use strict";o.r(t);var i=o("0654"),a=o("fec0");for(var d in a)"default"!==d&&function(e){o.d(t,e,function(){return a[e]})}(d);var s=o("2877"),n=Object(s["a"])(a["default"],i["a"],i["b"],!1,null,null,null);t["default"]=n.exports},4703:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(o("2e17")),a=n(o("f2a9")),d=n(o("00e0")),s=n(o("409c"));function n(e){return e&&e.__esModule?e:{default:e}}var r=new Date,c=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},l={components:{barcodeInput:c},data:function(){return{ScanstaffValue:"",ScanDeviceValue:"",allowScanPro:!0,progNo:"",proName:"string",backchecked:!0,deviceNo:"",deviceName:"",proNo:"",proItemNo:"",old:{scrollTop:0},scrollTop:0,scrollHeight:0,order:{orgNo:"0",details:[],details_delete:[],entityState:0},orderItemSelected:{empNo:""},padBinding:{configDevice:"",deviceName:"",proName:""}}},onShow:function(){},onLoad:function(e){this.progNo=e.progNo||"OPDA00009",console.log(this.progNo+"-----------"+r.format("yyyy/MM/dd hh:mm:ss")," at pages\\process\\emp-work.vue:116")},onReady:function(){s.default.getListHeight(this)},onBackPress:function(t){if("navigateBack"===t.from)return!1;for(var o=!1,i=0;i<this.order.details.length;i++){var a=this.order.details[i];a.checked?o=!0:this.backchecked=!0,a.checked=!1}return!this.backchecked||!1!==o||(e.navigateBack(),!0)},methods:{onSelectedItem:function(e){this.backchecked=!1;for(var t=this.order.details,o=0;o<t.length;o++){var i=t[o];void 0==i.checked&&(i.checked=!1),o==e?(o,i.selectItemClass="uni-list-cell-selected",this.orderItemSelected=i,i.checked=!i.checked):i.selectItemClass=""}this.order.details=[],this.order.details=t},scroll:function(e){this.old.scrollTop=e.detail.scrollTop},onScrollTop:function(t){var o=this;t-=1,t=parseInt(t/4);var i=e.createSelectorQuery().in(this).select(".scroll-view-item");i.boundingClientRect(function(e){o.scrollTop=o.old.scrollTop,o.$nextTick(function(){this.scrollTop=e.height*t})}).exec()},ondelete_user:function(){for(var e=this,t=[],o=0;o<this.order.details.length;o++){var i=this.order.details[o];!0===i.checked?(console.log("删除前---"+JSON.stringify(i)," at pages\\process\\emp-work.vue:231"),i.entityState_new=i.entityState,i.entityState=a.default.entityState.deleted,e.order.details_delete.push(i),console.log("删除---"+JSON.stringify(i)," at pages\\process\\emp-work.vue:235")):t.push(i)}this.order.details=[],this.order.details=t,console.log("this.order---"+JSON.stringify(this.order)," at pages\\process\\emp-work.vue:242")},onall:function(){for(var e=this.order.details,t=0;t<e.length;t++){var o=e[t];o.checked=!0}this.order.details=[],this.order.details=e},onnooff:function(){for(var e=this.order.details,t=0;t<e.length;t++){var o=e[t];o.checked=!o.checked}this.order.details=[],this.order.details=e},onScanstaff:function(t){var o=this,n=this;console.log(JSON.stringify(t)," at pages\\process\\emp-work.vue:264"),i.default.emp_a({data:{empNo:t},success:function(i){if(i.empNo){for(var c=d.default.get(a.default.storageKeys.login),l=!1,u={deviceNo:o.padBinding.configDevice,deviceName:o.padBinding.deviceName,proNo:o.padBinding.configPro,proItemNo:o.padBinding.proItemNo,proName:o.padBinding.proName,checked:!1,empNo:i.empNo,empName:i.empName,clockInTime:r.format("yyyy/MM/dd hh:mm:ss"),userNo:c.userID,createDate:r.format("yyyy/MM/dd hh:mm:ss")||(new Date).format("yyyy/MM/dd hh:mm:ss"),entityState:a.default.entityState.added},p=0;p<o.order.details.length;p++){var f=o.order.details[p];f.tagDetails=f.tagDetails||[];for(var h=0;h<f.tagDetails.length;h++){var g=f.tagDetails[h];if(g.qrCode==t)return o.onScrollTop(p),e.showModal({title:"提示",content:"人员已存在,是否要删除？",success:function(e){if(e.confirm){for(var t=0;t<n.order.details_delete.length;t++){var o=n.order.details_delete[t];f.empNo!=o.empNo&&!0===f.init&&(f.entityState_new=f.entityState,f.entityState=a.default.entityState.deleted,n.order.details_delete.push(f))}n.order.details.splice(t,1)}else e.cancel}}),void s.default.showAudio()}if(f.empNo===u.empNo){l=!0,e.showToast({title:"扫描成功"}),f.tagDetails.push({model:i,qrCode:t}),o.onSelectedItem(p),o.onScrollTop(p),s.default.showScanedAudio();break}for(h=0;h<n.order.details_delete.length;h++){var m=n.order.details_delete[h];if(m.empNo===u.empNo){l=!0,m.entityState=m.entityState_new,n.order.details.push(m),n.order.details_delete.splice(h,1),e.showToast({title:"扫描成功"}),s.default.showScanedAudio();break}}}0!==o.order.details.length&&!1!==l||(o.order.details.push(u),console.log(JSON.stringify(JSON.stringify(u))," at pages\\process\\emp-work.vue:353"),e.showToast({title:"扫描成功"}),s.default.showScanedAudio())}else e.showToast({title:"不存在！",icon:"none"}),s.default.showAudio();console.log(JSON.stringify(JSON.stringify(o.order))," at pages\\process\\emp-work.vue:366"),o.$refs.input_emp.setFocus()},failure:function(e){return o.$refs.input_emp.setFocus(),s.default.showAudio(),!1},complete:function(t,o,i){s.default.tryCatchApi({status:t,message:o}),e.hideLoading()}}),this.$refs.input_emp.setFocus()},onScanDevice:function(t){e.showLoading({mask:!0});var o=this;i.default.device_user_query({data:{deviceNo:t.toLocaleString(),proItemNo:o.padBinding.proItemNo},success:function(a){if(console.log(s.default.outputLog(a)," at pages\\process\\emp-work.vue:397"),0==a.length)s.default.getPadBinding({data:{deviceNo:t,showTips:!1},success:function(a){console.log(s.default.outputLog(a)," at pages\\process\\emp-work.vue:405"),o.allowScanPro=null==a,null==a?i.default.basic_DeviceGetModel({data:{deviceNo:t},success:function(e){console.log(s.default.outputLog(e)," at pages\\process\\emp-work.vue:413"),o.padBinding.configDevice=e.deviceNo,o.padBinding.deviceName=e.deviceName,o.$refs.input_pro.setFocus()},failure:function(e){o.$refs.input_device.setFocus(),s.default.showAudio()},complete:function(t,o,i){s.default.tryCatchApi({status:t,message:o}),e.hideLoading()}}):(o.padBinding=a,s.default.showScanedAudio())},failure:function(){s.default.showAudio(),o.padBinding={proName:""},o.$refs.input_device.clear()}});else{o.allowScanPro=!1,o.order.details=[];for(var d=0;d<a.length;d++){var n=a[d];n.init=!0,o.order.details.push(n)}o.padBinding.configDevice=o.order.details[0].deviceNo,o.padBinding.deviceName=o.order.details[0].deviceName,o.padBinding.configPro=o.order.details[0].proNo,o.padBinding.proItemNo=o.order.details[0].proItemNo,o.padBinding.proName=o.order.details[0].proName,s.default.showScanedAudio(),o.$refs.input_emp.setFocus()}},failure:function(e){o.$refs.input_device.setFocus(),s.default.showAudio()},complete:function(t,o,i){s.default.tryCatchApi({status:t,message:o}),e.hideLoading()}})},onProScaned:function(t){var o=this;e.showLoading({mask:!0});var a=this;i.default.basic_ProcessModel({data:{proNo:t},success:function(t){console.log(s.default.outputLog(t)," at pages\\process\\emp-work.vue:489"),o.padBinding.configPro=t.custNo,o.padBinding.proItemNo=t.itemNo,o.padBinding.proName=t.custName,o.padBinding.proName&&i.default.device_user_query({data:{deviceNo:a.padBinding.configDevice,proItemNo:a.padBinding.proItemNo},success:function(e){a.order.details=[];for(var t=0;t<e.length;t++){var o=e[t];o.init=!0,a.order.details.push(o)}e.length>0&&(a.padBinding.configDevice=a.order.details[0].deviceNo,a.padBinding.deviceName=a.order.details[0].deviceName,a.padBinding.configPro=a.order.details[0].proNo,a.padBinding.proItemNo=a.order.details[0].proItemNo,a.padBinding.proName=a.order.details[0].proName,s.default.showScanedAudio(),a.$refs.input_emp.setFocus())},failure:function(e){o.$refs.input_pro.setFocus(),s.default.showAudio()},complete:function(t,o,i){s.default.tryCatchApi({status:t,message:o}),e.hideLoading()}})},failure:function(e){o.$refs.input_pro.setFocus(),s.default.showAudio()},complete:function(t,o,i){s.default.tryCatchApi({status:t,message:o}),e.hideLoading()}})},onSave:function(){for(var t=this,o=this.order.details,a=this.order.details_delete,d=0;d<o.length;d++)o[d].deviceNo=this.padBinding.configDevice,o[d].deviceName=this.padBinding.deviceName,o[d].proNo=this.padBinding.configPro,o[d].proItemNo=this.padBinding.proItemNo,o[d].proName=this.padBinding.proName,o[d].checked=!1;for(d=0;d<a.length;d++){var n=a[d];console.log("删除的数据"+JSON.stringify(n)," at pages\\process\\emp-work.vue:558"),!0===n.init&&(n.deviceNo=this.padBinding.configDevice,n.deviceName=this.padBinding.deviceName,n.proNo=this.padBinding.configPro,n.proItemNo=this.padBinding.proItemNo,n.proName=this.padBinding.proName,n.checked=!1,o.push(n))}if(this.order.details=[],this.order.details=o,console.log("res保存this.order.details--"+JSON.stringify(this.order.details)," at pages\\process\\emp-work.vue:571"),this.order.details.length<=0)e.showToast({title:"请添加人员！！",icon:"none"});else{var r=this;console.log(r.order.details," at pages\\process\\emp-work.vue:580"),e.showLoading({mask:!0}),i.default.device_user_edit({data:r.order.details,success:function(o){e.showToast({title:"保存成功"}),s.default.dataInit(t)},failure:function(e){s.default.showAudio()},complete:function(t,o,i){s.default.tryCatchApi({status:t,message:o}),e.hideLoading()}})}}}};t.default=l}).call(this,o("6e42")["default"])},fec0:function(e,t,o){"use strict";o.r(t);var i=o("4703"),a=o.n(i);for(var d in i)"default"!==d&&function(e){o.d(t,e,function(){return i[e]})}(d);t["default"]=a.a}},[["81fb","common/runtime","common/vendor"]]]);