(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/process/production-print"],{"11d3":function(e,t,o){},1432:function(e,t,o){"use strict";o.r(t);var n=o("d852"),i=o.n(n);for(var r in n)"default"!==r&&function(e){o.d(t,e,function(){return n[e]})}(r);t["default"]=i.a},4101:function(e,t,o){"use strict";o.r(t);var n=o("e6cd"),i=o("1432");for(var r in i)"default"!==r&&function(e){o.d(t,e,function(){return i[e]})}(r);o("c943");var a=o("2877"),s=Object(a["a"])(i["default"],n["a"],n["b"],!1,null,null,null);t["default"]=s.exports},c943:function(e,t,o){"use strict";var n=o("11d3"),i=o.n(n);i.a},d852:function(module,exports,__webpack_require__){"use strict";(function(uni){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _apiService=_interopRequireDefault(__webpack_require__("2e17")),_consts=_interopRequireDefault(__webpack_require__("f2a9")),_storage=_interopRequireDefault(__webpack_require__("00e0")),_util=_interopRequireDefault(__webpack_require__("409c")),_vuex=__webpack_require__("2f62");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),n.forEach(function(t){_defineProperty(e,t,o[t])})}return e}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var barcodeInput=function(){return __webpack_require__.e("components/barcode-input/barcode-input").then(__webpack_require__.bind(null,"d7ce"))},mpvuePicker=function(){return __webpack_require__.e("components/mpvue-picker/mpvuePicker").then(__webpack_require__.bind(null,"80f1"))},uniSwipeAction=function(){return __webpack_require__.e("components/uni-swipe-action/uni-swipe-action").then(__webpack_require__.bind(null,"c480"))},printButton=function(){return __webpack_require__.e("components/label-print/print-button").then(__webpack_require__.bind(null,"4ae8"))},erpInterfaceType=null,mesInLotType=null,_default={components:{barcodeInput:barcodeInput,mpvuePicker:mpvuePicker,uniSwipeAction:uniSwipeAction,printButton:printButton},data:function(){return{progNo:"",reportModel:{progNo:"",showReport:!1,isMultiPrint:!1,dataSource:[],isNeedValidTag:!0},numQty_focus:!1,num_focus:!1,num:0,numQty:0,old:{scrollTop:0},scrollTop:0,scrollHeight:0,m_defineShow:!1,order:{inLot:"",poMoSoLot:"",proDate:" ",citemNo:"",suPartNo:"",sheetQty:0,createTagQty:0,lastTagQty:0,partItemNo:""},details:[],det_id:0,showProLot:!1,options_delet:[{text:"删除",style:{backgroundColor:"rgb(255,58,49)"}}],part:{define1:"",define2:"",define3:"",define4:"",define5:""}}},onLoad:function(e){this.reportModel.progNo=e.progNo,this.progNo=e.progNo,this.erpInterfaceType=_storage.default.get(_consts.default.storageKeys.erpInterfaceType),this.mesInLotType=_storage.default.get(_consts.default.storageKeys.mesInLotType),this.showProLot=this.erpInterfaceType==_consts.default.erpInterfaceType.anfeinuo,this.erpInterfaceType==_consts.default.erpInterfaceType.anfeinuo&&(this.m_defineShow=!0)},onReady:function onReady(){_util.default.getListHeight(this);var _self=this;setTimeout(function(){var val=_self.scrollHeight;0!=val&&(val=_self.scrollHeight.replace("px","")),console.log(val," at pages\\process\\production-print.vue:223"),eval(200-val)>0&&(_self.scrollHeight="200px",console.log(_self.scrollHeight," at pages\\process\\production-print.vue:226"))},1500),_self.$refs.input_order.setFocus()},onBackPress:function(e){return _util.default.backPress(e,this.details.length>0)},onShow:function(){var e=this;e.pageIO_submit&&(e.pageIO_false(),e.onScaned(e.order.poMoSoLot))},computed:(0,_vuex.mapState)(["pageIO_submit"]),methods:_objectSpread({},(0,_vuex.mapMutations)(["pageIO_false","setUrldata"]),{onScaned:function(e){var t=this;uni.showLoading({mask:!0}),_apiService.default.acceptLotPur_MK_GetModel({data:{moLot:e,type:0},success:function(e){e.poMoSoLot=e.purLot,t.erpInterfaceType==_consts.default.erpInterfaceType.anfeinuo&&(e.proLot=t.getYearWeek()),t.mesInLotType==_consts.default.mesInLotType.MoLot?e.inLot=e.purLot:t.mesInLotType==_consts.default.mesInLotType.OrdMoLot?e.inLot=null==e.ordLot?e.purLot:e.ordLot:t.mesInLotType==_consts.default.mesInLotType.MoLotYearWeek?e.inLot=e.purLot+t.getYearWeek():t.mesInLotType==_consts.default.mesInLotType.MoLotYMD&&(e.inLot=e.purLot+new Date(e.proDate).format("yyMMdd")),e.proDate=new Date(e.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),e.citemNo=e.citemNo||"",e.lastTagQty=_util.default.floatObj.subtract(e.sheetQty,e.createTagQty),e.lastTagQty>e.minPackingQty?t.numQty=e.minPackingQty:t.numQty=e.lastTagQty,t.num=1,t.order=e,t.numQty_focus=!0,_util.default.showScanedAudio(),console.log(JSON.stringify(e)," at pages\\process\\production-print.vue:280")},failure:function(e){t.$refs.input_order.setFocus(),_util.default.showAudio()},complete:function(e,t,o){_util.default.tryCatchApi({status:e,message:t}),uni.hideLoading()}})},onNumAdd:function(e){if(this.numQty<=0)uni.showToast({title:"数量必须要大于0",icon:"none"});else if(this.num<=0)uni.showToast({title:"包数必须要大于0",icon:"none"});else{for(var t=0,o=0;o<this.details.length;o++)t=_util.default.floatObj.add(t,_util.default.floatObj.multiply(this.details[o].num,this.details[o].numQty));if(t>this.order.lastTagQty)uni.showToast({title:"生产数量 不可超过 未生产数量！！！！",icon:"none"});else{var n=this.order.lastTagQty-(t+this.numQty*this.num);n<0?uni.showToast({title:"数量录入有误",icon:"none"}):(this.details.push({det_id:this.det_id,num:this.num,numQty:this.numQty}),this.det_id=this.det_id+1,console.log("剩余数量---"+n," at pages\\process\\production-print.vue:346"),n>this.order.minPackingQty?this.numQty=this.order.minPackingQty:(this.numQty=n,this.num=1,this.numQty<=0&&(this.num=0,this.numQty=0)))}}},onSave:function(){var e=this;if(0!=this.details.length)if(0!=this.order.lastTagQty){for(var t=this,o=[],n=(new Date).format("yyMMddHHmmssfff"),i=0,r=0,a=0;a<this.details.length;a++){var s=this.details[a];r=_util.default.floatObj.add(r,_util.default.floatObj.multiply(s.num,s.numQty));for(var u=0;u<s.num;u++){i++;var l=_util.default.clone(this.order);console.log(_util.default.outputLog(new Date(t.order.proDate).format("yyyy/MM/dd"))," at pages\\process\\production-print.vue:397"),l.sheetQty=s.numQty,l.tagId="".concat(n,"-").concat(_util.default.getSuffix(3,i)),l.proDate=new Date(t.order.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),l.createDate=new Date(t.order.createDate).format("yyyy/MM/dd hh:mm:ss")||(new Date).format("yyyy/MM/dd hh:mm:ss"),l.define1=t.part.define1,l.define2=t.part.define2,l.define3=t.part.define3,l.define4=t.part.define4,l.define5=t.part.define5,l.entityState=_consts.default.entityState.added,o.push(l)}}uni.showLoading({mask:!0}),_apiService.default.acceptLotPur_Print_Post({data:o,success:function(t){e.order.createTagQty+=r,e.order.lastTagQty=_util.default.floatObj.subtract(e.order.sheetQty,e.order.createTagQty),e.details=[];for(var o=0;o<t.length;o++){var n=t[o];n.proDate=new Date(n.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),n.createDate=new Date(n.createDate).format("yyyy/MM/dd hh:mm:ss")||(new Date).format("yyyy/MM/dd hh:mm:ss")}e.reportModel.dataSource=t,e.$refs.printBtn.execPrint()},complete:function(e,t,o){_util.default.tryCatchApi({status:e,message:t}),uni.hideLoading()}})}else uni.showToast({title:"标签产生完成，不需要再次打印",icon:"none"});else uni.showToast({title:"请输入要打印的数据",icon:"none"})},printComplete:function(){_util.default.dataInit(this),this.erpInterfaceType==_consts.default.erpInterfaceType.anfeinuo&&(_self.m_defineShow=!0),this.$refs.input_order.setFocus()},tagValid:function(e){_util.default.dataInit(this),this.erpInterfaceType==_consts.default.erpInterfaceType.anfeinuo&&(_self.m_defineShow=!0),this.$refs.input_order.setFocus()},scroll:function(e){this.old.scrollTop=e.detail.scrollTop},onScrollTop:function(e){var t=this;this.onSelectedItem(e);var o=uni.createSelectorQuery().in(this).select(".scroll-view-item");o.boundingClientRect(function(o){t.scrollTop=t.old.scrollTop,null!=o&&t.$nextTick(function(){this.scrollTop=o.height*e})}).exec()},onSelectedItem:function(e){for(var t=0;t<this.details.length;t++){var o=this.details[t];o.selectItemClass=t==e?"uni-list-cell-selected":""}},getYearWeek:function(){var e=new Date,t=new Date(e.getFullYear(),0,1),o=t.getDay(),n=1;0!=o&&(n=7-o+1),t=new Date(e.getFullYear(),0,1+n);var i=Math.ceil((e.valueOf()-t.valueOf())/864e5),r=Math.ceil(i/7)+1,a=e.getFullYear()+"";return a.substr(2,2)+_util.default.getSuffix(2,r)},showDatePicker:function(){this.$refs.mpvuePicker.show()},onPickerConfirm:function(e){this.order.proDate=new Date(e.label).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd")},bindClick:function(e){for(var t=0,o=this,n=0;n<this.details.length;n++){var i=this.details[n];if(i.det_id==e.det_id){o.details.splice(n,1);break}}for(n=0;n<this.details.length;n++)t+=this.details[n].num*this.details[n].numQty;this.order.lastTagQty-t>this.order.minPackingQty?this.numQty=this.order.minPackingQty:(this.numQty=this.order.lastTagQty-t,this.num=1)},onnavigateTo:function(){var e=this;if(""==this.order.poMoSoLot)return uni.showToast({title:"请扫描制造批号！",icon:"none"}),_util.default.showAudio(),void this.$refs.input_order.setFocus();this.setUrldata(e.order),uni.navigateTo({url:"production-printDet?progNo="+e.progNo})}})};exports.default=_default}).call(this,__webpack_require__("6e42")["default"])},e6cd:function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},i=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return i})}},[["4bf6","common/runtime","common/vendor"]]]);