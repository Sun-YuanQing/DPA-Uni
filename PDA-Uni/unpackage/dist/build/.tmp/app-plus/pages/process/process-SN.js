(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/process/process-SN"],{2128:function(e,t,i){"use strict";i.r(t);var n=i("5414"),o=i.n(n);for(var a in n)"default"!==a&&function(e){i.d(t,e,function(){return n[e]})}(a);t["default"]=o.a},"4fef":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},o=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o})},5414:function(module,exports,__webpack_require__){"use strict";(function(uni){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _apiService=_interopRequireDefault(__webpack_require__("2e17")),_consts=_interopRequireDefault(__webpack_require__("f2a9")),_storage=_interopRequireDefault(__webpack_require__("00e0")),_util=_interopRequireDefault(__webpack_require__("409c"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var barcodeInput=function(){return __webpack_require__.e("components/barcode-input/barcode-input").then(__webpack_require__.bind(null,"d7ce"))},mpvuePicker=function(){return __webpack_require__.e("components/mpvue-picker/mpvuePicker").then(__webpack_require__.bind(null,"80f1"))},uniSwipeAction=function(){return __webpack_require__.e("components/uni-swipe-action/uni-swipe-action").then(__webpack_require__.bind(null,"c480"))},printButton=function(){return __webpack_require__.e("components/label-print/print-button").then(__webpack_require__.bind(null,"4ae8"))},erpInterfaceType=null,_default={components:{barcodeInput:barcodeInput,mpvuePicker:mpvuePicker,uniSwipeAction:uniSwipeAction,printButton:printButton},data:function(){return{reportModel:{progNo:"",showReport:!1,isMultiPrint:!1,dataSource:[],isNeedValidTag:!1},num:0,numQty:1,old:{scrollTop:0},scrollTop:0,scrollHeight:0,order:{inLot:"",poMoSoLot:"",proDate:" ",citemNo:"",suPartNo:"",sheetQty:0,createTagQty:0,lastTagQty:0,partItemNo:""},details:[],det_id:0,showProLot:!1,options_delet:[{text:"删除",style:{backgroundColor:"rgb(255,58,49)"}}]}},onLoad:function(e){this.reportModel.progNo=e.progNo,this.erpInterfaceType=_storage.default.get(_consts.default.storageKeys.erpInterfaceType),this.showProLot=this.erpInterfaceType==_consts.default.erpInterfaceType.anfeinuo},onReady:function onReady(){_util.default.getListHeight(this);var _self=this;setTimeout(function(){var val=_self.scrollHeight;0!=val&&(val=_self.scrollHeight.replace("px","")),console.log(val," at pages\\process\\process-SN.vue:210"),eval(200-val)>0&&(_self.scrollHeight="200px",console.log(_self.scrollHeight," at pages\\process\\process-SN.vue:213"))},1500)},onBackPress:function(e){return _util.default.backPress(e,this.details.length>0)},methods:{onScaned:function(e){var t=this;uni.showLoading({mask:!0}),_apiService.default.acceptLotPur_MK_GetModel({data:{moLot:e,type:2},success:function(e){console.log(JSON.stringify(e)," at pages\\process\\process-SN.vue:231"),e.poMoSoLot=e.purLot,t.erpInterfaceType==_consts.default.erpInterfaceType.anfeinuo?(e.inLot=e.purLot,e.proLot=t.getYearWeek()):t.erpInterfaceType==_consts.default.erpInterfaceType.suoyuan&&(e.inLot=e.purLot+new Date(e.proDate).format("yyMMdd")),e.proDate=new Date(e.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),e.citemNo=e.citemNo||"",e.lastTagQty=_util.default.floatObj.subtract(e.sheetQty,e.createTagQty),e.lastTagQty>e.minPackingQty?t.num=e.minPackingQty:t.num=e.lastTagQty,t.order=e,_util.default.showScanedAudio()},failure:function(e){t.$refs.input_order.setFocus(),_util.default.showAudio()},complete:function(e,t,i){_util.default.tryCatchApi({status:e,message:t}),uni.hideLoading()}})},onNumAdd:function(e){if(this.numQty<=0)uni.showToast({title:"数量必须要大于0",icon:"none"});else if(this.num<=0)uni.showToast({title:"包数必须要大于0",icon:"none"});else{for(var t=0,i=0;i<this.details.length;i++)t=_util.default.floatObj.add(t,_util.default.floatObj.multiply(this.details[i].num,this.details[i].numQty));if(t>this.order.lastTagQty)uni.showToast({title:"生产数量 不可超过 未生产数量！！！！",icon:"none"});else{var n=this.order.lastTagQty-(t+this.numQty*this.num);n<0?uni.showToast({title:"数量录入有误",icon:"none"}):(this.details.push({det_id:this.det_id,num:this.num,numQty:this.numQty}),this.det_id=this.det_id+1,console.log("剩余数量---"+n," at pages\\process\\process-SN.vue:317"),n>this.order.minPackingQty?this.num=this.order.minPackingQty:(this.num=n,this.num<=0&&(this.num=0,this.numQty=0)))}}},onSave:function(){var e=this;if(0!=this.details.length)if(0!=this.order.lastTagQty){for(var t=[],i=((new Date).format("yyMMddHHmmssfff"),0),n=0;n<this.details.length;n++){var o=this.details[n];i=_util.default.floatObj.add(i,_util.default.floatObj.multiply(o.num,o.numQty));for(var a=0;a<o.num;a++){0;var r=_util.default.clone(this.order);r.sheetQty=o.numQty,r.entityState=_consts.default.entityState.added,t.push(r)}}uni.showLoading({mask:!0}),_apiService.default.OpenMes_scmreqbarcodeserial({data:t,success:function(t){e.order.createTagQty+=i,e.order.lastTagQty=_util.default.floatObj.subtract(e.order.sheetQty,e.order.createTagQty),e.details=[];for(var n=0;n<t.length;n++){var o=t[n];o.proDate=new Date(o.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),o.createDate=new Date(o.createDate).format("yyyy/MM/dd hh:mm:ss")||(new Date).format("yyyy/MM/dd hh:mm:ss")}e.reportModel.dataSource=t,e.$refs.printBtn.execPrint()},complete:function(e,t,i){_util.default.tryCatchApi({status:e,message:t}),uni.hideLoading()}})}else uni.showToast({title:"标签产生完成，不需要再次打印",icon:"none"});else uni.showToast({title:"请输入要打印的数据",icon:"none"})},printComplete:function(){_util.default.dataInit(this),this.$refs.input_order.setFocus()},tagValid:function(e){_util.default.dataInit(this),this.$refs.input_order.setFocus()},scroll:function(e){this.old.scrollTop=e.detail.scrollTop},onScrollTop:function(e){var t=this;this.onSelectedItem(e);var i=uni.createSelectorQuery().in(this).select(".scroll-view-item");i.boundingClientRect(function(i){t.scrollTop=t.old.scrollTop,null!=i&&t.$nextTick(function(){this.scrollTop=i.height*e})}).exec()},onSelectedItem:function(e){for(var t=0;t<this.details.length;t++){var i=this.details[t];i.selectItemClass=t==e?"uni-list-cell-selected":""}},getYearWeek:function(){var e=new Date,t=new Date(e.getFullYear(),0,1),i=t.getDay(),n=1;0!=i&&(n=7-i+1),t=new Date(e.getFullYear(),0,1+n);var o=Math.ceil((e.valueOf()-t.valueOf())/864e5),a=Math.ceil(o/7)+1,r=e.getFullYear()+"";return r.substr(2,2)+_util.default.getSuffix(2,a)},showDatePicker:function(){this.$refs.mpvuePicker.show()},onPickerConfirm:function(e){this.order.proDate=new Date(e.label).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd")},bindClick:function(e){for(var t=0,i=this,n=0;n<this.details.length;n++){var o=this.details[n];if(o.det_id==e.det_id){i.details.splice(n,1);break}}for(n=0;n<this.details.length;n++)t+=this.details[n].num*this.details[n].numQty;this.order.lastTagQty-t>this.order.minPackingQty?this.num=this.order.minPackingQty:(this.num=this.order.lastTagQty-t,this.numQty=1)}}};exports.default=_default}).call(this,__webpack_require__("6e42")["default"])},c173:function(e,t,i){},d34d:function(e,t,i){"use strict";i.r(t);var n=i("4fef"),o=i("2128");for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);i("ede6");var r=i("2877"),s=Object(r["a"])(o["default"],n["a"],n["b"],!1,null,null,null);t["default"]=s.exports},ede6:function(e,t,i){"use strict";var n=i("c173"),o=i.n(n);o.a}},[["2ff3","common/runtime","common/vendor"]]]);