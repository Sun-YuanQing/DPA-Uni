(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/process/process-box"],{5263:function(t,e,o){"use strict";o.r(e);var r=o("8162"),n=o("9857");for(var a in n)"default"!==a&&function(t){o.d(e,t,function(){return n[t]})}(a);var i=o("2877"),u=Object(i["a"])(n["default"],r["a"],r["b"],!1,null,null,null);e["default"]=u.exports},8162:function(t,e,o){"use strict";var r=function(){var t=this,e=t.$createElement;t._self._c},n=[];o.d(e,"a",function(){return r}),o.d(e,"b",function(){return n})},9857:function(t,e,o){"use strict";o.r(e);var r=o("bee0"),n=o.n(r);for(var a in r)"default"!==a&&function(t){o.d(e,t,function(){return r[t]})}(a);e["default"]=n.a},bee0:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=u(o("2e17")),n=u(o("f2a9")),a=u(o("00e0")),i=u(o("409c"));function u(t){return t&&t.__esModule?t:{default:t}}var s=function(){return o.e("components/uni-popup-modal/uni-popup-modal").then(o.bind(null,"b32a"))},d=function(){return o.e("components/uni-popup/uni-popup").then(o.bind(null,"4f86"))},l=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},p=function(){return o.e("components/uni-swipe-action/uni-swipe-action").then(o.bind(null,"c480"))},c=function(){return o.e("components/label-print/print-button").then(o.bind(null,"4ae8"))},f=function(){return o.e("components/mpvue-picker/mpvuePicker").then(o.bind(null,"80f1"))},h={components:{barcodeInput:l,uniPopup:d,uniPopupModal:s,uniSwipeAction:p,printButton:c,mpvuePicker:f},data:function(){return{progNo:"",old:{scrollTop:0},scrollTop:0,scrollHeight:0,purLot:"",det_id:0,options_delet:[{text:"删除",style:{backgroundColor:"rgb(255,58,49)"}}],order:{inLot:"",poMoSoLot:"",proLot:"",proDate:"",citemNo:"",suPartNo:"",sheetQty:0,createTagQty:0,lastTagQty:0,boxPackingQty:"",minPackingQty:"",partItemNo:"",partName:""},numQty:0,num:1,details:[],showProLot:!1,reportModel:{progNo:"",showReport:!1,isMultiPrint:!1,dataSource:[],isNeedValidTag:!1},showScanBoxTag:!1,the_totalQty:0,menu:[],menu_dele:!1}},onLoad:function(t){this.progNo=t.progNo,this.reportModel.progNo=t.progNo,this.erpInterfaceType=a.default.get(n.default.storageKeys.erpInterfaceType),this.mesInLotType=a.default.get(n.default.storageKeys.mesInLotType),this.showProLot=this.erpInterfaceType==n.default.erpInterfaceType.anfeinuo,this.menu=a.default.get(n.default.storageKeys.menu),this.menu_dele=!1;for(var e=0;e<this.menu.length;e++){var o=this.menu[e];o.progNo==this.reportModel.progNo&&1==o.powerDelete&&(this.menu_dele=!0)}},onReady:function(){i.default.getListHeight(this)},onBackPress:function(t){return i.default.backPress(t,this.details.length>0)},methods:{onScaned:function(t){this.init(t)},init:function(e){var o=this;this.purLot=e,console.log("--------------1-------------------"+this.purLot," at pages\\process\\process-box.vue:211"),t.showLoading({mask:!0}),r.default.acceptLotPur_MK_GetModel({data:{moLot:e,type:0},success:function(e){console.log(e," at pages\\process\\process-box.vue:221"),e.poMoSoLot=e.purLot,o.erpInterfaceType==n.default.erpInterfaceType.anfeinuo&&(e.proLot=o.getYearWeek()),o.mesInLotType==n.default.mesInLotType.MoLot?e.inLot=e.purLot:o.mesInLotType==n.default.mesInLotType.OrdMoLot?e.inLot=null==e.ordLot?e.purLot:e.ordLot:o.mesInLotType==n.default.mesInLotType.MoLotYearWeek?e.inLot=e.purLot+o.getYearWeek():o.mesInLotType==n.default.mesInLotType.MoLotYMD&&(e.inLot=e.purLot+new Date(e.proDate).format("yyMMdd")),e.proDate=new Date(e.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),e.citemNo=e.citemNo||"",e.lastTagQty=i.default.floatObj.subtract(e.sheetQty,e.createTagQty),o.num=1,o.order=e,o.numQty=o.order.boxPackingQty,t.showToast({title:"扫描成功",icon:"none"}),i.default.showScanedAudio()},failure:function(t){i.default.showAudio(),o.$refs.input_order.setFocus()},complete:function(e,o,r){i.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onNumAdd:function(e){if(""==this.order.purLot||!this.order.purLot)return t.showToast({title:"请扫描工单号！！！",icon:"none"}),void i.default.showAudio();if(this.num<=0||""==this.num)return this.num=1,t.showToast({title:"箱数必须大于0！！！",icon:"none"}),void i.default.showAudio();if(this.numQty<=0||""==this.numQty)return this.num=1,t.showToast({title:"箱数必须大于0！！！",icon:"none"}),void i.default.showAudio();var o=this;if(o.the_totalQty=0,!o.menu_dele&&o.details){for(var r=0,n=o.details.length;r<n;r++){var a=o.details[r];o.the_totalQty=i.default.floatObj.add(o.the_totalQty,i.default.floatObj.multiply(a.num,a.numQty))}if(console.log(o.order.printBoxBarcodeQty,o.the_totalQty+">"+o.order.sheetQty," at pages\\process\\process-box.vue:298"),i.default.floatObj.add(o.numQty,i.default.floatObj.add(o.order.printBoxBarcodeQty,o.the_totalQty))>o.order.sheetQty)return t.showToast({title:"生成的装箱数量不能大于，工单数量！！！",icon:"none"}),void i.default.showAudio()}(o.numQty<=0||""==o.numQty)&&(o.numQty=o.order.minPackingQty),o.details.push({det_id:o.det_id,num:o.num,numQty:o.numQty}),o.numQty=0,o.det_id=o.det_id+1},onPrint:function(e){if(0==this.details.length)return t.showToast({title:"请添加生成外箱！！！",icon:"none"}),i.default.showAudio(),void this.$refs.input_order.setFocus();var o=this,n=[],a=0;o.details.forEach(function(t){for(var e=0;e<t.num;e++){++a;var r=(new Date).format("yyMMddHHmmssfff"),u={};u.partNo=o.order.partNo,u.partItemNo=o.order.partItemNo,u.partName=o.order.partName,u.partSpec=o.order.partSpec,u.suPartNo=o.order.suPartNo,u.inLot=o.order.inLot,u.serialNo="",u.TagFlag="",u.poMoSoLot=o.order.poMoSoLot||o.purLot,u.sheetQty=t.numQty,u.tagId="".concat(r,"-").concat(i.default.getSuffix(3,a)),u.boxTagId=u.tagId,u.boxPackingQty=o.order.boxPackingQty,u.minPackingQty=o.order.minPackingQty,u.linkBoardQty="",u.proLot=o.order.proLot,u.proDate=new Date(o.order.proDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),u.citemNo=o.order.citemNo,u.custNo=o.order.custNo,u.custName=o.order.custName,u.custTagId="",u.reservelocus=o.order.reservelocus,u.ordLot=o.order.ordLot,u.custNo=o.order.custNo,u.purLot=o.purLot,u.proItemNo="",u.proName="",u.toProItemNo="",u.toProName="",u.dayId="",u.spcSta="",u.printType="",u.deviceNo="",u.deviceName="",u.partSpecEn=o.order.partSpecEn,console.log("_self.order.define1朱永军说要---\x3e>>>>>>>>>>>>>>>>>>>>>>>>>>"+o.order.partDefine1," at pages\\process\\process-box.vue:380"),u.partDefine1=o.order.partDefine1,u.partDefine2=o.order.partDefine2,u.partDefine3=o.order.partDefine3,u.partDefine4=o.order.partDefine4,u.partDefine5=o.order.partDefine5,u.partDefine3=o.order.partDefine3,u.partDefine7=o.order.partDefine7,u.partDefine8=o.order.partDefine8,u.partDefine9=o.order.partDefine9,u.partDefine10=o.order.partDefine10,n.push(u)}}),o.reportModel.dataSource=n,a>=999&&t.showModal({title:"提示",content:"外相个数不能超过999个.",showCancel:!1,success:function(t){t.confirm||t.cancel}}),o.the_totalQty=0;for(var u=0,s=o.details.length;u<s;u++){var d=o.details[u];o.the_totalQty=i.default.floatObj.add(o.the_totalQty,i.default.floatObj.multiply(d.num,d.numQty))}var l=!1;if(i.default.floatObj.add(o.order.printBoxBarcodeQty,o.the_totalQty)>o.order.sheetQty&&(l=!0),console.log(o.the_totalQty," at pages\\process\\process-box.vue:425"),!o.menu_dele&&l)return t.showToast({title:"外箱总数数量不能超过，未产生数量！！！",icon:"none"}),void i.default.showAudio();if(!l){if(o.the_totalQty<=0)return t.showToast({title:"外箱更新数量失败！！！",icon:"none"}),void i.default.showAudio();t.showLoading({mask:!0}),r.default.OpenMes_uppurprintbarocdeqty({data:{moLot:o.purLot,qty:o.the_totalQty.toString()},success:function(t){o.the_totalQty=0,console.log("更新数量成功！！！"," at pages\\process\\process-box.vue:457")},failure:function(t){i.default.showAudio()},complete:function(e,o,r){i.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})}o.$refs.printBtn.execPrint()},bindClick:function(t){for(var e=this,o=0;o<e.details.length;o++){var r=e.details[o];if(r.det_id==t.det_id){e.the_totalQty=i.default.floatObj.subtract(e.the_totalQty,r.numQty),e.details.splice(o,1);break}}},tagValid:function(t){i.default.dataInit(this)},showDatePicker:function(){this.$refs.mpvuePicker.show()},onPickerConfirm:function(t){this.order.proDate=new Date(t.label).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd")},getYearWeek:function(){var t=new Date,e=new Date(t.getFullYear(),0,1),o=e.getDay(),r=1;0!=o&&(r=7-o+1),e=new Date(t.getFullYear(),0,1+r);var n=Math.ceil((t.valueOf()-e.valueOf())/864e5),a=Math.ceil(n/7)+1,u=t.getFullYear()+"";return u.substr(2,2)+i.default.getSuffix(2,a)},printComplete:function(){var t=this.purLot;this.init(t),this.details=[]},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onSelectedItem:function(t){for(var e=0;e<this.details.length;e++){var o=this.details[e];o.selectItemClass=e==t?"uni-list-cell-selected":""}}}};e.default=h}).call(this,o("6e42")["default"])}},[["040e","common/runtime","common/vendor"]]]);