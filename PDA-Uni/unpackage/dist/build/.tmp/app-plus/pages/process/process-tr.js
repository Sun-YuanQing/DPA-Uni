(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/process/process-tr"],{"5cde":function(t,e,o){"use strict";var r=function(){var t=this,e=t.$createElement;t._self._c},n=[];o.d(e,"a",function(){return r}),o.d(e,"b",function(){return n})},6409:function(t,e,o){"use strict";o.r(e);var r=o("735c"),n=o.n(r);for(var s in r)"default"!==s&&function(t){o.d(e,t,function(){return r[t]})}(s);e["default"]=n.a},"735c":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(o("2e17")),n=i(o("f2a9")),s=i(o("00e0")),a=i(o("409c"));function i(t){return t&&t.__esModule?t:{default:t}}new Date;var d=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},u=function(){return o.e("components/process-scanOrder/process-scanOrder").then(o.bind(null,"4567"))},c={components:{barcodeInput:d,processScanOrder:u},data:function(){return{old:{scrollTop:0},scrollTop:0,scrollHeight:0,userInfo:[],details:[],curScanPartModel:{},order:null}},onLoad:function(t){this.progNo=t.progNo,this.userInfo=s.default.get(n.default.storageKeys.login)},onReady:function(){a.default.getListHeight(this)},onBackPress:function(t){return a.default.backPress(t,this.details.length>0)},methods:{onGetOrder:function(t){var e=this;e.order=t,e.$refs.input_part.setFocus()},onPartScaned:function(e){var o=this;t.showLoading({mask:!0}),r.default.pro_TR_PartScan({data:{moLot:o.order.moLot,proItemNo:o.order.proItemNo,deviceNo:o.order.deviceNo,qrCode:e},success:function(t){var r=JSON.parse(t.resultNote);r.qrCode=e,o.curScanPartModel=a.default.clone(r);var n=null;"-11"==t.resultCode&&(n=t.resultText),o.scanAdd(o.curScanPartModel,n),a.default.showScanedAudio()},failure:function(t){a.default.showAudio()},complete:function(e,r,n){o.$refs.input_part.setFocus(),a.default.tryCatchApi({status:e,message:r}),t.hideLoading()}})},scanAdd:function(e,o){for(var r=this,n=function(o){var n=r.details[o];if(n.tagId==e.tagId)return t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?r.details.splice(o,1):t.cancel}}),a.default.showAudio(),{v:void 0}},s=0;s<r.details.length;s++){var i=n(s);if("object"===typeof i)return i.v}if(r.order.moLot!=e.poMoSoLot)return t.showToast({title:"该物料不属于当前制造单",icon:"none"}),void a.default.showAudio();if(r.order.partItemNo!=e.partItemNo)return t.showToast({title:"物料不一致",icon:"none"}),void a.default.showAudio();if(r.order.itemNo!=e.toProItemNo)return t.showToast({title:"该物料TO工序不属于当前工序",icon:"none"}),void a.default.showAudio();if(o&&o.length>0){for(var d="",u=0;u<r.details.length;u++){var c=r.details[u];if(c.partItemNo==e.partItemNo){d=c.sheetLot;break}}return r.lockModel.description=o,r.lockModel.sourceId=d,void(r.showAuth=!0)}r.details.push(e),r.onScrollTop(r.details.length-1)},authClick:function(t){this.showAuth=!1;for(var e=0;e<this.details.length;e++){var o=this.details[e];if(o.partItemNo==this.curScanPartModel.partItemNo){o.locklogDetails=[t];break}}1==t.resultSta&&this.scanAdd(this.curScanPartModel),this.$refs.input_part.setFocus()},onSave:function(){var e=this,o=this;if(o.$refs.input_order.validInputFinish()){if(0==this.details.length)return t.showToast({title:"请扫描要投入的物料",icon:"none"}),void this.$refs.input_part.setFocus();var n=this.convert2ScmMesDayInputModel();t.showLoading({mask:!0}),r.default.Pda_pdamesdayproinput({data:n,success:function(o){t.showToast({title:"保存成功!"}),a.default.dataInit(e),e.$refs.input_order.setOrderFocus()},failure:function(t){a.default.showAudio()},complete:function(e,o,r){a.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})}},convert2ScmMesDayInputModel:function(){for(var t=[],e=new Date,o=0;o<this.details.length;o++){var r=this.details[o],s={};s.sheetDate=e.format("yyyy/MM/dd hh:mm:ss"),s.moLot=this.order.moLot,s.proNo=this.order.custNo,s.proItemNo=this.order.itemNo,s.deviceNo=this.order.deviceNo,s.partNo=r.partNo,s.partItemNo=r.partItemNo,s.partName=r.partName,s.partSpec=r.partSpec,s.unitNo=r.unitNo,s.unitName=r.unitName,s.inLot=r.inLot,s.sheetQty=r.sheetQty,s.esnNo=r.esnNo,s.updateTime=e.format("yyyy/MM/dd hh:mm:ss"),s.userNo=this.userInfo.userID,s.createDate=e.format("yyyy/MM/dd hh:mm:ss")||(new Date).format("yyyy/MM/dd hh:mm:ss"),s.dayId=r.dayId,s.tagId=r.tagId,s.qrCode=r.qrCode,s.inputType=2,s.sourceSpcSta=1,s.sourceCustNo=r.proNo,s.locklogDetails=r.locklogDetails,s.entityState=n.default.entityState.added,t.push(s)}return t},onSelectedItem:function(t){for(var e=0;e<this.details.length;e++){var o=this.details[e];o.selectItemClass=e==t?"uni-list-cell-selected":""}},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var r=t.createSelectorQuery().select(".scroll-view-item");r.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,null!=t&&o.$nextTick(function(){this.scrollTop=t.height*e})}).exec()}}};e.default=c}).call(this,o("6e42")["default"])},"8a95":function(t,e,o){"use strict";o.r(e);var r=o("5cde"),n=o("6409");for(var s in n)"default"!==s&&function(t){o.d(e,t,function(){return n[t]})}(s);var a=o("2877"),i=Object(a["a"])(n["default"],r["a"],r["b"],!1,null,null,null);e["default"]=i.exports}},[["152f","common/runtime","common/vendor"]]]);