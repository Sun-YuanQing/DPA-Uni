(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/process/production-intoDet"],{"0998":function(t,e,o){"use strict";o.r(e);var n=o("dce0"),i=o("d46f");for(var a in i)"default"!==a&&function(t){o.d(e,t,function(){return i[t]})}(a);var r=o("2877"),s=Object(r["a"])(i["default"],n["a"],n["b"],!1,null,null,null);e["default"]=s.exports},"31c8":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=c(o("2e17")),i=c(o("f2a9")),a=c(o("00e0")),r=c(o("409c")),s=o("2f62");function c(t){return t&&t.__esModule?t:{default:t}}function l(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),n.forEach(function(e){d(t,e,o[e])})}return t}function d(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var u=function(){return o.e("components/barcode-input/barcode-input").then(o.bind(null,"d7ce"))},f={components:{barcodeInput:u},data:function(){return{old:{scrollTop:0},scrollTop:0,scrollHeight:0,erpInterfaceType:null,placeholder_store:"",isStorageBin:null,binNo:"",binWhNo:"",order:{purLot:"",partItemNo:"",whName:"",sheetQty:0,scanQty:0,lastScanQty:0,tagDetails:[],binNostr:"",defineDate:""},details:[]}},onLoad:function(t){console.log("option: "+JSON.stringify(t)," at pages\\process\\production-intoDet.vue:141");var e=t.sheetLot||"";this.init(e);var o=this;this.isStorageBin=a.default.get(i.default.storageKeys.IsStorageBin),this.isStorageBin?o.placeholder_store="扫描储位":o.placeholder_store="扫描仓库"},onReady:function(){r.default.getListHeight(this)},onBackPress:function(t){return r.default.backPress(t,this.details.length>0)},methods:l({},(0,s.mapMutations)(["pageIO_true"]),{init:function(e){var o=this;t.showLoading({mask:!0}),n.default.acceptin_Storage_GetDetails({data:{sheetLot:e},success:function(t){t.sheetQty=Number(t.sheetQty),t.scanQty=0,t.lastScanQty=t.sheetQty,t.tagDetails=t.tagDetails||[],t.binNos=t.binNos||[],t.defineDate=new Date(t.defineDate).format("yyyy/MM/dd")||(new Date).format("yyyy/MM/dd"),t.binNostr="";for(var e=0;e<t.binNos.length;e++)t.binNostr=0==e?t.binNos[e]:","+t.binNos[e];o.order=t},complete:function(e,o,n){r.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onScanStorage:function(e){var o=this;t.showLoading({mask:!0}),this.isStorageBin&&n.default.bas_storagebin({data:{binNo:e},success:function(e){e.length<=0?(t.showToast({title:"货架不存在!",icon:"none"}),o.$refs.input_store.clear(),r.default.showAudio()):(o.binNo=e[0].binNo,o.binWhNo=e[0].whNo,o.$refs.input_part.setFocus(),r.default.showScanedAudio())},complete:function(e,o,n){r.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})},onPartScaned:function(e){var o=this;if(t.showLoading({mask:!0}),this.isStorageBin&&""==this.binNo.trim())return t.showToast({title:"请先扫描货架",icon:"none"}),this.$refs.input_store.setFocus(),void r.default.showAudio();var s=this;n.default.OpenMes_mesqrcodeinout({data:{qrCode:e},success:function(n){for(var c=function(){var e=o.details[l];if(e.tagId==n.tagId)return o.onScrollTop(l),t.showModal({title:"提示",content:"该标签已扫描,是否要删除",success:function(t){t.confirm?(s.details.splice(l,1),s.updateScanList(-e.sheetQty)):t.cancel}}),r.default.showAudio(),{v:void 0}},l=0;l<o.details.length;l++){var d=c();if("object"===typeof d)return d.v}return s.order.partItemNo!=n.partItemNo||s.order.purLot!=n.poMoSoLot?(t.showToast({title:"标签扫描错误",icon:"none"}),void r.default.showAudio()):s.order.sheetQty-s.order.scanQty<n.sheetQty?(t.showToast({title:"超出应上架数量",icon:"none"}),void r.default.showAudio()):(s.erpInterfaceType=a.default.get(i.default.storageKeys.erpInterfaceType),s.erpInterfaceType==i.default.erpInterfaceType.sanwei&&1!=n.fullInspectionSw?(t.showToast({title:"请先进行全检",icon:"none"}),r.default.showAudio(),void o.onScrollTop(index)):(t.showToast({title:"扫描成功"}),n.tagDetails?n.tagDetails.forEach(function(t){s.isStorageBin?(t.binNo=s.binNo,t.binWhNo=s.binWhNo):(t.binNo=s.order.whNo,t.binWhNo=s.order.whNo),t.sheetQty=Number(n.sheetQty)}):(s.isStorageBin?(n.binNo=s.binNo,n.binWhNo=s.binWhNo):(n.binNo=s.order.whNo,n.binWhNo=s.order.whNo),n.sheetQty=Number(n.sheetQty)),n.qrCode=e,o.details.push(n),o.updateScanList(n.sheetQty),o.onScrollTop(o.details.length-1),o.$refs.input_part.clear(),r.default.showScanedAudio(),void(0==o.order.lastScanQty&&t.showModal({title:"提示",content:"扫描完成是否要保存",success:function(t){t.confirm?s.onSave():t.cancel}}))))},failure:function(t){r.default.showAudio()},complete:function(e,n,i){o.$refs.input_part.setFocus(),r.default.tryCatchApi({status:e,message:n}),t.hideLoading()}})},updateScanList:function(t){this.order.scanQty=r.default.floatObj.add(this.order.scanQty,t),this.order.lastScanQty=r.default.floatObj.subtract(this.order.sheetQty,this.order.scanQty)},onSave:function(){var e=this;if(this.order.lastScanQty>0)t.showToast({title:"还有未上架的物料",icon:"none"});else{for(var o=[],a=0;a<this.details.length;a++){var s=this.details[a];if(s.tagDetails=s.tagDetails||[],s.tagDetails.length>0)for(var c=0;c<s.tagDetails.length;c++){var l=s.tagDetails[c],d={};d.sheetType=this.order.sheetType,d.sheetNo=this.order.sheetNo,d.sheetLot=this.order.sheetLot,d.partNo=l.partNo,d.purLot=l.purLot,d.proLot=l.proLot,d.sheetQty=Number(l.sheetQty),d.inLot=l.inLot,d.proDate=l.proDate,d.tagId=l.tagId,d.boxTagId=l.boxTagId,d.custTagId=l.custTagId,d.ordLot=l.ordLot,d.custNo=l.custNo,this.isStorageBin?(d.binNo=this.binNo,d.binWhNo=this.binWhNo):(d.binNo=this.order.whNo,d.binWhNo=this.order.whNo),d.qrCode=l.qrCode,d.inoutFlag="1",d.partDefine1=l.partDefine1||l.partDefine1,d.partDefine2=l.partDefine2||l.partDefine2,d.partDefine3=l.partDefine3||l.partDefine3,d.partDefine4=l.partDefine4||l.partDefine4,d.partDefine5=l.partDefine5||l.partDefine5,d.partDefine6=l.partDefine3||l.partDefine6,d.partDefine7=l.partDefine7||l.partDefine7,d.partDefine8=l.partDefine8||l.partDefine8,d.partDefine9=l.partDefine9||l.partDefine9,d.partDefine10=l.partDefine10||l.partDefine10,d.entityState=i.default.entityState.added,o.push(d)}else{d={};d.sheetType=this.order.sheetType,d.sheetNo=this.order.sheetNo,d.sheetLot=this.order.sheetLot,d.partNo=s.partNo,d.purLot=s.poMoSoLot,d.proLot=s.proLot,d.sheetQty=Number(s.sheetQty),d.inLot=s.inLot,d.proDate=s.proDate,d.tagId=s.tagId,d.boxTagId=s.boxTagId,d.custTagId=s.custTagId,d.ordLot=s.ordLot,d.custNo=s.custNo,this.isStorageBin?(d.binNo=this.binNo,d.binWhNo=this.binWhNo):(d.binNo=this.order.whNo,d.binWhNo=this.order.whNo),d.qrCode=s.qrCode,d.inoutFlag="1",d.partDefine1=s.partDefine1,d.partDefine2=s.partDefine2,d.partDefine3=s.partDefine3,d.partDefine4=s.partDefine4,d.partDefine5=s.partDefine5,d.partDefine6=s.partDefine3,d.partDefine7=s.partDefine7,d.partDefine8=s.partDefine8,d.partDefine9=s.partDefine9,d.partDefine10=s.partDefine10,d.entityState=i.default.entityState.added,o.push(d)}}t.showLoading({title:"加载中",mask:!0}),n.default.acceptin_Storage_Save({data:o,success:function(o){t.showToast({title:"保存成功"}),e.pageIO_true(),e.isStorageBin?e.placeholder_store="扫描储位":e.placeholder_store="扫描仓库",r.default.showScanedAudio(),setTimeout(function(){t.navigateBack()},600)},failure:function(t){r.default.showAudio()},complete:function(e,o,n){r.default.tryCatchApi({status:e,message:o}),t.hideLoading()}})}},onSelectedItem:function(t){for(var e=r.default.clone(this.details),o=0;o<e.length;o++){var n=e[o];n.selectItemClass=o==t?"uni-list-cell-selected":""}this.details=e},scroll:function(t){this.old.scrollTop=t.detail.scrollTop},onScrollTop:function(e){var o=this;this.onSelectedItem(e);var n=t.createSelectorQuery().in(this).select(".scroll-view-item");n.boundingClientRect(function(t){o.scrollTop=o.old.scrollTop,null!=t&&o.$nextTick(function(){this.scrollTop=t.height*e})}).exec()}})};e.default=f}).call(this,o("6e42")["default"])},d46f:function(t,e,o){"use strict";o.r(e);var n=o("31c8"),i=o.n(n);for(var a in n)"default"!==a&&function(t){o.d(e,t,function(){return n[t]})}(a);e["default"]=i.a},dce0:function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},i=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return i})}},[["5858","common/runtime","common/vendor"]]]);